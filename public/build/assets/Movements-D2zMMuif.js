import{T as xe}from"./index-CQck-czE.js";import{s as ge}from"./index-DggD9_PH.js";import{s as he}from"./index-DWk9iUT_.js";import{u as ke,a as we,b as Me,r as y,T as Ve,d as O,w as F,e as S,f as m,g as e,F as U,c as K,o as c,i as r,Z as Se,j as s,k as G,t as n,l as _,q as N,p as b,s as qe,n as Te,m as Ce,h as P,x as Ie,y as $e}from"./app-BTm5MPCd.js";import{_ as Ae}from"./AppLayout-PXrFRazT.js";import{s as w,a as Le}from"./index-Dpj4P_iu.js";import{s as h}from"./index-DR-PVOhd.js";import{s as Fe}from"./index-C9ua_LZc.js";import{s as Ue}from"./index-DGDWVGXJ.js";import{s as T}from"./index-DR_P-HCg.js";import{s as De}from"./index-CZPsBpjb.js";import{a as je,s as Oe}from"./index-CwE9RYdH.js";import{s as Ne}from"./index-CM1LmSBY.js";import{s as Pe}from"./index-X3iKIzTH.js";import{s as ae}from"./index-B_B1CqLL.js";import{s as Ee}from"./index-CMJxrKp_.js";import{s as Re}from"./index-5eLJkV0u.js";import{s as ze}from"./index-C3ZvT3G3.js";import{s as Be}from"./index-DGQuV0xQ.js";import{d as Ke}from"./debounce-D2RdOKIu.js";import{_ as He}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-DOcyrvpR.js";import"./index-sPpDuk3t.js";import"./DropdownLink-CqRe5Bfh.js";import"./index-U7kuayBf.js";import"./index-BMBaB7B1.js";import"./index-DJd_Kodp.js";const M=x=>(Ie("data-v-db479cfb"),x=x(),$e(),x),Qe={class:"quantum-v11-container p-4 lg:p-8 bg-[#f8fafc] min-h-screen"},Ge={class:"flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-4"},We={class:"flex items-center gap-4"},Ze=M(()=>s("div",{class:"flex h-16 w-16 items-center justify-center rounded-[1rem] bg-primary-600 shadow-xl shadow-primary-200 text-white text-2xl"},[s("i",{class:"pi pi-sync"})],-1)),Je={class:"text-2xl font-black tracking-tighter text-slate-900 uppercase"},Xe=M(()=>s("span",{class:"text-primary-600"},"GMAO",-1)),Ye={class:"text-slate-500 text-xs font-medium uppercase tracking-widest"},et={class:"flex gap-2"},tt={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-8"},st={class:"p-6 bg-white rounded-2xl border border-slate-200 shadow-sm flex items-center gap-5"},ot=M(()=>s("div",{class:"w-14 h-14 rounded-xl bg-slate-100 flex items-center justify-center"},[s("i",{class:"pi pi-sync text-2xl text-slate-500"})],-1)),lt={class:"text-2xl font-black text-slate-800"},at={class:"text-[10px] font-bold text-slate-400 uppercase tracking-widest"},it={class:"p-6 bg-white rounded-2xl border border-slate-200 shadow-sm flex items-center gap-5"},nt=M(()=>s("div",{class:"w-14 h-14 rounded-xl bg-green-50 flex items-center justify-center"},[s("i",{class:"pi pi-arrow-down text-2xl text-green-500"})],-1)),rt={class:"text-2xl font-black text-slate-800"},dt={class:"text-[10px] font-bold text-slate-400 uppercase tracking-widest"},ct={class:"p-6 bg-white rounded-2xl border border-slate-200 shadow-sm flex items-center gap-5"},ut=M(()=>s("div",{class:"w-14 h-14 rounded-xl bg-red-50 flex items-center justify-center"},[s("i",{class:"pi pi-arrow-up text-2xl text-red-500"})],-1)),mt={class:"text-2xl font-black text-slate-800"},pt={class:"text-[10px] font-bold text-slate-400 uppercase tracking-widest"},vt={class:"p-6 bg-white rounded-2xl border border-slate-200 shadow-sm flex items-center gap-5"},ft=M(()=>s("div",{class:"w-14 h-14 rounded-xl bg-sky-50 flex items-center justify-center"},[s("i",{class:"pi pi-arrows-h text-2xl text-sky-500"})],-1)),bt={class:"text-2xl font-black text-slate-800"},_t={class:"text-[10px] font-bold text-slate-400 uppercase tracking-widest"},yt={class:"card-v11 overflow-hidden border border-slate-200 rounded-2xl bg-white shadow-sm"},xt={key:0,class:"flex flex-col md:flex-row justify-between items-center gap-4 p-4"},gt={class:"flex flex-col md:flex-row items-center gap-3 w-full md:w-auto"},ht={class:"flex items-center gap-2"},kt={key:1,class:"flex justify-between items-center p-4 bg-primary-50 rounded-xl"},wt={class:"font-bold text-sm text-primary-700"},Mt={class:"text-center"},Vt={class:"font-bold text-slate-800 tracking-tight block"},St={class:"font-mono text-xs text-slate-500 block"},qt={class:"font-mono font-black text-lg"},Tt={class:"text-xs font-medium text-slate-500"},Ct={key:0,class:"flex items-center gap-2"},It=M(()=>s("i",{class:"pi pi-map-marker text-slate-400"},null,-1)),$t={class:"text-xs font-medium text-slate-500"},At={key:0,class:"flex items-center gap-2"},Lt=M(()=>s("i",{class:"pi pi-flag-fill text-slate-400"},null,-1)),Ft={class:"text-xs font-medium text-slate-500"},Ut={key:0,class:"flex w-fit items-center gap-3 rounded-full bg-slate-50 p-1 pr-4 border border-slate-100"},Dt={class:"text-sm font-bold text-slate-700"},jt={key:0,class:"flex justify-end gap-2"},Ot={class:"text-sm font-black text-slate-800 mb-4"},Nt={class:"px-8 py-5 bg-slate-900 text-white flex justify-between items-center rounded-xl"},Pt={class:"flex items-center gap-4"},Et=M(()=>s("div",{class:"p-2.5 bg-primary-500/20 rounded-xl border border-primary-500/30"},[s("i",{class:"pi pi-sync text-blue-400 text-xl"})],-1)),Rt={class:"flex flex-col"},zt={class:"text-sm font-black uppercase tracking-[0.15em] text-white leading-none"},Bt={class:"text-[9px] text-primary-300 font-bold uppercase tracking-tighter mt-1.5 opacity-80 italic"},Kt={class:"p-8 bg-white max-h-[70vh] overflow-y-auto scroll-smooth"},Ht={class:"grid grid-cols-1 md:grid-cols-12 gap-6"},Qt={class:"md:col-span-5 space-y-6 p-6 bg-slate-50 rounded-3xl border border-slate-100"},Gt={class:"text-xs font-black uppercase text-primary-600 tracking-widest flex items-center gap-2"},Wt=M(()=>s("i",{class:"pi pi-list-check"},null,-1)),Zt={class:"field"},Jt={class:"text-[10px] font-extrabold text-slate-400 uppercase ml-2 mb-1 block"},Xt={class:"space-y-6"},Yt={key:0,class:"field"},es={class:"text-[10px] font-extrabold text-slate-400 uppercase ml-2 mb-1 block"},ts={key:1,class:"field"},ss={class:"text-[10px] font-extrabold text-slate-400 uppercase ml-2 mb-1 block"},os={class:"field"},ls={class:"text-[10px] font-extrabold text-slate-400 uppercase ml-2 mb-1 block"},as={class:"field"},is={class:"text-[10px] font-extrabold text-slate-400 uppercase ml-2 mb-1 block"},ns={class:"field"},rs={class:"text-[10px] font-extrabold text-slate-400 uppercase ml-2 mb-1 block"},ds={class:"md:col-span-7 space-y-6"},cs={class:"text-xs font-black uppercase text-primary-600 tracking-widest flex items-center gap-2"},us=M(()=>s("i",{class:"pi pi-box"},null,-1)),ms={class:"p-4 bg-slate-50 rounded-2xl border border-slate-100 grid grid-cols-1 md:grid-cols-2 gap-4 items-end"},ps={class:"field"},vs={class:"text-[10px] font-extrabold text-slate-400 uppercase ml-2 mb-1 block"},fs={class:"field max-w-full"},bs={class:"text-[10px] font-extrabold text-slate-400 uppercase ml-2 mb-1 block"},_s={key:0,class:"flex flex-col min-w-0"},ys={class:"font-bold text-sm truncate leading-tight text-slate-700 flex justify-between items-center"},xs={key:0,class:"text-xs bg-slate-200 text-slate-600 font-mono px-1.5 py-0.5 rounded ml-2"},gs={key:1},hs={class:"flex flex-col min-w-0 overflow-hidden"},ks={class:"flex justify-between items-center"},ws={class:"font-bold text-sm truncate leading-tight"},Ms={key:0,class:"text-xs bg-primary-100 text-primary-700 font-mono px-1.5 py-0.5 rounded"},Vs={class:"text-[10px] text-slate-500 truncate"},Ss={class:"field"},qs={class:"text-[10px] font-extrabold text-slate-400 uppercase ml-2 mb-1 block"},Ts={class:"mt-4 border-t border-slate-200 pt-4"},Cs={class:"text-xs font-black uppercase text-slate-500 tracking-widest mb-3"},Is={class:"max-h-60 overflow-y-auto space-y-2 pr-2"},$s={class:"font-bold text-sm text-slate-800"},As={class:"text-xs text-slate-500"},Ls={class:"flex items-center gap-4"},Fs={class:"font-mono font-black text-lg"},Us={key:0,class:"text-center text-sm text-slate-400 italic py-4"},Ds={class:"flex justify-between items-center w-full px-8 py-4 bg-slate-50 border-t border-slate-100"},js={__name:"Movements",props:{stockMovements:Object,filters:Object,regions:Array,users:Array,movableItems:Object,masterMovableItems:Object,queryParams:Object},setup(x){const g=x,{t:o}=ke(),A=we(),W=Me(),L=y(!1),Z=y(!1),C=y(!1),J=y(),X=y(),$=y([]),H=y(!1),q=y(),Y=()=>{q.value={global:{value:null,matchMode:U.CONTAINS},type:{operator:K.OR,constraints:[{value:null,matchMode:U.EQUALS}]},movable_type:{operator:K.OR,constraints:[{value:null,matchMode:U.EQUALS}]},region:{value:null,matchMode:U.EQUALS},date:{operator:K.AND,constraints:[{value:null,matchMode:U.DATE_IS}]},"user.name":{operator:K.AND,constraints:[{value:null,matchMode:U.STARTS_WITH}]}}};Y();const I=y({first:g.stockMovements.from-1,rows:g.stockMovements.per_page,sortField:g.queryParams.sortField||"date",sortOrder:g.queryParams.sortOrder==="desc"?-1:1,filters:q.value}),E=l=>{H.value=!0,I.value=l;const a={...l,page:l.page+1,"filters[region][value]":q.value.region.value,per_page:l.rows};P.get(route("stock-movements.index"),a,{preserveState:!0,onFinish:()=>{H.value=!1}})},i=Ve({id:null,items:[],type:"sortie",date:new Date,notes:null,responsible_user_id:null,intended_for_user_id:null,source_region_id:null,destination_region_id:null}),ie=y([{field:"movable_type",header:o("stockMovements.table.itemType")},{field:"movable",header:o("stockMovements.table.item")},{field:"type",header:o("stockMovements.table.type")},{field:"quantity",header:o("stockMovements.table.quantity")},{field:"source_region",header:o("stockMovements.table.source")},{field:"destination_region",header:o("stockMovements.table.destination")},{field:"user",header:o("stockMovements.table.user")},{field:"stock_at_movement",header:"Stock au Mvt."},{field:"date",header:o("stockMovements.table.date")}]),k=y(["movable_type","movable","type","quantity","user","date"]),Q=y([{label:o("stockMovements.movableTypes.spare_part"),value:"App\\Models\\SparePart"},{label:o("stockMovements.movableTypes.equipment"),value:"App\\Models\\Equipment"},{label:o("stockMovements.movableTypes.meter"),value:"App\\Models\\Meter"},{label:o("stockMovements.movableTypes.keypad"),value:"App\\Models\\Keypad"},{label:o("stockMovements.movableTypes.engin"),value:"App\\Models\\Engin"}]),ee=y([{label:o("stockMovements.movementTypes.entry"),value:"entry"},{label:o("stockMovements.movementTypes.exit"),value:"exit"},{label:o("stockMovements.movementTypes.transfer"),value:"transfer"}]),R=O(()=>{if(!u.value.movable_type)return[];const l=i.type==="entry"?g.masterMovableItems:g.movableItems;switch(u.value.movable_type){case"App\\Models\\SparePart":return l.spare_parts||[];case"App\\Models\\Equipment":return l.equipments||[];case"App\\Models\\Meter":return l.meters||[];case"App\\Models\\Keypad":return l.keypads||[];case"App\\Models\\Engin":return l.engins||[];default:return[]}}),z=O(()=>i.type==="entry"?!i.destination_region_id:i.type==="exit"?!i.source_region_id:i.type==="transfer"?!i.source_region_id||!i.destination_region_id:!0),u=y({movable_type:null,movable_id:null,quantity:1}),ne=()=>{var v;if(!u.value.movable_type||!u.value.movable_id)return;let l;i.type==="entry"?l=g.masterMovableItems:l=g.movableItems;const a=u.value.movable_type.split("\\").pop().toLowerCase(),f=Object.keys(l).find(t=>t.replace("_","").includes(a));if(!f)return;const p=(v=l[f])==null?void 0:v.find(t=>t.id===u.value.movable_id);p&&(i.items.push({...u.value,item_details:p}),u.value={movable_type:null,movable_id:null,quantity:1})},re=l=>{i.items.splice(l,1)},de=l=>{var f;if(!l)return"";const a=l.stock_in_region!==null?` - Stock: ${l.stock_in_region}`:"";return l.serial_number?`${l.serial_number} (${l.model||"N/A"})`:l.reference?`${l.reference} (${((f=l.label)==null?void 0:f.designation)||"N/A"})${a}`:l.tag?`${l.tag} - ${l.designation}`:`ID: ${l.id}`};F(()=>u.value.movable_type,()=>{u.value.movable_id=null}),F(()=>i.type,()=>{i.source_region_id=null,i.destination_region_id=null,i.items=[]}),F(()=>[i.type,i.source_region_id,i.destination_region_id],([l,a,f])=>{l==="entry"?f!==a&&(i.source_region_id=f):l==="exit"&&a!==f&&(i.destination_region_id=a)}),F(()=>i.source_region_id,(l,a)=>{i.items=[],u.value.movable_id=null,console.log("Source region changed. New region ID:",l,"Old region ID:",a),(i.type==="exit"||i.type==="transfer")&&l!==a&&(P.get(route("stock-movements.index"),{...I.value,"filters[region_id][value]":l,"filters[type][value]":i.type},{preserveState:!0,preserveScroll:!0}),console.log("Props loaded after region change:",g.movableItems))}),F(()=>i.items,(l,a)=>{if(i.type==="entry")return;const f=p=>{const v=Object.keys(g.movableItems).find(t=>p.movable_type.toLowerCase().includes(t.slice(0,-1)));return v?{list:g.movableItems[v],id:p.movable_id}:{list:null,id:null}};a.forEach(p=>{const{list:v,id:t}=f(p);if(v){const d=v.find(V=>V.id===t);d&&typeof d.stock_in_region<"u"&&(d.stock_in_region+=p.quantity)}}),l.forEach(p=>{const{list:v,id:t}=f(p);if(v){const d=v.find(V=>V.id===t);d&&typeof d.stock_in_region<"u"&&(d.stock_in_region-=p.quantity)}})},{deep:!0});const te=O(()=>u.value.movable_type?u.value.movable_type!=="App\\Models\\SparePart"&&u.value.movable_type!=="App\\Models\\Equipment":!0);F(te,l=>{l&&(u.value.quantity=1)});const ce=()=>{i.reset(),i.items=[],i.date=new Date,u.value={movable_type:null,movable_id:null,quantity:1},C.value=!1,Z.value=!1,L.value=!0},se=()=>{i.reset(),L.value=!1},ue=l=>{C.value=!0,i.id=l.id,i.type=l.type,i.notes=l.notes||"",i.date=new Date(l.date),i.responsible_user_id=l.responsible_user_id,i.items=[{movable_type:l.movable_type,movable_id:l.movable_id,quantity:l.quantity,item_details:l.movable}],L.value=!0},me=()=>{Z.value=!0;const l=C.value?route("stock-movements.update",i.id):route("stock-movements.store"),a=C.value?"put":"post";if(i.items.length===0){A.add({severity:"error",summary:o("common.error"),detail:o("stockMovements.toast.noItems"),life:4e3});return}console.log(i);const f={...i.data(),items:i.items.map(p=>({movable_type:p.movable_type,movable_id:p.movable_id,quantity:p.quantity})),date:i.date.toISOString().slice(0,10)};P.visit(l,{method:a,data:f,onSuccess:()=>{L.value=!1,A.add({severity:"success",summary:o("common.success"),detail:C.value?o("stockMovements.toast.updateSuccess"):o("stockMovements.toast.createSuccess"),life:4e3}),i.reset()},onError:p=>{console.error("Erreur lors de la sauvegarde du mouvement",p);const v=Object.values(p).flat().join(" ; ");A.add({severity:"error",summary:o("common.error"),detail:v||o("stockMovements.toast.saveError"),life:5e3})}})},pe=l=>{W.require({message:o("stockMovements.confirm.deleteMessage",{id:l.id}),header:o("confirm.deleteHeader"),icon:"pi pi-exclamation-triangle",acceptClass:"p-button-danger",accept:()=>{P.delete(route("stock-movements.destroy",l.id),{onSuccess:()=>A.add({severity:"success",summary:o("common.success"),detail:o("stockMovements.toast.deleteSuccess"),life:3e3})})}})},ve=()=>{W.require({message:o("stockMovements.dialog.deleteSelectedMessage",{count:$.value.length}),header:o("confirm.deleteHeader"),icon:"pi pi-exclamation-triangle",acceptClass:"p-button-danger",accept:()=>{const l=$.value.map(a=>a.id);P.post(route("stock-movements.bulk-destroy"),{ids:l},{onSuccess:()=>{A.add({severity:"success",summary:o("common.success"),detail:o("stockMovements.toast.deleteSuccess"),life:3e3}),$.value=[]},onError:()=>A.add({severity:"error",summary:o("common.error"),detail:o("stockMovements.toast.deleteError"),life:5e3})})}})},fe=O(()=>C.value?o("stockMovements.dialog.editTitle"):o("stockMovements.dialog.createTitle")),oe=l=>{const a=Q.value.find(f=>f.value===l);return a?a.label:l.split("\\").pop()},be=l=>l?l.label&&l.label.designation?l.label.designation:l.designation||l.model||`ID: ${l.id}`:"N/A",_e=l=>{switch(l){case"entry":return"success";case"exit":return"danger";case"transfer":return"info";default:return"secondary"}},ye=l=>{switch(l){case"entry":return"pi pi-arrow-down";case"exit":return"pi pi-arrow-up";case"transfer":return"pi pi-arrows-h";default:return"pi pi-question-circle"}},B=O(()=>{const l={total:g.stockMovements.data.length,entry:0,exit:0,transfer:0};return g.stockMovements.data.forEach(a=>{l[a.type.toLowerCase()]++}),l});return(l,a)=>{const f=he,p=ge,v=xe;return c(),S(Ae,{title:e(o)("stockMovements.title")},{default:m(()=>[r(e(Se),{title:e(o)("stockMovements.headTitle")},null,8,["title"]),s("div",Qe,[r(f),r(p),s("div",Ge,[s("div",We,[Ze,s("div",null,[s("h1",Je,[G(n(e(o)("stockMovements.title"))+" ",1),Xe]),s("p",Ye,n(e(o)("stockMovements.subtitle")),1)])]),s("div",et,[r(e(h),{label:e(o)("stockMovements.toolbar.addMovement"),icon:"pi pi-plus",class:"shadow-lg shadow-primary-200",onClick:ce},null,8,["label"])])]),s("div",tt,[s("div",st,[ot,s("div",null,[s("div",lt,n(B.value.total),1),s("div",at,n(e(o)("stockMovements.stats.total")),1)])]),s("div",it,[nt,s("div",null,[s("div",rt,n(B.value.entry),1),s("div",dt,n(e(o)("stockMovements.stats.entries")),1)])]),s("div",ct,[ut,s("div",null,[s("div",mt,n(B.value.exit),1),s("div",pt,n(e(o)("stockMovements.stats.exits")),1)])]),s("div",vt,[ft,s("div",null,[s("div",bt,n(B.value.transfer),1),s("div",_t,n(e(o)("stockMovements.stats.transfers")),1)])])]),s("div",yt,[r(e(Le),{value:x.stockMovements.data,ref_key:"dt",ref:J,dataKey:"id",rows:x.stockMovements.per_page,paginator:"",selection:$.value,"onUpdate:selection":a[6]||(a[6]=t=>$.value=t),lazy:!0,onPage:a[7]||(a[7]=t=>E(t)),onSort:a[8]||(a[8]=t=>E(t)),totalRecords:x.stockMovements.total,loading:H.value,first:I.value.first,"onUpdate:first":a[9]||(a[9]=t=>I.value.first=t),sortField:I.value.sortField,sortOrder:I.value.sortOrder,rowsPerPageOptions:[10,25,50,100],class:"p-datatable-sm quantum-table",filters:q.value,"onUpdate:filters":a[10]||(a[10]=t=>q.value=t),filterDisplay:"menu",globalFilterFields:["movable.serial_number","movable.reference","movable.tag","user.name","notes"],paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink RowsPerPageDropdown CurrentPageReport",currentPageReportTemplate:e(o)("common.paginationReport")},{header:m(()=>[$.value.length?(c(),_("div",kt,[s("span",wt,n(e(o)("common.selectedCount",{count:$.value.length})),1),r(e(h),{label:e(o)("common.deleteSelection"),icon:"pi pi-trash",severity:"danger",onClick:ve,class:"rounded-xl h-11"},null,8,["label"])])):(c(),_("div",xt,[s("div",gt,[r(e(T),{modelValue:q.value.region.value,"onUpdate:modelValue":a[0]||(a[0]=t=>q.value.region.value=t),options:x.regions,optionLabel:"designation",optionValue:"id",placeholder:e(o)("stockMovements.filter.byRegion"),showClear:"",onChange:a[1]||(a[1]=t=>E(I.value)),class:"w-full md:w-64 h-11 !rounded-2xl !border-slate-200 !bg-slate-50/50 focus:!ring-2 focus:!ring-primary-500/20 focus:!bg-white transition-all duration-200"},null,8,["modelValue","options","placeholder"]),r(e(je),{iconPosition:"left",class:"w-full md:w-96"},{default:m(()=>[r(e(Oe),{class:"pi pi-search text-slate-400"}),r(e(Ue),{modelValue:q.value.global.value,"onUpdate:modelValue":a[2]||(a[2]=t=>q.value.global.value=t),onInput:a[3]||(a[3]=t=>e(Ke)(()=>E(I.value),500)()),placeholder:e(o)("stockMovements.toolbar.searchPlaceholder"),class:"w-full h-11 rounded-2xl border-slate-200 bg-slate-50/50 focus:ring-2 focus:ring-primary-500/20 focus:bg-white transition-all duration-200"},null,8,["modelValue","placeholder"])]),_:1})]),s("div",ht,[N(r(e(h),{icon:"pi pi-filter-slash",outlined:"",severity:"secondary",onClick:Y,class:"rounded-xl h-11"},null,512),[[v,e(o)("common.resetFilters"),void 0,{bottom:!0}]]),N(r(e(h),{icon:"pi pi-download",text:"",rounded:"",severity:"secondary",onClick:a[4]||(a[4]=t=>J.value.exportCSV()),class:"h-11 w-11"},null,512),[[v,e(o)("common.exportCSV"),void 0,{bottom:!0}]]),N(r(e(h),{icon:"pi pi-cog",text:"",rounded:"",severity:"secondary",onClick:a[5]||(a[5]=t=>X.value.toggle(t)),class:"h-11 w-11"},null,512),[[v,e(o)("common.selectColumns"),void 0,{bottom:!0}]])])]))]),default:m(()=>[r(e(w),{selectionMode:"multiple",headerStyle:"width: 3rem",frozen:""}),k.value.includes("movable_type")?(c(),S(e(w),{key:0,field:"movable_type",header:e(o)("stockMovements.table.itemType"),sortable:"",filterField:"movable_type",showFilterMatchModes:!1,style:{"min-width":"12rem"}},{body:m(({data:t})=>[r(e(ae),{value:oe(t.movable_type),severity:"secondary",class:"font-bold"},null,8,["value"])]),filter:m(({filterModel:t})=>[r(e(T),{modelValue:t.value,"onUpdate:modelValue":d=>t.value=d,options:Q.value,optionLabel:"label",optionValue:"value",placeholder:e(o)("stockMovements.filter.byItemType"),class:"p-column-filter",showClear:""},null,8,["modelValue","onUpdate:modelValue","options","placeholder"])]),_:1},8,["header"])):b("",!0),k.value.includes("movable")?(c(),S(e(w),{key:1,field:"movable",header:e(o)("stockMovements.table.item"),sortable:"",style:{"min-width":"15rem"}},{body:m(({data:t})=>{var d,V,D;return[s("div",Mt,[s("span",Vt,n(be(t.movable)),1),s("span",St,n(((d=t.movable)==null?void 0:d.reference)||((V=t.movable)==null?void 0:V.tag)||((D=t.movable)==null?void 0:D.serial_number)||"N/A"),1)])]}),_:1},8,["header"])):b("",!0),k.value.includes("type")?(c(),S(e(w),{key:2,field:"type",header:e(o)("stockMovements.table.type"),sortable:"",filterField:"type",showFilterMatchModes:!1,style:{"min-width":"10rem"}},{body:m(({data:t})=>[r(e(ae),{value:e(o)(`stockMovements.movementTypes.${t.type.toLowerCase()}`),severity:_e(t.type),icon:ye(t.type),class:"uppercase text-[9px] px-2"},null,8,["value","severity","icon"])]),filter:m(({filterModel:t})=>[r(e(T),{modelValue:t.value,"onUpdate:modelValue":d=>t.value=d,options:ee.value,optionLabel:"label",optionValue:"value",placeholder:e(o)("stockMovements.filter.byType"),class:"p-column-filter",showClear:""},null,8,["modelValue","onUpdate:modelValue","options","placeholder"])]),_:1},8,["header"])):b("",!0),k.value.includes("quantity")?(c(),S(e(w),{key:3,field:"quantity",header:e(o)("stockMovements.table.quantity"),sortable:"",style:{"min-width":"8rem"},class:"text-center"},{body:m(({data:t})=>[s("span",qt,n(t.quantity),1)]),_:1},8,["header"])):b("",!0),k.value.includes("stock_at_movement")?(c(),S(e(w),{key:4,field:"stock_at_movement",header:"Stock au Mvt.",sortable:"",style:{"min-width":"8rem"},class:"text-center"},{body:m(({data:t})=>[s("span",{class:qe(["font-mono font-bold text-sm",t.stock_at_movement>0?"text-slate-700":"text-red-500"])},n(t.stock_at_movement??"N/A"),3)]),_:1})):b("",!0),k.value.includes("date")?(c(),S(e(w),{key:5,field:"date",header:e(o)("stockMovements.table.date"),sortable:"",dataType:"date",style:{"min-width":"10rem"},class:"text-center"},{body:m(({data:t})=>[s("span",Tt,n(new Date(t.date).toLocaleDateString("fr-FR",{day:"2-digit",month:"short",year:"numeric"})),1)]),filter:m(({filterModel:t})=>[r(e(ze),{modelValue:t.value,"onUpdate:modelValue":d=>t.value=d,dateFormat:"yy-mm-dd",placeholder:e(o)("stockMovements.filter.byDate"),showIcon:"",iconDisplay:"input",selectionMode:"range",manualInput:!1,class:"p-column-filter"},null,8,["modelValue","onUpdate:modelValue","placeholder"])]),_:1},8,["header"])):b("",!0),k.value.includes("source_region")?(c(),S(e(w),{key:6,field:"source_region.designation",header:e(o)("stockMovements.table.source"),sortable:"",style:{"min-width":"10rem"}},{body:m(({data:t})=>[t.source_region?(c(),_("div",Ct,[It,s("span",$t,n(t.source_region.designation),1)])):b("",!0)]),_:1},8,["header"])):b("",!0),k.value.includes("destination_region")?(c(),S(e(w),{key:7,field:"destination_region.designation",header:e(o)("stockMovements.table.destination"),sortable:"",style:{"min-width":"10rem"}},{body:m(({data:t})=>[t.destination_region?(c(),_("div",At,[Lt,s("span",Ft,n(t.destination_region.designation),1)])):b("",!0)]),_:1},8,["header"])):b("",!0),k.value.includes("user")?(c(),S(e(w),{key:8,field:"user.name",header:e(o)("stockMovements.table.user"),sortable:"",filterField:"user.name",showFilterMatchModes:!1,style:{"min-width":"12rem"}},{body:m(({data:t})=>[t.user?(c(),_("div",Ut,[r(e(Ee),{label:t.user.name[0],shape:"circle",class:"!bg-slate-900 !text-white !font-black"},null,8,["label"]),s("span",Dt,n(t.user.name),1)])):b("",!0)]),_:1},8,["header"])):b("",!0),r(e(w),{header:"Actions",alignFrozen:"right",frozen:"",class:"pr-8"},{body:m(({data:t})=>[C.value?b("",!0):(c(),_("div",jt,[N(r(e(h),{icon:"pi pi-pencil",text:"",rounded:"",onClick:d=>ue(t),class:"!text-slate-400 hover:!bg-primary-50 hover:!text-primary-600 transition-all"},null,8,["onClick"]),[[v,"Modifier",void 0,{top:!0}]]),N(r(e(h),{icon:"pi pi-trash",text:"",rounded:"",onClick:d=>pe(t),class:"!text-slate-400 hover:!bg-red-50 hover:!text-red-500 transition-all"},null,8,["onClick"]),[[v,"Supprimer",void 0,{top:!0}]])]))]),_:1})]),_:1},8,["value","rows","selection","totalRecords","loading","first","sortField","sortOrder","filters","currentPageReportTemplate"])]),r(e(Re),{ref_key:"op",ref:X,appendTo:"body",id:"column_op",class:"p-4"},{default:m(()=>[s("h4",Ot,n(e(o)("common.customize_columns")),1),r(e(Be),{modelValue:k.value,"onUpdate:modelValue":a[11]||(a[11]=t=>k.value=t),options:ie.value,optionLabel:"header",optionValue:"field",placeholder:e(o)("common.selectColumns"),display:"chip",class:"w-full max-w-xs"},null,8,["modelValue","options","placeholder"])]),_:1},512),r(e(Fe),{visible:L.value,"onUpdate:visible":a[21]||(a[21]=t=>L.value=t),modal:"",header:!1,closable:!1,style:{width:"55rem"},class:"quantum-dialog",pt:{mask:{style:"backdrop-filter: blur(6px)"},content:{class:"p-0 rounded-3xl border-none shadow-2xl"}}},{footer:m(()=>[s("div",Ds,[r(e(h),{label:e(o)("common.cancel"),icon:"pi pi-times",text:"",severity:"secondary",onClick:se,class:"font-bold uppercase text-[10px] tracking-widest"},null,8,["label"]),r(e(h),{label:e(o)("common.save"),icon:"pi pi-check-circle",severity:"primary",class:"px-10 h-14 rounded-2xl shadow-xl shadow-primary-100 font-black uppercase tracking-widest text-xs",onClick:me,loading:e(i).processing},null,8,["label","loading"])])]),default:m(()=>[s("div",Nt,[s("div",Pt,[Et,s("div",Rt,[s("h2",zt,n(fe.value),1),s("span",Bt,n(C.value?e(o)("stockMovements.dialog.editSubtitle"):e(o)("stockMovements.dialog.createSubtitle")),1)])]),r(e(h),{icon:"pi pi-times",variant:"text",severity:"secondary",rounded:"",onClick:se,class:"text-white hover:bg-white/10"})]),s("div",Kt,[s("div",Ht,[s("div",Qt,[s("h4",Gt,[Wt,G(" "+n(e(o)("stockMovements.dialog.detailsValidation")),1)]),s("div",Zt,[s("label",Jt,n(e(o)("stockMovements.form.movementType")),1),r(e(De),{modelValue:e(i).type,"onUpdate:modelValue":a[12]||(a[12]=t=>e(i).type=t),options:ee.value,optionLabel:"label",optionValue:"value",class:"v16-select-button"},null,8,["modelValue","options"])]),s("div",Xt,[e(i).type==="exit"||e(i).type==="transfer"?(c(),_("div",Yt,[s("label",es,n(e(o)("stockMovements.form.sourceRegion")),1),r(e(T),{modelValue:e(i).source_region_id,"onUpdate:modelValue":a[13]||(a[13]=t=>e(i).source_region_id=t),options:x.regions,optionLabel:"designation",optionValue:"id",placeholder:e(o)("stockMovements.form.sourceRegionPlaceholder"),class:"w-full quantum-input-v16"},null,8,["modelValue","options","placeholder"])])):b("",!0),e(i).type==="entry"||e(i).type==="transfer"?(c(),_("div",ts,[s("label",ss,n(e(o)("stockMovements.form.destinationRegion")),1),r(e(T),{modelValue:e(i).destination_region_id,"onUpdate:modelValue":a[14]||(a[14]=t=>e(i).destination_region_id=t),options:x.regions,optionLabel:"designation",optionValue:"id",placeholder:e(o)("stockMovements.form.destinationRegionPlaceholder"),class:"w-full quantum-input-v16"},null,8,["modelValue","options","placeholder"])])):b("",!0)]),s("div",os,[s("label",ls,n(e(o)("stockMovements.form.responsibleUser")),1),r(e(T),{modelValue:e(i).responsible_user_id,"onUpdate:modelValue":a[15]||(a[15]=t=>e(i).responsible_user_id=t),options:x.users,optionLabel:"name",optionValue:"id",placeholder:e(o)("stockMovements.form.userPlaceholder"),class:"w-full quantum-input-v16",filter:""},null,8,["modelValue","options","placeholder"])]),s("div",as,[s("label",is,n(e(o)("stockMovements.form.intendedForUser")),1),r(e(T),{modelValue:e(i).intended_for_user_id,"onUpdate:modelValue":a[16]||(a[16]=t=>e(i).intended_for_user_id=t),options:x.users,optionLabel:"name",optionValue:"id",placeholder:e(o)("stockMovements.form.userPlaceholder"),class:"w-full quantum-input-v16",filter:""},null,8,["modelValue","options","placeholder"])]),s("div",ns,[s("label",rs,n(e(o)("stockMovements.form.notes")),1),r(e(Ne),{modelValue:e(i).notes,"onUpdate:modelValue":a[17]||(a[17]=t=>e(i).notes=t),rows:"2",class:"w-full text-sm quantum-input-v16"},null,8,["modelValue"])])]),s("div",ds,[s("h4",cs,[us,G(" "+n(e(o)("stockMovements.dialog.itemSelection")),1)]),s("div",ms,[s("div",ps,[s("label",vs,n(e(o)("stockMovements.form.itemType")),1),r(e(T),{modelValue:u.value.movable_type,"onUpdate:modelValue":a[18]||(a[18]=t=>u.value.movable_type=t),options:Q.value,optionLabel:"label",optionValue:"value",placeholder:e(o)("stockMovements.form.itemTypePlaceholder"),class:"w-full quantum-input-v16",disabled:z.value},null,8,["modelValue","options","placeholder","disabled"])]),s("div",fs,[s("label",bs,n(e(o)("stockMovements.form.item")),1),r(e(T),{modelValue:u.value.movable_id,"onUpdate:modelValue":a[19]||(a[19]=t=>u.value.movable_id=t),options:R.value,optionValue:"id",placeholder:e(o)("stockMovements.form.itemPlaceholder"),disabled:!u.value.movable_type||z.value,filter:"",class:"w-full quantum-input-v16",scrollHeight:"200px",panelStyle:{"max-width":"100%"}},{value:m(t=>{var d,V,D,le;return[t.value?(c(),_("div",_s,[s("span",ys,[s("span",null,n(((V=(d=R.value.find(j=>j.id===t.value))==null?void 0:d.label)==null?void 0:V.designation)||((D=R.value.find(j=>j.id===t.value))==null?void 0:D.designation)||t.value),1),e(i).type!=="entry"?(c(),_("span",xs,n(((le=R.value.find(j=>j.id===t.value))==null?void 0:le.stock_in_region)??"N/A"),1)):b("",!0)])])):(c(),_("span",gs,n(t.placeholder),1))]}),option:m(t=>{var d;return[s("div",hs,[s("div",ks,[s("span",ws,n(((d=t.option.label)==null?void 0:d.designation)||t.option.designation||"N/A"),1),e(i).type!=="entry"?(c(),_("span",Ms," Stock: "+n(t.option.stock_in_region??t.option.quantity??"N/A"),1)):b("",!0)]),s("span",Vs,n(t.option.reference||t.option.serial_number||t.option.tag||`ID: ${t.option.id}`),1)])]}),_:1},8,["modelValue","options","placeholder","disabled"])]),s("div",Ss,[s("label",qs,n(e(o)("stockMovements.form.quantity")),1),r(e(Pe),{modelValue:u.value.quantity,"onUpdate:modelValue":a[20]||(a[20]=t=>u.value.quantity=t),showButtons:"",min:1,inputClass:"font-black text-center",class:"w-full",disabled:te.value||z.value},null,8,["modelValue","disabled"])]),r(e(h),{icon:"pi pi-plus",label:e(o)("stockMovements.form.addItem"),onClick:ne,disabled:!u.value.movable_id||z.value,class:"p-button-sm"},null,8,["label","disabled"])]),s("div",Ts,[s("h4",Cs,n(e(o)("stockMovements.dialog.itemsInMovement"))+" ("+n(e(i).items.length)+")",1),s("div",Is,[(c(!0),_(Ce,null,Te(e(i).items,(t,d)=>(c(),_("div",{key:d,class:"flex items-center justify-between p-3 bg-slate-100 rounded-lg"},[s("div",null,[s("p",$s,n(de(t.item_details)),1),s("p",As,n(oe(t.movable_type)),1)]),s("div",Ls,[s("span",Fs,"x"+n(t.quantity),1),r(e(h),{icon:"pi pi-trash",class:"p-button-text p-button-danger p-button-sm",onClick:V=>re(d)},null,8,["onClick"])])]))),128)),e(i).items.length===0?(c(),_("p",Us,n(e(o)("stockMovements.dialog.noItems")),1)):b("",!0)])])])])])]),_:1},8,["visible"])])]),_:1},8,["title"])}}},mo=He(js,[["__scopeId","data-v-db479cfb"]]);export{mo as default};
