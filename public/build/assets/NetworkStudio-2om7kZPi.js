import{T as qt}from"./index-BbFIc-qF.js";import{a as At,r as b,Y as de,d as ce,_ as Bt,T as Xt,l as u,i as v,g as c,j as l,f as ne,W as De,q as Y,v as Wt,e as Se,p as w,t as k,s as j,m as N,n as D,U as B,A as R,k as Yt,o as d,$ as He,a0 as Ft}from"./app-BRAmWWDK.js";import{s as Jt}from"./index-Ci1herNU.js";import{s as $}from"./index-BLI3-ZB5.js";import{s as Ge}from"./index-FdutLImh.js";import{s as Me}from"./index-CsEuBKcf.js";import{s as le}from"./index-BN5aQcOg.js";import{s as Ke}from"./index-BMxhtlZZ.js";import{s as Ce}from"./index-BeaEkU56.js";import{s as Ze}from"./index-B0W91G3B.js";import{s as Ve}from"./index-RIg7_KOk.js";import"./index-CDA2CSiu.js";import"./index-D3aGqElX.js";import"./index-LMQAJ2bo.js";import"./index-BvqM3u8T.js";import"./index-CcU6oDqo.js";const Ht={class:"app-shell h-screen flex flex-col bg-[#020408] text-slate-300 font-sans overflow-hidden select-none"},Gt={class:"h-14 bg-[#0a0f1d] border-b border-white/5 flex items-center justify-between px-4 z-[100] shadow-xl"},Kt={key:0,class:"absolute top-4 right-4 w-80 bg-[#0a0f1d]/95 backdrop-blur-xl border border-white/10 rounded-2xl shadow-2xl z-[90] overflow-hidden"},Zt={class:"p-4 border-b border-white/5 bg-indigo-500/5 flex justify-between items-center"},Qt=l("span",{class:"text-xs font-black text-indigo-400 uppercase tracking-widest"},"Supervision Système",-1),es={class:"p-5 space-y-6"},ts={class:"text-center"},ss={class:"inline-flex relative items-center justify-center"},os={class:"w-20 h-20 transform -rotate-90"},ls=l("circle",{cx:"40",cy:"40",r:"36",stroke:"currentColor","stroke-width":"4",fill:"transparent",class:"text-slate-800"},null,-1),is=["stroke-dashoffset"],as={class:"absolute text-sm font-black font-mono"},ns=l("p",{class:"text-[10px] text-slate-500 uppercase mt-2 tracking-tighter"},"Indice de Santé Réseau",-1),rs={class:"grid grid-cols-2 gap-3"},ds={class:"bg-white/[0.03] p-3 rounded-xl border border-white/5"},cs=l("span",{class:"text-[9px] text-slate-500 block mb-1"},"COMPOSANTS",-1),us={class:"text-xl font-mono font-bold"},ps={class:"bg-white/[0.03] p-3 rounded-xl border border-white/5"},vs=l("span",{class:"text-[9px] text-slate-500 block mb-1"},"EN ALERTE",-1),fs={class:"space-y-3"},hs=l("span",{class:"text-[9px] font-bold text-slate-400 uppercase tracking-widest"},"Répartition Asset",-1),xs={class:"flex justify-between text-[10px]"},bs={class:"text-slate-400"},ms={class:"font-mono text-indigo-400"},gs={class:"h-1 bg-white/5 rounded-full overflow-hidden"},_s={class:"pt-4 border-t border-white/5"},ys=l("div",{class:"flex items-center gap-2 mb-2"},[l("span",{class:"w-1.5 h-1.5 bg-green-500 rounded-full animate-ping"}),l("span",{class:"text-[9px] text-slate-500 uppercase"},"Flux Électrique Live")],-1),ws={class:"flex justify-between items-end"},ks=l("span",{class:"text-[11px] text-slate-300 italic"},"Noeuds alimentés",-1),Ss={class:"text-lg font-mono text-green-400"},Ms={class:"flex items-center gap-4"},Cs={class:"flex items-center gap-2 px-2"},Vs=l("div",{class:"w-8 h-8 bg-indigo-600 rounded-lg flex items-center justify-center shadow-lg shadow-indigo-500/20"},[l("i",{class:"pi pi-bolt text-white text-sm"})],-1),$s={class:"flex flex-col"},Is=l("span",{class:"text-white font-bold text-xs tracking-tight"},[Yt("NEO"),l("span",{class:"text-indigo-400"},"CAD")],-1),Ns={class:"flex items-center gap-2"},Ls=l("label",{class:"text-[9px] font-bold text-slate-500 uppercase"},"Région:",-1),zs=l("div",{class:"h-6 w-px bg-white/10 mx-2"},null,-1),Es={class:"flex items-center gap-1"},Ds={class:"flex items-center gap-4"},js={class:"flex items-center gap-3 bg-black/40 px-3 py-1.5 rounded-full border border-white/5"},Rs=l("i",{class:"pi pi-search text-slate-600 text-[10px]"},null,-1),Ts={class:"text-[10px] font-mono text-indigo-400 w-8"},Us=l("div",{class:"h-4 w-px bg-white/10 mx-1"},null,-1),Os={class:"pi pi-th-large text-slate-600 text-[10px]"},Ps={class:"text-[10px] font-mono text-indigo-400 w-8"},qs={class:"flex-grow flex relative overflow-hidden"},As={class:"p-4 border-b border-white/5"},Bs={class:"relative"},Xs=l("i",{class:"pi pi-search absolute left-3 top-1/2 -translate-y-1/2 text-slate-500 text-xs"},null,-1),Ws={class:"flex-grow overflow-y-auto p-3 space-y-6 custom-scrollbar"},Ys={class:"flex items-center gap-2 mb-3 px-2"},Fs={class:"text-[9px] font-black text-slate-500 uppercase tracking-[0.2em]"},Js=l("div",{class:"flex-grow h-px bg-white/5"},null,-1),Hs={class:"grid grid-cols-1 gap-1.5"},Gs=["onDragstart","onClick"],Ks={class:"w-8 h-8 rounded-lg bg-slate-800 flex items-center justify-center group-hover:bg-indigo-600/20 transition-colors"},Zs={class:"flex flex-col overflow-hidden"},Qs={class:"text-[10px] font-bold text-slate-200 group-hover:text-white truncate"},eo={class:"text-[9px] text-slate-500 truncate lowercase"},to=["x","y","width","height"],so=l("defs",null,[l("filter",{id:"neon-glow",x:"-20%",y:"-20%",width:"140%",height:"140%"},[l("feGaussianBlur",{stdDeviation:"3",result:"blur"}),l("feComposite",{in:"SourceGraphic",in2:"blur",operator:"over"})])],-1),oo=["onMousedown"],lo=["d","onMousedown"],io=["d","stroke","stroke-width","stroke-dasharray","filter"],ao={key:0},no=["path","dur","begin"],ro=["d"],co=["onMousedown","onDblclick"],uo=["onMousedown","onDblclick","onClick"],po=["onMousedown"],vo=["onMousedown"],fo={key:1,class:"absolute -top-2 -right-2 w-6 h-6 bg-amber-500 rounded-full flex items-center justify-center shadow-lg border-2 border-[#0f172a] animate-pulse z-30"},ho=l("i",{class:"pi pi-calendar-clock text-white text-xs"},null,-1),xo=[ho],bo={key:2,class:"h-9 px-3 flex items-center justify-between border-b border-white/5 bg-white/[0.02]"},mo={class:"flex items-center gap-2"},go={class:"text-[9px] font-black text-indigo-400 bg-indigo-500/10 px-1.5 py-0.5 rounded"},_o={key:0,class:"pi pi-bolt text-amber-500 text-[10px] animate-pulse"},yo={class:"flex items-center gap-2"},wo=["onClick"],ko={key:3,class:"p-4 flex flex-col items-center justify-center text-center h-[calc(100%-36px)]"},So={class:"text-[11px] font-bold text-slate-100 leading-tight uppercase tracking-tight"},Mo={key:0,class:"mt-2 flex gap-1"},Co=l("span",{class:"w-1 h-1 bg-green-500 rounded-full animate-ping"},null,-1),Vo=l("span",{class:"text-[8px] font-mono text-green-500/70"},"ACTIVE",-1),$o=[Co,Vo],Io={key:1,class:"absolute bottom-2 left-2 flex items-center gap-1.5 bg-slate-900/50 border border-white/10 rounded-full px-2 py-0.5"},No=l("i",{class:"pi pi-map-marker text-[8px] text-amber-400"},null,-1),Lo={class:"text-[8px] font-bold text-slate-300 uppercase tracking-wider"},zo={key:4,class:"absolute inset-0 pointer-events-none overflow-hidden"},Eo={class:"absolute top-1/2 -translate-y-1/2 left-0 w-full h-0.5"},Do=["onClick"],jo=["onDblclick"],Ro=["onClick","onContextmenu"],To=l("i",{class:"pi pi-ellipsis-h text-slate-600 text-xs"},null,-1),Uo=[To],Oo=l("i",{class:"pi pi-ellipsis-h text-slate-600 text-xs"},null,-1),Po=[Oo],qo={class:"p-4"},Ao=l("div",{class:"flex items-center gap-2 mb-4"},[l("div",{class:"w-2 h-2 bg-green-500 rounded-full"}),l("span",{class:"text-[10px] font-bold text-slate-400 uppercase tracking-widest"},"Analyse Réseau")],-1),Bo={class:"space-y-3"},Xo={class:"flex justify-between"},Wo=l("span",{class:"text-[10px] text-slate-500"},"Appareils",-1),Yo={class:"text-xs font-mono font-bold"},Fo={class:"flex justify-between"},Jo=l("span",{class:"text-[10px] text-slate-500"},"Liaisons",-1),Ho={class:"text-xs font-mono font-bold text-indigo-400"},Go=l("div",{class:"flex justify-between border-t border-white/5 pt-2 mt-2"},[l("span",{class:"text-[10px] text-slate-500 italic"},"Disponibilité"),l("span",{class:"text-xs font-mono text-green-400"},"99.8%")],-1),Ko={key:0,class:"absolute top-20 left-1/2 -translate-x-1/2 bg-[#0f172a] border border-amber-500/50 rounded-xl p-3 z-[200] flex items-center gap-4 shadow-2xl animate-fade-in"},Zo=l("span",{class:"text-[10px] font-bold text-amber-500 uppercase px-2"},"Type de conducteur:",-1),Qo={class:"flex gap-1.5"},el=["onClick"],tl={class:"flex flex-col gap-5 py-2"},sl={class:"flex flex-col gap-2"},ol=l("label",{class:"text-[10px] font-black text-slate-500 uppercase tracking-tighter"},"Tag Identifiant",-1),ll={class:"flex flex-col gap-2"},il=l("label",{class:"text-[10px] font-black text-slate-500 uppercase tracking-tighter"},"Désignation Technique",-1),al={key:0,class:"flex flex-col gap-4 p-4 bg-slate-800/50 rounded-lg border border-white/10"},nl=l("label",{class:"text-[10px] font-black text-indigo-400 uppercase tracking-tighter"},"Caractéristiques",-1),rl={class:"text-[10px] font-medium text-slate-400 uppercase"},dl={class:"grid grid-cols-2 gap-2"},cl={class:"flex items-center gap-3 p-3 bg-indigo-500/5 border border-indigo-500/20 rounded-xl"},ul=l("div",{class:"flex flex-col"},[l("span",{class:"text-xs font-bold text-indigo-300"},"Point d'injection"),l("span",{class:"text-[9px] text-slate-500"},"Source d'énergie principale")],-1),pl={class:"flex flex-col gap-3 p-3 bg-white/5 border border-white/10 rounded-xl"},vl=l("label",{class:"text-[10px] font-black text-slate-500 uppercase tracking-tighter"},"Localisation",-1),fl={key:0,class:"text-center p-4 bg-amber-500/10 border border-amber-500/20 rounded-lg"},hl=l("p",{class:"text-xs text-amber-400 font-semibold"}," Veuillez d'abord sélectionner une région pour le réseau en haut de la page. ",-1),xl=[hl],bl={class:"flex flex-col gap-5 py-2"},ml={class:"flex flex-col gap-2"},gl=l("label",{class:"text-[10px] font-black text-slate-500 uppercase tracking-tighter"},"Tag Identifiant",-1),_l={class:"flex flex-col gap-2"},yl=l("label",{class:"text-[10px] font-black text-slate-500 uppercase tracking-tighter"},"Désignation Technique",-1),wl={key:0,class:"flex flex-col gap-4 p-4 bg-slate-800/50 rounded-lg border border-white/10"},kl=l("label",{class:"text-[10px] font-black text-indigo-400 uppercase tracking-tighter"},"Caractéristiques",-1),Sl={class:"text-[10px] font-medium text-slate-400 uppercase"},Ml={class:"grid grid-cols-2 gap-2"},Cl={class:"flex items-center gap-3 p-3 bg-indigo-500/5 border border-indigo-500/20 rounded-xl"},Vl=l("label",{class:"text-[10px] font-black text-slate-500 uppercase tracking-tighter"},"Statut",-1),$l={class:"flex items-center gap-3 p-3 bg-indigo-500/5 border border-indigo-500/20 rounded-xl"},Il=l("div",{class:"flex flex-col"},[l("span",{class:"text-xs font-bold text-indigo-300"},"Point d'injection"),l("span",{class:"text-[9px] text-slate-500"},"Source d'énergie principale")],-1),Nl={class:"flex flex-col gap-3 p-3 bg-white/5 border border-white/10 rounded-xl"},Ll=l("label",{class:"text-[10px] font-black text-slate-500 uppercase tracking-tighter"},"Localisation",-1),zl={key:0,class:"text-center p-4 bg-amber-500/10 border border-amber-500/20 rounded-lg"},El=l("p",{class:"text-xs text-amber-400 font-semibold"}," Veuillez d'abord sélectionner une région pour le réseau en haut de la page. ",-1),Dl=[El],jl={class:"flex flex-col gap-4 py-2"},Rl={class:"flex flex-col gap-2"},Tl=l("label",{class:"text-[10px] font-bold text-slate-500 uppercase"},"Texte",-1),Ul={class:"grid grid-cols-2 gap-4"},Ol={class:"flex flex-col gap-2"},Pl=l("label",{class:"text-[10px] font-bold text-slate-500 uppercase"},"Taille",-1),ql={class:"flex flex-col gap-2"},Al=l("label",{class:"text-[10px] font-bold text-slate-500 uppercase"},"Couleur",-1),Bl={class:"flex items-center gap-2 bg-white/5 p-2 rounded-lg border border-white/10"},Xl={class:"text-[10px] font-mono"},Wl={class:"flex flex-col gap-2"},Yl=l("label",{class:"text-[10px] font-bold text-slate-500 uppercase"},"Rotation (°)",-1),Fl={class:"flex flex-col gap-4 py-2"},Jl={class:"grid grid-cols-2 gap-4"},Hl={class:"flex flex-col gap-2"},Gl=l("label",{class:"text-[10px] font-bold text-slate-500 uppercase"},"Largeur (px)",-1),Kl={class:"flex flex-col gap-2"},Zl=l("label",{class:"text-[10px] font-bold text-slate-500 uppercase"},"Hauteur (px)",-1),Ql={class:"flex flex-col gap-2"},ei=l("label",{class:"text-[10px] font-bold text-slate-500 uppercase"},"Couleur de fond",-1),ti={class:"flex items-center gap-2 bg-white/5 p-2 rounded-lg border border-white/10"},si={class:"text-xs font-mono"},oi={class:"mt-4"},$e=220,li=400,je=1e4,Ie=130,ii=240,ai=1.8,ki={__name:"NetworkStudio",props:{initialNetwork:Object,library:{type:Object,default:()=>({})},regions:Array,zones:Array},setup(Qe){const X=Qe,se=At(),S=b(20),et=[{label:"Phase L1",value:"#ef4444",dash:"0"},{label:"Phase L2",value:"#111827",dash:"0"},{label:"Phase L3",value:"#94a3b8",dash:"0"},{label:"Neutre",value:"#3b82f6",dash:"0"},{label:"Terre",value:"#22c55e",dash:"12,6"},{label:"Commande",value:"#a855f7",dash:"5,5"}],H=b("PROJET_ELECTRIQUE_BETA_V2"),p=b([]),V=b([]),L=b([]),x=b(.85),g=b([]),F=b(null),z=b([]),Ne=b(!0),he=b(""),W=b(null),Re=b(0),Te=b(0),xe=b(!0),be=b(!0),me=b({x:window.innerWidth-240-24-256-12,y:24}),tt=b(null),ge=b({x:window.innerWidth-240-24-256-12,y:24}),st=b(null),_e=b(!1),ye=b(!1),we=b(!1),ie=b(null),q=de({w:0,h:0,color:"#334155"}),T=de({active:!1,x1:0,y1:0,x2:0,y2:0}),ke=ce(()=>Oe(T)),E=de({tag:"",designation:"",type:"",isRoot:!1,placementType:null,region_id:null,status:"en service",zone_id:null}),G=b({}),M=de({id:null,tag:"",designation:"",isRoot:!1,region_id:null,zone_id:null,status:"en service",active:!0}),ue=b(!1),ae=b(null),C=de({text:"",fontSize:14,color:"#94a3b8",bold:!1,rotation:0}),ot=()=>{ae.value=null,C.text="NOUVEAU LABEL",C.fontSize=14,C.color="#94a3b8",C.bold=!1,C.rotation=0,ue.value=!0},lt=()=>{const e=`busbar-${Date.now()}`;p.value.push({id:e,tag:"JB",designation:"Jeu de Barres",type:"Jeu de Barres",x:400,y:400,w:li,h:12,active:!0,is_busbar:!0,color:"#334155"}),P()},it=e=>{ae.value=e.id,C.text=e.text,C.fontSize=e.fontSize,C.color=e.color,C.bold=e.bold,C.rotation=e.rotation||0,ue.value=!0},h=de({active:!1,fromId:null,fromSide:null,mouseX:0,mouseY:0,currentColor:"#3b82f6",currentDash:"0"}),K=ce(()=>ii/je),at=ce(()=>{if(!W.value)return{};const e=W.value;return{width:`${e.clientWidth/x.value*K.value}px`,height:`${e.clientHeight/x.value*K.value}px`,left:`${Re.value/x.value*K.value}px`,top:`${Te.value/x.value*K.value}px`}}),nt=e=>{const t=e.currentTarget.getBoundingClientRect(),i=e.target.id==="minimap-viewport",s=n=>{let r=(n.clientX-t.left)/K.value,f=(n.clientY-t.top)/K.value;if(i){const m=W.value.clientWidth/x.value,y=W.value.clientHeight/x.value;r-=m/2,f-=y/2}W.value.scrollLeft=r*x.value,W.value.scrollTop=f*x.value};s(e);const o=n=>s(n),a=()=>{window.removeEventListener("mousemove",o),window.removeEventListener("mouseup",a)};window.addEventListener("mousemove",o),window.addEventListener("mouseup",a)},rt=e=>{Re.value=e.target.scrollLeft,Te.value=e.target.scrollTop},oe=b([]),re=b(-1),P=()=>{const e=JSON.stringify({equipments:p.value,connections:V.value,labels:L.value});re.value<oe.value.length-1&&(oe.value=oe.value.slice(0,re.value+1)),oe.value.push(e),oe.value.length>100&&oe.value.shift(),re.value=oe.value.length-1},Ue=()=>{if(re.value>0){re.value--;const e=JSON.parse(oe.value[re.value]);p.value=e.equipments,V.value=e.connections,L.value=e.labels||[]}},ee=ce(()=>{const e=new Set,t=s=>{if(e.has(s))return;const o=p.value.find(a=>a.id===s);!o||!o.active||(e.add(s),V.value.filter(a=>a.fromId===s).forEach(a=>t(a.toId)))};p.value.filter(s=>s.isRoot&&s.active).forEach(s=>t(s.id));const i=new Set(V.value.filter(s=>{var o,a;return e.has(s.fromId)&&((o=p.value.find(n=>n.id===s.toId))==null?void 0:o.is_busbar)||e.has(s.toId)&&((a=p.value.find(n=>n.id===s.fromId))==null?void 0:a.is_busbar)}).flatMap(s=>[s.fromId,s.toId]).filter(s=>{var o;return(o=p.value.find(a=>a.id===s))==null?void 0:o.is_busbar}));return{liveNodes:e,liveBusbars:i}}),Le=e=>ee.value.liveNodes.has(e.fromId)||ee.value.liveNodes.has(e.toId),te=(e,t)=>{if(!e)return{x:0,y:0};if(e.is_busbar){if(t==="N")return{x:e.x,y:e.y,w:e.w};if(t==="S")return{x:e.x,y:e.y+e.h,w:e.w}}switch(t){case"N":return{x:e.x+e.w/2,y:e.y};case"S":return{x:e.x+e.w/2,y:e.y+e.h};case"E":return{x:e.x+e.w,y:e.y+e.h/2};case"W":return{x:e.x,y:e.y+e.h/2};default:{if(typeof t=="string"&&t.startsWith("busbar-")){const[,,i]=t.split("_");return{x:e.x+parseFloat(i),y:e.y+e.h/2}}return{x:e.x,y:e.y}}}},ze=e=>{const t=p.value.find(f=>f.id===e.fromId),i=p.value.find(f=>f.id===e.toId);if(!t||!i)return"";ee.value.liveNodes.has(e.fromId)&&ee.value.liveNodes.has(e.toId);const s=ee.value.liveNodes.has(e.toId)&&!ee.value.liveNodes.has(e.fromId);let o=te(t,e.fromSide),a=te(i,e.toSide);if(t.is_busbar&&!i.is_busbar){const f=te(i,e.toSide),m=Math.max(0,Math.min(f.x-t.x,t.w));o={x:t.x+m,y:e.fromSide==="N"?t.y:t.y+t.h}}else if(i.is_busbar&&!t.is_busbar){const f=te(t,e.fromSide),m=Math.max(0,Math.min(f.x-i.x,i.w));a={x:i.x+m,y:e.toSide==="N"?i.y:i.y+i.h}}else t.is_busbar&&i.is_busbar&&(o={x:t.x+t.w/2,y:e.fromSide==="N"?t.y:t.y+t.h},a={x:i.x+i.w/2,y:e.toSide==="N"?i.y:i.y+i.h});if(s){const f=o;o=a,a=f}const n=Math.abs(a.x-o.x),r=Math.abs(a.y-o.y);if(n>r){let f=o.x+(a.x-o.x)/2;return f=Math.round(f/S.value)*S.value,`M ${o.x} ${o.y} L ${f} ${o.y} L ${f} ${a.y} L ${a.x} ${a.y}`}else{let f=o.y+(a.y-o.y)/2;return f=Math.round(f/S.value)*S.value,`M ${o.x} ${o.y} L ${o.x} ${f} L ${a.x} ${f} L ${a.x} ${a.y}`}},dt=(e,t)=>{if(!t.is_busbar||!e.altKey)return;t.customPorts||(t.customPorts=[]);const i=e.offsetX;t.customPorts.push({id:`port-${Date.now()}`,x:i})},Oe=e=>{const t=Math.min(e.x1,e.x2),i=Math.min(e.y1,e.y2),s=Math.abs(e.x1-e.x2),o=Math.abs(e.y1-e.y2);return{x:t,y:i,width:s,height:o}},ct=(e,t)=>{const i=e.x+e.w,s=e.y+e.h,o=t.x+t.width,a=t.y+t.height;return e.x<o&&i>t.x&&e.y<a&&s>t.y},ut=e=>{const t=p.value.find(a=>a.id===e.fromId),i=p.value.find(a=>a.id===e.toId);if(!t||!i)return!1;const s=te(t,e.fromSide),o=te(i,e.toSide);return s.x===o.x||s.y===o.y},pt=(e,t)=>{const i=e.x+e.text.length*(e.fontSize/2),s=e.y+e.fontSize,o=t.x+t.width,a=t.y+t.height;return e.x<o&&i>t.x&&e.y<a&&s>t.y},vt=e=>{var i;E.tag=e.tag,E.libraryId=e.id,E.designation=e.designation,E.type=((i=e.type)==null?void 0:i.category)||"Composant",E.isRoot=e.is_root!==void 0?!!e.is_root:p.value.length===0,E.region_id=null,E.status="en service",E.zone_id=null,_e.value=!0;const t={};e.characteristics&&e.characteristics.forEach(s=>{t[s.id]={value:null,date:new Date}}),G.value=t},ft=()=>{const e=`node-${Date.now()}`;p.value.push({id:e,...E,x:400,y:300,w:$e,h:Ie,active:!0,characteristics:JSON.parse(JSON.stringify(G.value))}),_e.value=!1,P()},ht=e=>{e.is_busbar&&(ie.value=e,q.w=e.w,q.h=e.h,q.color=e.color||"#334155",we.value=!0)},xt=()=>{ie.value&&(ie.value.w=q.w,ie.value.h=q.h,ie.value.color=q.color,P()),we.value=!1},bt=()=>{if(ae.value){const e=L.value.find(t=>t.id===ae.value);e&&Object.assign(e,C)}else{const e=`label-${Date.now()}`;L.value.push({id:e,...C,x:500,y:400})}ue.value=!1,ae.value=null,P()},mt=e=>{M.id=e.id,M.tag=e.tag,M.designation=e.designation,M.isRoot=e.isRoot,M.region_id=e.region_id,M.zone_id=e.zone_id,M.status=e.status||"en service",M.active=e.active!==void 0?e.active:!0,M.libraryId=e.libraryId;const t={},i=Object.values(X.library).flat().find(s=>s.id===e.libraryId);i&&i.characteristics&&i.characteristics.forEach(s=>{t[s.id]={value:null,date:new Date}}),e.characteristics&&(Array.isArray(e.characteristics)?e.characteristics.forEach(s=>{const o=s.equipment_characteristic_id;t[o]={value:s.value,date:s.date?new Date(s.date):new Date}}):Object.keys(e.characteristics).forEach(s=>{t[s]&&(t[s]={...e.characteristics[s]})})),G.value=t,ye.value=!0},gt=()=>{const e=p.value.find(t=>t.id===M.id);e&&(Object.assign(e,M),e.characteristics={...G.value},ye.value=!1,P(),se.add({severity:"success",summary:"Mise à jour réussie",detail:"Les informations du composant ont été enregistrées.",life:3e3}))},Pe=()=>{if(g.value.length){const e=g.value;p.value=p.value.filter(t=>!e.includes(t.id)),V.value=V.value.filter(t=>!e.includes(t.fromId)&&!e.includes(t.toId)),p.value.some(t=>t.isRoot),g.value=[]}if(F.value&&(V.value=V.value.filter(e=>e.id!==F.value),F.value=null),z.value.length){const e=z.value;L.value=L.value.filter(t=>!e.includes(t.id)),z.value=[]}P()},_t=()=>{const e=S.value,t=[],i=[],s=[],o=[];g.value.forEach(a=>{const n=p.value.find(r=>r.id===a);if(n){const r=JSON.parse(JSON.stringify(n));r.id=`${n.is_busbar?"busbar":"node"}-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,r.x+=e,r.y+=e,r.isRoot=!1,t.push(r),s.push(r.id)}}),z.value.forEach(a=>{const n=L.value.find(r=>r.id===a);if(n){const r={...n,id:`label-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,x:n.x+e,y:n.y+e};i.push(r),o.push(r.id)}}),(t.length>0||i.length>0)&&(p.value.push(...t),L.value.push(...i),g.value=s,z.value=o,P(),se.add({severity:"info",summary:"Duplication",detail:`${t.length+i.length} élément(s) dupliqué(s).`,life:2e3}))},yt=()=>{if(g.value.length<2)return;const e=p.value.filter(r=>g.value.includes(r.id)),t=Math.min(...e.map(r=>r.x)),i=Math.min(...e.map(r=>r.y)),s=Math.max(...e.map(r=>r.x+r.w)),o=Math.max(...e.map(r=>r.y+r.h)),a=`group-${Date.now()}`,n={id:a,tag:"GRP",designation:"Groupe de composants",icon:"pi-object-group",type:"Groupe",x:t-20,y:i-40,w:s-t+40,h:o-i+60,active:!0,isRoot:!1,isGroup:!0,children:g.value};p.value.push(n),p.value=p.value.filter(r=>!g.value.includes(r.id)),g.value=[a],P()},wt=()=>{if(p.value.length===0||!W.value)return;const e=W.value,t=e.clientWidth,i=e.clientHeight;let s=1/0,o=1/0,a=-1/0,n=-1/0;p.value.forEach(_=>{s=Math.min(s,_.x),o=Math.min(o,_.y),a=Math.max(a,_.x+_.w),n=Math.max(n,_.y+_.h)});const r=a-s,f=n-o;if(r<=0||f<=0)return;const m=.2,y=t/(r*(1+m)),Z=i/(f*(1+m)),A=Math.min(y,Z,1.5);x.value=A,Ft(()=>{const _=s+r/2,U=o+f/2;e.scrollLeft=_*A-t/2,e.scrollTop=U*A-i/2})},kt=()=>{me.value={x:window.innerWidth-240-24,y:24},ge.value={x:window.innerWidth-240-256-12-24,y:24}},qe=(e,t)=>{const i=e.clientX,s=e.clientY,o=t.value.x,a=t.value.y,n=f=>{const m=e.target.closest(".draggable-panel");if(!m)return;const y=m.offsetWidth,Z=m.offsetHeight,A=f.clientX-i,_=f.clientY-s;let U=o+A,O=a+_;U=Math.max(0,Math.min(U,window.innerWidth-y)),O=Math.max(0,Math.min(O,window.innerHeight-Z)),t.value.x=U,t.value.y=O},r=()=>{window.removeEventListener("mousemove",n),window.removeEventListener("mouseup",r)};window.addEventListener("mousemove",n),window.addEventListener("mouseup",r)},Ee=(e,t)=>{if(!h.active)h.active=!0,h.fromId=e,h.fromSide=t,g.value=[],F.value=null,z.value=[];else{if(h.fromId===e){h.active=!1;return}V.value.some(s=>s.fromId===h.fromId&&s.toId===e||s.fromId===e&&s.toId===h.fromId)?(se.add({severity:"warn",summary:"Connexion existante",detail:"Cette liaison existe déjà.",life:2e3}),h.active=!1):(V.value.push({id:`conn-${Date.now()}`,fromId:h.fromId,fromSide:h.fromSide,toId:e,toSide:t,color:h.currentColor,dash:h.currentDash}),h.active=!1,P())}},St=(e,t)=>{if(!e.is_busbar||!e.customPorts)return;const i=e.customPorts.findIndex(s=>s.id===t);i>-1&&(e.customPorts.splice(i,1),P())},Ae=(e,t,i="node")=>{if(h.active)return;Ct(e,t,i);const s=e.clientX,o=e.clientY,a=i==="node"&&g.value.includes(t.id)||i==="label"&&z.value.includes(t.id);let n=[];a?(n.push(...p.value.filter(y=>g.value.includes(y.id))),n.push(...L.value.filter(y=>z.value.includes(y.id)))):n.push(t);const r=n.map(y=>({id:y.id,x:y.x,y:y.y,type:y.text===void 0?"node":"label"})),f=y=>{const Z=(y.clientX-s)/x.value,A=(y.clientY-o)/x.value;r.forEach(_=>{const U=i==="node"?p.value.find(O=>O.id===_.id):L.value.find(O=>O.id===_.id);U&&(U.x=Math.round((_.x+Z)/S.value)*S.value,U.y=Math.round((_.y+A)/S.value)*S.value)})},m=()=>{window.removeEventListener("mousemove",f),window.removeEventListener("mouseup",m),P()};window.addEventListener("mousemove",f),window.addEventListener("mouseup",m)},Be=(e,t,i)=>{e.stopPropagation();const s=e.clientX,o=e.clientY,a=t.x,n=t.y,r=t.w,f=t.h;let m={w:S.value,h:S.value};if(t.is_busbar){const A=V.value.filter(_=>_.fromId===t.id||_.toId===t.id);if(A.length>0){const _=A.map(Q=>{const Ut=Q.fromId===t.id?Q.toId:Q.fromId,Fe=p.value.find(Pt=>Pt.id===Ut);if(!Fe)return{x:0,y:0};const Ot=Q.fromId===t.id?Q.toSide:Q.fromSide,Je=te(Fe,Ot);return{x:Je.x-t.x,y:Je.y-t.y}}),U=Math.min(..._.map(Q=>Q.x)),O=Math.max(..._.map(Q=>Q.x));m.w=Math.max(S.value,O-U)}}const y=A=>{const _=(A.clientX-s)/x.value,U=(A.clientY-o)/x.value;if(i.includes("e")&&(t.w=Math.max(m.w,r+_)),i.includes("s")&&(t.h=Math.max(m.h,f+U)),i.includes("w")){const O=r-_;O>m.w&&(t.x=a+_,t.w=O)}if(i.includes("n")){const O=f-U;O>m.h&&(t.y=n+U,t.h=O)}},Z=()=>window.removeEventListener("mousemove",y);window.addEventListener("mousemove",y),window.addEventListener("mouseup",Z,{once:!0})};let Xe=null,pe=0;const Mt=(e,t)=>{pe++,pe===1?Xe=setTimeout(()=>{pe=0},400):pe===3&&(clearTimeout(Xe),pe=0,ht(t))},Ct=(e,t,i)=>{if(i==="node")if(z.value=[],F.value=null,e.shiftKey){const s=g.value.indexOf(t.id);s>-1?g.value.splice(s,1):g.value.push(t.id)}else g.value.includes(t.id)||(g.value=[t.id]);else if(i==="label")if(g.value=[],F.value=null,e.shiftKey){const s=z.value.indexOf(t.id);s>-1?z.value.splice(s,1):z.value.push(t.id)}else z.value.includes(t.id)||(z.value=[t.id])},Vt=e=>{if(e.target.closest(".node-container, .p-button"))return;g.value=[],F.value=null,z.value=[];const t=e.currentTarget.getBoundingClientRect();T.active=!0,T.x1=(e.clientX-t.left)/x.value,T.y1=(e.clientY-t.top)/x.value,T.x2=T.x1,T.y2=T.y1},$t=e=>{if(!e){fe.value=null,H.value="Nouveau Projet",I.region_id=null,p.value=[{id:"root-0",tag:"G1",designation:"Arrivée réseau générale",icon:"pi-bolt",type:"Source",x:200,y:200,w:$e,h:Ie,active:!0,isRoot:!0}],V.value=[],L.value=[],x.value=.85;return}fe.value=e.id,H.value=e.name,I.region_id=e.region_id,x.value=parseFloat(e.zoom_level)||.85,p.value=(e.nodes||[]).map(t=>{const i=t.equipment||{},s=i.equipment_type||{};return{...t,id:t.id,libraryId:i.id,tag:i.tag||`ID-${t.id}`,designation:i.designation||"Équipement Standard",icon:s.icon||"pi-box",type:s.name||"Composant",x:parseFloat(t.x),y:parseFloat(t.y),w:parseFloat(t.w)||$e,h:parseFloat(t.h)||Ie,active:t.is_active!==void 0?t.is_active?1:0:1,isRoot:!!t.is_root,region_id:t.region_id,zone_id:t.zone_id,characteristics:t.characteristics||{},next_maintenance_date:t.next_maintenance_date}}),V.value=(e.connections||[]).map(t=>({id:t.id,fromId:t.from_node_id,fromSide:t.from_side,toId:t.to_node_id,toSide:t.to_side,color:t.color||"#3b82f6",dash:t.dash_array||"0"})),L.value=e.labels||[]},We=e=>{var t;return e.zone_id?(t=X.zones.find(i=>i.id===e.zone_id))==null?void 0:t.nomenclature:"N/A"};Bt(()=>{$t(X.initialNetwork),P(),window.addEventListener("keydown",e=>{(e.key==="Delete"||e.key==="Backspace")&&e.target.tagName!=="INPUT"&&Pe(),e.ctrlKey&&e.key==="z"&&(e.preventDefault(),Ue()),e.ctrlKey&&e.key==="v"&&(e.preventDefault(),_t())})});const It=ce(()=>{if(!he.value)return X.library;const e=he.value.toLowerCase(),t={};for(const[i,s]of Object.entries(X.library)){const o=s.filter(a=>a.designation.toLowerCase().includes(e)||a.tag.toLowerCase().includes(e));o.length&&(t[i]=o)}return t}),Nt=e=>{if(h.active){const t=document.getElementById("canvas-svg").getBoundingClientRect();h.mouseX=(e.clientX-t.left)/x.value,h.mouseY=(e.clientY-t.top)/x.value}if(T.active&&e.currentTarget){const t=e.currentTarget.getBoundingClientRect();T.x2=(e.clientX-t.left)/x.value,T.y2=(e.clientY-t.top)/x.value}},Lt=()=>{if(T.active){T.active=!1;const e=Oe(T);e.width>5&&e.height>5&&(g.value=p.value.filter(t=>ct(t,e)).map(t=>t.id),z.value=L.value.filter(t=>pt(t,e)).map(t=>t.id))}},ve=b(!1),J=ce(()=>{const e=p.value.length;if(e===0)return null;const t=p.value.reduce((a,n)=>(a[n.type]=(a[n.type]||0)+1,a),{}),i=p.value.filter(a=>a.status==="online").length,s=p.value.filter(a=>a.status==="error").length,o=Math.round(i/e*100);return{total:e,categories:t,healthScore:o,inAlert:s,connections:V.value.length,energized:ee.value.size}}),zt=()=>{const e={name:H.value,region_id:I.region_id,version:(parseFloat(H.version||"1.9")+.1).toFixed(1),date:new Date().toISOString(),equipments:p.value,connections:V.value,labels:L.value},t=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),i=URL.createObjectURL(t),s=document.createElement("a");s.href=i,s.download=`${H.value.replace(/\s+/g,"_")}_export.json`,s.click(),URL.revokeObjectURL(i),se.add({severity:"success",summary:"Export réussi",detail:"Fichier JSON téléchargé",life:3e3})},Et=()=>document.getElementById("import-file").click(),Dt=e=>{const t=e.target.files[0];if(!t)return;const i=new FileReader;i.onload=s=>{try{const o=JSON.parse(s.target.result);p.value=o.equipments||[],V.value=o.connections||[],L.value=o.labels||[],H.value=o.name||"PROJET_IMPORTE",P(),se.add({severity:"info",summary:"Importation",detail:"Le projet a été chargé",life:3e3})}catch{se.add({severity:"error",summary:"Erreur",detail:"Fichier JSON invalide",life:3e3})}},i.readAsText(t)},I=Xt({id:null,name:H.value,region_id:null,zoom_level:x.value,version:"2.0",date:new Date,equipments:[],connections:[],labels:[]}),fe=b(null),jt=()=>{console.log(I),I.name=H.value,I.region_id=I.region_id,I.zoom_level=x.value,I.equipments=p.value,I.connections=V.value,I.labels=L.value;const e=!!fe.value,t=e?route("networks.update",fe.value):route("networks.store");I.transform(i=>{const s=new FormData;e&&s.append("_method","PUT");for(const o in i){if(["equipments","connections","labels"].includes(o))continue;const a=i[o];a instanceof Date?s.append(o,a.toISOString().split("T")[0]):a!=null&&s.append(o,a)}return i.equipments.forEach((o,a)=>{Object.keys(o).forEach(n=>{if(e&&typeof o.id=="number"&&(s.append(`equipments[${a}][nodeId]`,o.id??""),s.append(`equipments[${a}][zone_id]`,o.zone_id??""),s.append(`equipments[${a}][is_root]`,o.isRoot?1:0)),n==="characteristics"){const r=o[n]||{};Object.keys(r).map(m=>({equipment_characteristic_id:m,equipment_id:o.libraryId,value:r[m].value,date:r[m].date?new Date(r[m].date).toISOString().slice(0,19).replace("T"," "):null})).forEach((m,y)=>{for(const Z in m)s.append(`equipments[${a}][characteristics][${y}][${Z}]`,m[Z]??"")})}else(n==="zone_id"||n==="region_id")&&(o[n]===null||o[n]===void 0)?s.append(`equipments[${a}][${n}]`,""):s.append(`equipments[${a}][${n}]`,o[n]??"")})}),i.connections.forEach((o,a)=>{Object.keys(o).forEach(n=>{s.append(`connections[${a}][${n}]`,o[n]??"")})}),i.labels.forEach((o,a)=>{Object.keys(o).forEach(n=>{s.append(`labels[${a}][${n}]`,o[n]??"")})}),s}).submit("post",t,{forceFormData:!0,onSuccess:i=>{var s;!e&&((s=i.props.flash)!=null&&s.id)&&(fe.value=i.props.flash.id),se.add({severity:"success",summary:"Sauvegarde Cloud",detail:e?"Projet mis à jour":"Projet créé avec succès",life:3e3})},onError:i=>{const s=Object.values(i).flat().join(" ; ");se.add({severity:"error",summary:"Erreur de sauvegarde",detail:s||"Veuillez vérifier les champs",life:5e3})}})},Ye=e=>{var t,i;for(const s in X.library)for(const o of X.library[s]){const a=(t=o.characteristics)==null?void 0:t.find(n=>n.id==e);if(a)return a.name}if((i=X.initialNetwork)!=null&&i.nodes){for(const s of X.initialNetwork.nodes)if(s.characteristics){const o=s.characteristics.find(a=>a.equipment_characteristic_id==e);if(o&&o.equipment_characteristic)return o.equipment_characteristic.name}}return`Caractéristique ${e}`},Rt=(e,t)=>{e.dataTransfer.setData("application/json",JSON.stringify(t)),e.dataTransfer.effectAllowed="copy"},Tt=e=>{var r;e.preventDefault();const t=e.dataTransfer.getData("application/json");if(!t)return;const i=JSON.parse(t),s=W.value.getBoundingClientRect(),o=(e.clientX-s.left)/x.value+W.value.scrollLeft/x.value,a=(e.clientY-s.top)/x.value+W.value.scrollTop/x.value,n=`node-${Date.now()}`;p.value.push({id:n,libraryId:i.id,tag:i.tag,designation:i.designation,type:((r=i.type)==null?void 0:r.category)||"Composant",x:Math.round(o/S.value)*S.value,y:Math.round(a/S.value)*S.value,w:$e,h:Ie,active:!0,isRoot:!1}),P()};return(e,t)=>{const i=qt;return d(),u("div",Ht,[v(c(Jt)),l("header",Gt,[v(De,{name:"slide-fade"},{default:ne(()=>[ve.value&&J.value?(d(),u("div",Kt,[l("div",Zt,[Qt,l("i",{class:"pi pi-times cursor-pointer text-slate-500 hover:text-white",onClick:t[0]||(t[0]=s=>ve.value=!1)})]),l("div",es,[l("div",ts,[l("div",ss,[(d(),u("svg",os,[ls,l("circle",{cx:"40",cy:"40",r:"36",stroke:"currentColor","stroke-width":"4",fill:"transparent","stroke-dasharray":226,"stroke-dashoffset":226-226*J.value.healthScore/100,class:j(["transition-all duration-1000",J.value.healthScore>80?"text-green-500":"text-amber-500"])},null,10,is)])),l("span",as,k(J.value.healthScore)+"%",1)]),ns]),l("div",rs,[l("div",ds,[cs,l("span",us,k(J.value.total),1)]),l("div",ps,[vs,l("span",{class:j(["text-xl font-mono font-bold",J.value.inAlert>0?"text-red-500":"text-slate-200"])},k(J.value.inAlert),3)])]),l("div",fs,[hs,(d(!0),u(N,null,D(J.value.categories,(s,o)=>(d(),u("div",{key:o,class:"space-y-1"},[l("div",xs,[l("span",bs,k(o),1),l("span",ms,k(s),1)]),l("div",gs,[l("div",{class:"h-full bg-indigo-500 transition-all duration-700",style:B({width:s/J.value.total*100+"%"})},null,4)])]))),128))]),l("div",_s,[ys,l("div",ws,[ks,l("span",Ss,k(J.value.energized)+" / "+k(J.value.total),1)])])])])):w("",!0)]),_:1}),l("div",Ms,[l("div",Cs,[Vs,l("div",$s,[Is,Y(l("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>H.value=s),class:"bg-transparent border-none text-[9px] text-slate-500 outline-none w-32"},null,512),[[Wt,H.value]])])]),l("div",Ns,[Ls,v(c(Ce),{modelValue:c(I).region_id,"onUpdate:modelValue":t[2]||(t[2]=s=>c(I).region_id=s),options:X.regions,optionLabel:"designation",optionValue:"id",placeholder:"Choisir Région",class:"!w-48 dark-dropdown-header"},null,8,["modelValue","options"])]),zs,l("div",Es,[Y(v(c($),{icon:"pi pi-undo",onClick:Ue,class:"p-button-text p-button-sm !text-slate-400 hover:!text-white"},null,512),[[i,"Annuler (Ctrl+Z)"]]),v(c($),{icon:"pi pi-tag",label:"Label",onClick:ot,class:"p-button-text p-button-sm !text-slate-400"}),v(c($),{icon:"pi pi-minus",label:"Jeu de Barre",onClick:lt,class:"p-button-text p-button-sm !text-slate-400"}),v(c($),{icon:"pi pi-save",label:"Enregistre",onClick:jt,class:"p-button-text p-button-sm !text-indigo-400"}),v(c($),{icon:"pi pi-download",label:"Export JSON",onClick:zt,class:"p-button-text p-button-sm !text-slate-400"}),l("input",{type:"file",id:"import-file",class:"hidden",accept:".json",onChange:Dt},null,32),v(c($),{icon:"pi pi-upload",label:"Importer",onClick:Et,class:"p-button-text p-button-sm !text-slate-400"}),g.value.length>1?Y((d(),Se(c($),{key:0,icon:"pi pi-object-group",onClick:yt,class:"p-button-text p-button-sm !text-amber-400"},null,512)),[[i,"Grouper la sélection",void 0,{bottom:!0}]]):w("",!0),g.value.length>0||F.value||e.selectedLabelId?(d(),Se(c($),{key:1,icon:"pi pi-trash",onClick:Pe,severity:"danger",class:"p-button-text p-button-sm animate-pulse"})):w("",!0)])]),l("div",Ds,[l("div",js,[Rs,v(c(Ge),{modelValue:x.value,"onUpdate:modelValue":t[3]||(t[3]=s=>x.value=s),min:.1,max:3,step:.01,class:"w-24"},null,8,["modelValue"]),l("span",Ts,k(Math.round(x.value*100))+"%",1),Us,Y(l("i",Os,null,512),[[i,"Taille de la grille",void 0,{bottom:!0}]]),v(c(Ge),{modelValue:S.value,"onUpdate:modelValue":t[4]||(t[4]=s=>S.value=s),min:5,max:50,step:5,class:"w-24"},null,8,["modelValue"]),l("span",Ps,k(S.value)+"px",1),Y(v(c($),{icon:"pi pi-map",onClick:t[5]||(t[5]=s=>xe.value=!xe.value),class:j(["p-button-text p-button-sm",xe.value?"!text-indigo-400":"!text-slate-500"])},null,8,["class"]),[[i,"Afficher le mini-plan",void 0,{bottom:!0}]]),Y(v(c($),{icon:"pi pi-arrows-alt",onClick:wt,class:"p-button-text p-button-sm !text-slate-400"},null,512),[[i,"Centrer la vue",void 0,{bottom:!0}]]),Y(v(c($),{icon:"pi pi-window-maximize",onClick:kt,class:"p-button-text p-button-sm !text-slate-400"},null,512),[[i,"Réinitialiser la position des panneaux",void 0,{bottom:!0}]]),Y(v(c($),{icon:"pi pi-info-circle",onClick:t[6]||(t[6]=s=>be.value=!be.value),class:j(["p-button-text p-button-sm",be.value?"!text-indigo-400":"!text-slate-500"])},null,8,["class"]),[[i,"Afficher l'analyse réseau",void 0,{bottom:!0}]])]),v(c($),{icon:"pi pi-bars",onClick:t[7]||(t[7]=s=>Ne.value=!Ne.value),class:"p-button-text p-button-secondary"}),v(c($),{icon:"pi pi-chart-bar",label:"Statistiques",onClick:t[8]||(t[8]=s=>ve.value=!ve.value),class:j(["p-button-text p-button-sm transition-all",ve.value?"!text-indigo-400 bg-indigo-500/10":"!text-slate-400"])},null,8,["class"])])]),l("div",qs,[l("aside",{class:j(["bg-[#0a0f1d] border-r border-white/5 flex flex-col z-50 transition-all duration-300",Ne.value?"w-72":"w-0 overflow-hidden"])},[l("div",As,[l("div",Bs,[Xs,v(c(le),{modelValue:he.value,"onUpdate:modelValue":t[9]||(t[9]=s=>he.value=s),placeholder:"Rechercher...",class:"w-full pl-9 bg-black/20 border-white/10 text-xs py-2 rounded-lg"},null,8,["modelValue"])])]),l("div",Ws,[(d(!0),u(N,null,D(It.value,(s,o)=>(d(),u("div",{key:o},[l("div",Ys,[l("span",Fs,k(o),1),Js]),l("div",Hs,[(d(!0),u(N,null,D(s,a=>{var n;return d(),u("div",{key:a.id,draggable:"true",onDragstart:r=>Rt(r,a),onClick:r=>vt(a),class:"group flex items-center gap-3 p-2.5 bg-white/[0.02] hover:bg-indigo-500/10 border border-white/5 hover:border-indigo-500/50 rounded-xl cursor-grab transition-all"},[l("div",Ks,[l("i",{class:j(["pi",((n=a.type)==null?void 0:n.icon)||"pi-box","text-slate-500 group-hover:text-indigo-400"])},null,2)]),l("div",Zs,[l("span",Qs,k(a.tag),1),l("span",eo,k(a.designation),1)])],40,Gs)}),128))])]))),128))])],2),l("main",{ref_key:"mainContainer",ref:W,class:"flex-grow relative overflow-auto custom-scrollbar",style:B({"background-image":"radial-gradient(rgba(255, 255, 255, 0.05) 1px, transparent 1px)","background-size":`${S.value}px ${S.value}px`}),onMousemove:Nt,onMousedown:Vt,onScroll:rt,onMouseup:Lt,onDragover:t[13]||(t[13]=R(()=>{},["prevent"])),onDrop:Tt},[l("div",{style:B({transform:`scale(${x.value})`,transformOrigin:"0 0"}),class:"absolute inset-0 transition-transform duration-75"},[(d(),u("svg",{id:"canvas-svg",width:je,height:je,class:"absolute inset-0 pointer-events-none"},[T.active?(d(),u("rect",{key:0,x:ke.value.x,y:ke.value.y,width:ke.value.width,height:ke.value.height,fill:"rgba(99, 102, 241, 0.1)",stroke:"rgba(99, 102, 241, 0.5)","stroke-width":"1"},null,8,to)):w("",!0),so,(d(!0),u(N,null,D(V.value,s=>(d(),u("g",{key:s.id,class:"pointer-events-auto cursor-pointer",onMousedown:R(o=>{F.value=s.id,g.value=[]},["stop"])},[l("path",{d:ze(s),stroke:"transparent","stroke-width":"12",fill:"none",onMousedown:R(o=>F.value=s.id,["stop"])},null,40,lo),l("path",{d:ze(s),stroke:Le(s)?s.color:ut(s)?"#FFFFFF":"#1e293b","stroke-width":F.value===s.id?4:2,"stroke-dasharray":s.dash,fill:"none",class:"transition-all duration-500",filter:Le(s)?"url(#neon-glow)":""},null,8,io),Le(s)?(d(),u("g",ao,[(d(),u(N,null,D(3,o=>l("circle",{key:o,r:"2.5",fill:"#fff",class:"electron-glow"},[l("animateMotion",{path:ze(s),dur:ai+"s",begin:(o-1)*.6+"s",repeatCount:"indefinite"},null,8,no)])),64))])):w("",!0)],40,oo))),128)),h.active?(d(),u("path",{key:1,d:`M ${te(p.value.find(s=>s.id===h.fromId),h.fromSide).x}
                        ${te(p.value.find(s=>s.id===h.fromId),h.fromSide).y}
                        L ${h.mouseX} ${h.mouseY}`,stroke:"#fbbf24","stroke-width":"2","stroke-dasharray":"4,4",fill:"none"},null,8,ro)):w("",!0)])),(d(!0),u(N,null,D(L.value,s=>(d(),u("div",{key:s.id,style:B({left:s.x+"px",top:s.y+"px",color:s.color,fontSize:s.fontSize+"px",fontWeight:s.bold?"bold":"normal",transform:`rotate(${s.rotation||0}deg)`}),onMousedown:R(o=>Ae(o,s,"label"),["stop"]),onDblclick:R(o=>it(s),["stop"]),class:j(["absolute z-10 px-2 py-1 cursor-move whitespace-nowrap border border-transparent hover:border-white/10 rounded",z.value.includes(s.id)?"!border-indigo-500 bg-indigo-500/10":""])},k(s.text),47,co))),128)),(d(!0),u(N,null,D(p.value,s=>(d(),u("div",{key:s.id,style:B({left:s.x+"px",top:s.y+"px",width:s.w+"px",height:s.h+"px"}),onMousedown:R(o=>{Ae(o,s,"node"),dt(o,s)},["stop"]),onDblclick:o=>!s.is_busbar&&mt(s),onClick:o=>s.is_busbar&&Mt(o,s),class:"absolute z-20 node-container group"},[l("div",{class:j(["relative w-full h-full border-4 rounded-2xl transition-all shadow-xl",g.value.includes(s.id)?"border-indigo-500 shadow-indigo-500/20":"border-transparent",s.active?"":"opacity-50",s.isGroup?"bg-indigo-900/20":"",s.is_busbar?"bg-slate-900":"bg-[#0f172a]"]),style:B(s.is_busbar?{"background-image":`linear-gradient(to right, ${s.color}, #1e293b)`,"border-color":s.color}:{})},[s.is_busbar&&g.value.includes(s.id)?(d(),u(N,{key:0},[(d(),u(N,null,D(["e","w"],o=>l("div",{key:o,class:j(["absolute bg-indigo-500 border-2 border-white rounded-full w-3 h-3 z-40 cursor-ew-resize","top-1/2 -translate-y-1/2",o==="w"?"-left-1.5":"-right-1.5"]),onMousedown:R(a=>Be(a,s,o),["stop"])},null,42,po)),64)),(d(),u(N,null,D(["n","s"],o=>l("div",{key:o,class:j(["absolute bg-indigo-500 border-2 border-white rounded-full w-3 h-3 z-40 cursor-ns-resize","left-1/2 -translate-x-1/2",o==="n"?"-top-1.5":"-bottom-1.5"]),onMousedown:R(a=>Be(a,s,o),["stop"])},null,42,vo)),64))],64)):w("",!0),s.next_maintenance_date?Y((d(),u("div",fo,xo)),[[i,`Maintenance planifiée le ${new Date(s.next_maintenance_date).toLocaleDateString("fr-FR")}`,void 0,{top:!0}]]):w("",!0),s.is_busbar?w("",!0):(d(),u("div",bo,[l("div",mo,[l("span",go,k(s.tag),1),s.isRoot?(d(),u("i",_o)):w("",!0)]),l("div",yo,[l("i",{onClick:R(o=>s.active=!s.active,["stop"]),class:j(["pi pi-power-off text-[10px] cursor-pointer hover:scale-110",s.active?"text-green-500":"text-slate-500"])},null,10,wo),l("i",{class:j(["pi",s.icon,"text-slate-500 text-[10px]"])},null,2)])])),s.is_busbar?w("",!0):(d(),u("div",ko,[l("span",So,k(s.designation),1),ee.value.liveNodes.has(s.id)?(d(),u("div",Mo,$o)):w("",!0),We(s)?(d(),u("div",Io,[No,l("span",Lo,k(We(s)),1)])):w("",!0)])),s.is_busbar&&ee.value.liveBusbars.has(s.id)?(d(),u("div",zo,[l("div",Eo,[(d(),u(N,null,D(15,o=>l("div",{key:o,class:"absolute w-1 h-1 bg-white rounded-full electron-glow",style:B({animation:`flow-right ${2+Math.random()}s linear infinite`,animationDelay:`${Math.random()*2}s`,"--bus-width":`${s.w}px`})},null,4)),64))])])):w("",!0),s.is_busbar?w("",!0):(d(),u(N,{key:5},D(["N","S","E","W"],o=>l("div",{key:o,onClick:R(a=>Ee(s.id,o),["stop"]),class:j(["absolute w-4 h-4 rounded-full border-2 border-[#020408] z-30 transition-all cursor-crosshair opacity-0 group-hover:opacity-100 scale-75 hover:scale-125",o==="N"?"-top-2 left-1/2 -translate-x-1/2":"",o==="S"?"-bottom-2 left-1/2 -translate-x-1/2":"",o==="E"?"-right-2 top-1/2 -translate-y-1/2":"",o==="W"?"-left-2 top-1/2 -translate-y-1/2":"",h.fromId===s.id&&h.fromSide===o?"bg-amber-400 !opacity-100 animate-bounce":"bg-slate-700 hover:bg-indigo-500"])},null,10,Do)),64)),s.is_busbar?(d(),u(N,{key:6},D(["N","S"],o=>l("div",{key:o,onDblclick:R(a=>Ee(s.id,o),["stop"]),class:j(["absolute w-full h-1/2 cursor-crosshair",o==="N"?"top-0":"bottom-0","hover:bg-indigo-500/20"])},null,42,jo)),64)):w("",!0),s.is_busbar&&s.customPorts?(d(!0),u(N,{key:7},D(s.customPorts,o=>Y((d(),u("div",{key:o.id,onClick:R(a=>Ee(s.id,`custom_${o.id}`),["stop"]),onContextmenu:R(a=>St(s,o.id),["prevent","stop"]),style:B({left:o.x+"px"}),class:"absolute top-1/2 -translate-x-1/2 -translate-y-1/2 w-3 h-3 bg-sky-500 rounded-full border-2 border-slate-900 cursor-crosshair hover:scale-125 transition-transform z-30"},null,44,Ro)),[[i,"Clic droit pour supprimer",void 0,{top:!0}]])),128)):w("",!0)],6)],44,uo))),128))],4),v(De,{name:"slide-fade"},{default:ne(()=>[xe.value?(d(),u("div",{key:0,ref_key:"minimapPanel",ref:tt,style:B({left:me.value.x+"px",top:me.value.y+"px"}),class:"absolute w-60 bg-[#0a0f1d]/80 backdrop-blur-md border border-white/10 rounded-2xl shadow-2xl z-[80] overflow-hidden flex flex-col draggable-panel"},[l("div",{onMousedown:t[10]||(t[10]=R(s=>qe(s,me.value),["stop"])),class:"h-6 bg-black/20 cursor-move flex items-center justify-center"},Uo,32),l("div",{class:"relative w-full h-48",onMousedown:R(nt,["stop"])},[(d(!0),u(N,null,D(p.value,s=>(d(),u("div",{key:"mini-"+s.id,style:B({left:`${s.x*K.value}px`,top:`${s.y*K.value}px`,width:`${s.w*K.value}px`,height:`${s.h*K.value}px`,backgroundColor:g.value.includes(s.id)?"var(--indigo-500)":"rgba(255,255,255,0.2)"}),class:"absolute rounded-[2px] transition-colors"},null,4))),128)),l("div",{id:"minimap-viewport",style:B(at.value),class:"absolute bg-red-500/30 border-2 border-red-500 rounded cursor-grab"},null,4)],32)],4)):w("",!0)]),_:1}),v(De,{name:"slide-fade"},{default:ne(()=>[be.value?(d(),u("div",{key:0,ref_key:"analysisPanel",ref:st,style:B({left:ge.value.x+"px",top:ge.value.y+"px"}),class:"absolute w-64 bg-[#0a0f1d]/80 backdrop-blur-md border border-white/5 rounded-2xl shadow-2xl z-[80] flex flex-col draggable-panel"},[l("div",{onMousedown:t[11]||(t[11]=R(s=>qe(s,ge.value),["stop"])),class:"h-6 bg-black/20 cursor-move flex items-center justify-center"},Po,32),l("div",qo,[Ao,l("div",Bo,[l("div",Xo,[Wo,l("span",Yo,k(p.value.length),1)]),l("div",Fo,[Jo,l("span",Ho,k(V.value.length),1)]),Go])])],4)):w("",!0)]),_:1}),h.active?(d(),u("div",Ko,[Zo,l("div",Qo,[(d(),u(N,null,D(et,s=>l("div",{key:s.value,onClick:o=>{h.currentColor=s.value,h.currentDash=s.dash},style:B({backgroundColor:s.value}),class:j(["w-5 h-5 rounded-full cursor-pointer border-2 transition-transform hover:scale-110",h.currentColor===s.value?"border-white scale-110":"border-transparent opacity-40"])},null,14,el)),64))]),v(c($),{icon:"pi pi-times",onClick:t[12]||(t[12]=s=>h.active=!1),class:"p-button-rounded p-button-danger p-button-text p-button-sm"})])):w("",!0)],36)]),v(c(Me),{visible:_e.value,"onUpdate:visible":t[18]||(t[18]=s=>_e.value=s),header:"Configuration du Composant",modal:"",style:{width:"380px"},class:"dark-dialog"},{default:ne(()=>{var s;return[l("div",tl,[l("div",sl,[ol,v(c(le),{modelValue:E.tag,"onUpdate:modelValue":t[14]||(t[14]=o=>E.tag=o),class:"w-full !bg-white/5 border-white/10"},null,8,["modelValue"])]),l("div",ll,[il,v(c(le),{modelValue:E.designation,"onUpdate:modelValue":t[15]||(t[15]=o=>E.designation=o),class:"w-full !bg-white/5 border-white/10"},null,8,["modelValue"])]),G.value&&Object.keys(G.value).length>0?(d(),u("div",al,[nl,(d(!0),u(N,null,D(G.value,(o,a)=>(d(),u("div",{key:a,class:"space-y-2"},[l("label",rl,k(Ye(a)),1),l("div",dl,[v(c(le),{modelValue:o.value,"onUpdate:modelValue":n=>o.value=n,placeholder:"Valeur",class:"w-full !bg-white/5 border-white/10 text-xs"},null,8,["modelValue","onUpdate:modelValue"]),v(c(Ze),{modelValue:o.date,"onUpdate:modelValue":n=>o.date=n,placeholder:"Date",class:"w-full",inputClass:"!bg-white/5 !border-white/10 !text-xs",showIcon:""},null,8,["modelValue","onUpdate:modelValue"])])]))),128))])):w("",!0),l("div",cl,[Y(l("input",{type:"checkbox","onUpdate:modelValue":t[16]||(t[16]=o=>E.isRoot=o),class:"w-4 h-4 accent-indigo-500"},null,512),[[He,E.isRoot]]),ul]),l("div",pl,[vl,c(I).region_id?(d(),Se(c(Ce),{key:1,modelValue:E.zone_id,"onUpdate:modelValue":t[17]||(t[17]=o=>E.zone_id=o),options:((s=X.regions.find(o=>o.id===c(I).region_id))==null?void 0:s.zones)||[],optionLabel:"nomenclature",optionValue:"id",placeholder:"Sélectionner une zone",class:"w-full",filter:""},null,8,["modelValue","options"])):(d(),u("div",fl,xl))]),v(c($),{label:"Insérer sur le schéma",icon:"pi pi-plus",onClick:ft,class:"w-full !bg-indigo-600 border-none !rounded-xl py-3 mt-2"})])]}),_:1},8,["visible"]),v(c(Me),{visible:ye.value,"onUpdate:visible":t[24]||(t[24]=s=>ye.value=s),header:"Modifier le Composant",modal:"",style:{width:"380px"},class:"dark-dialog"},{default:ne(()=>{var s;return[l("div",bl,[l("div",ml,[gl,v(c(le),{modelValue:M.tag,"onUpdate:modelValue":t[19]||(t[19]=o=>M.tag=o),class:"w-full !bg-white/5 border-white/10"},null,8,["modelValue"])]),l("div",_l,[yl,v(c(le),{modelValue:M.designation,"onUpdate:modelValue":t[20]||(t[20]=o=>M.designation=o),class:"w-full !bg-white/5 border-white/10"},null,8,["modelValue"])]),G.value&&Object.keys(G.value).length>0?(d(),u("div",wl,[kl,(d(!0),u(N,null,D(G.value,(o,a)=>(d(),u("div",{key:a,class:"space-y-2"},[l("label",Sl,k(Ye(a)),1),l("div",Ml,[v(c(le),{modelValue:o.value,"onUpdate:modelValue":n=>o.value=n,placeholder:"Valeur",class:"w-full !bg-white/5 border-white/10 text-xs"},null,8,["modelValue","onUpdate:modelValue"]),v(c(Ze),{modelValue:o.date,"onUpdate:modelValue":n=>o.date=n,placeholder:"Date",class:"w-full",inputClass:"!bg-white/5 !border-white/10 !text-xs",showIcon:""},null,8,["modelValue","onUpdate:modelValue"])])]))),128))])):w("",!0),l("div",Cl,[Vl,v(c(Ce),{modelValue:M.status,"onUpdate:modelValue":t[21]||(t[21]=o=>M.status=o),options:["en service","en maintenance","en panne","hors service"],placeholder:"Sélectionner un statut",class:"w-full"},null,8,["modelValue"])]),l("div",$l,[Y(l("input",{type:"checkbox","onUpdate:modelValue":t[22]||(t[22]=o=>M.isRoot=o),class:"w-4 h-4 accent-indigo-500"},null,512),[[He,M.isRoot]]),Il]),l("div",Nl,[Ll,c(I).region_id?(d(),Se(c(Ce),{key:1,modelValue:M.zone_id,"onUpdate:modelValue":t[23]||(t[23]=o=>M.zone_id=o),options:((s=X.regions.find(o=>o.id===c(I).region_id))==null?void 0:s.zones)||[],optionLabel:"nomenclature",optionValue:"id",placeholder:"Sélectionner une zone",class:"w-full",filter:""},null,8,["modelValue","options"])):(d(),u("div",zl,Dl))]),v(c($),{label:"Enregistrer les modifications",icon:"pi pi-save",onClick:gt,class:"w-full !bg-indigo-600 border-none !rounded-xl py-3 mt-2"})])]}),_:1},8,["visible"]),v(c(Me),{visible:ue.value,"onUpdate:visible":t[29]||(t[29]=s=>ue.value=s),header:ae.value?"Modifier l'Annotation":"Ajouter une Annotation",modal:"",style:{width:"350px"},class:"dark-dialog"},{default:ne(()=>[l("div",jl,[l("div",Rl,[Tl,v(c(le),{modelValue:C.text,"onUpdate:modelValue":t[25]||(t[25]=s=>C.text=s),class:"w-full !bg-white/5 border-white/10"},null,8,["modelValue"])]),l("div",Ul,[l("div",Ol,[Pl,v(c(Ve),{modelValue:C.fontSize,"onUpdate:modelValue":t[26]||(t[26]=s=>C.fontSize=s),min:8,max:72,showButtons:"",class:"!bg-white/5"},null,8,["modelValue"])]),l("div",ql,[Al,l("div",Bl,[v(c(Ke),{modelValue:C.color,"onUpdate:modelValue":t[27]||(t[27]=s=>C.color=s)},null,8,["modelValue"]),l("span",Xl,k(C.color),1)])]),l("div",Wl,[Yl,v(c(Ve),{modelValue:C.rotation,"onUpdate:modelValue":t[28]||(t[28]=s=>C.rotation=s),min:-180,max:180,showButtons:"",suffix:"°",class:"!bg-white/5"},null,8,["modelValue"])])]),v(c($),{label:ae.value?"Mettre à jour":"Ajouter le label",icon:"pi pi-check",onClick:bt,class:"w-full !bg-indigo-600 border-none !rounded-xl py-3"},null,8,["label"])])]),_:1},8,["visible","header"]),v(c(Me),{visible:we.value,"onUpdate:visible":t[35]||(t[35]=s=>we.value=s),header:"Redimensionner le Jeu de Barres",modal:"",style:{width:"350px"},class:"dark-dialog"},{default:ne(()=>[l("div",Fl,[l("div",Jl,[l("div",Hl,[Gl,v(c(Ve),{modelValue:q.w,"onUpdate:modelValue":t[30]||(t[30]=s=>q.w=s),min:20,step:10,showButtons:"",class:"!bg-white/5",onInput:t[31]||(t[31]=s=>ie.value.w=s.value)},null,8,["modelValue"])]),l("div",Kl,[Zl,v(c(Ve),{modelValue:q.h,"onUpdate:modelValue":t[32]||(t[32]=s=>q.h=s),min:4,step:2,showButtons:"",class:"!bg-white/5",onInput:t[33]||(t[33]=s=>ie.value.h=s.value)},null,8,["modelValue"])])]),l("div",Ql,[ei,l("div",ti,[v(c(Ke),{modelValue:q.color,"onUpdate:modelValue":t[34]||(t[34]=s=>q.color=s)},null,8,["modelValue"]),l("span",si,"#"+k(q.color),1)])]),l("div",oi,[v(c($),{label:"Appliquer",icon:"pi pi-check",onClick:xt,class:"w-full !bg-indigo-600 border-none !rounded-xl py-3"})])])]),_:1},8,["visible"])])}}};export{ki as default};
