import{s as re}from"./index-RIg7_KOk.js";import{s as ie}from"./index-CEA3Snwx.js";import{a as de,b as ue,r as m,d as D,ad as pe,T as me,e as O,f as p,F as C,c as B,o as r,i as s,g as e,Z as ce,j as o,l as d,n as fe,X as ye,ae as be,t as u,m as _e,p as f,s as $,h as K,x as ve,y as he}from"./app-BRAmWWDK.js";import{_ as ge}from"./AppLayout-DcYAlXcr.js";import{s as y}from"./index-BLI3-ZB5.js";import{s as L}from"./index-BN5aQcOg.js";import{a as Ve,s as ke}from"./index-BvqM3u8T.js";import{s as F,a as xe}from"./index-6CLnIpjK.js";import{s as Se}from"./index-B_-uiTa1.js";import{s as we}from"./index-CsEuBKcf.js";import{s as x}from"./index-BeaEkU56.js";import{s as Q}from"./index-BQJ1L68S.js";import{s as Ce}from"./index-ZzNQsZaI.js";import{s as Ue}from"./index-B0W91G3B.js";import{s as $e}from"./index-Ci1herNU.js";import{s as Le}from"./index-DZHXsoj_.js";import{_ as Pe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./DropdownLink-BJ7aGovM.js";import"./index-ClmdxtMW.js";import"./index-CDA2CSiu.js";import"./index-LMQAJ2bo.js";import"./index-DBlwtJFe.js";import"./index-D3aGqElX.js";import"./index-CcU6oDqo.js";const c=b=>(ve("data-v-d1bdf76e"),b=b(),he(),b),Ae={class:"grid"},De={class:"col-12"},Fe={class:"card"},Ne={class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center"},Me={class:"block mt-2 md:mt-0 flex align-items-center"},Re={class:"flex items-center gap-2"},Te=c(()=>o("i",{class:"pi pi-search"},null,-1)),Ee={class:"p-2 space-y-3"},je=c(()=>o("span",{class:"text-[10px] font-black uppercase text-slate-400 block border-b pb-2"},"Colonnes actives",-1)),Ie={key:0},ze={key:1},qe={key:2},Oe={key:3},Be={key:4},Ke={key:5},Qe={key:0,class:"text-surface-500 dark:text-surface-400 block mb-4"},Ge={class:"flex flex-column gap-3"},He={class:"flex items-center gap-4"},We=c(()=>o("label",{for:"amount",class:"font-semibold w-24"},"Montant *",-1)),Xe={key:0,class:"p-error"},Ze={class:"flex items-center gap-4"},Je=c(()=>o("label",{for:"payment_date",class:"font-semibold w-24"},"Date de Paiement *",-1)),Ye={key:1,class:"p-error"},ea={class:"flex items-center gap-4"},aa=c(()=>o("label",{for:"payment_method",class:"font-semibold w-24"},"Méthode de Paiement",-1)),ta={key:2,class:"p-error"},la={class:"flex items-center gap-4"},sa=c(()=>o("label",{for:"reference",class:"font-semibold w-24"},"Référence",-1)),oa={key:3,class:"p-error"},na={class:"flex items-center gap-4"},ra=c(()=>o("label",{for:"category",class:"font-semibold w-24"},"Catégorie",-1)),ia={key:4,class:"p-error"},da={class:"flex items-center gap-4"},ua=c(()=>o("label",{for:"paid_by",class:"font-semibold w-24"},"Payé par *",-1)),pa={key:5,class:"p-error"},ma={class:"flex items-center gap-4"},ca=c(()=>o("label",{for:"payable",class:"font-semibold w-24"},"Payable à *",-1)),fa={key:0},ya={key:1},ba={key:6,class:"p-error"},_a={class:"flex items-center gap-4"},va=c(()=>o("label",{for:"notes",class:"font-semibold w-24"},"Notes",-1)),ha={key:7,class:"p-error"},ga={class:"flex items-center gap-4"},Va=c(()=>o("label",{for:"status",class:"font-semibold w-24"},"Statut",-1)),ka={key:8,class:"p-error"},xa={class:"flex justify-end gap-2 pt-4"},Sa={__name:"Presences",props:{payments:Object,filters:Object,users:Array,payables:Array},setup(b){const G=b,_=de(),N=ue(),V=m(!1),h=m(!1),g=m(!1),v=m(null),M=m(),R=m(),S=m(),T=()=>{S.value={global:{value:null,matchMode:C.CONTAINS},payable_name:{operator:B.AND,constraints:[{value:null,matchMode:C.STARTS_WITH}]},category:{value:null,matchMode:C.IN},status:{value:null,matchMode:C.EQUALS},amount:{operator:B.AND,constraints:[{value:null,matchMode:C.EQUALS}]}}};T();const E=m([{field:"amount",header:"Montant",default:!0},{field:"payment_date",header:"Date de Paiement",default:!0},{field:"payable_name",header:"Payable à",default:!0},{field:"category",header:"Catégorie",default:!0},{field:"status",header:"Statut",default:!0},{field:"paid_by_user.name",header:"Payé par",default:!1},{field:"payment_method",header:"Méthode",default:!1},{field:"reference",header:"Référence",default:!1},{field:"notes",header:"Notes",default:!1}]),P=m(E.value.filter(n=>n.default)),H=D(()=>P.value),{user:A}=pe().props.auth,a=me({id:null,name:"",team_leader_id:null,creation_date:null,members:[],amount:null,payment_date:null,payment_method:"bank_transfer",reference:null,notes:null,status:"completed",paid_by:null,payable_type:null,payable_id:null,category:"salary"}),j=D(()=>v.value&&v.value.length>0),W=()=>{if(!j.value){_.add({severity:"warn",summary:"Attention",detail:"Veuillez sélectionner au moins un paiement.",life:3e3});return}N.require({message:`Êtes-vous sûr de vouloir supprimer les ${v.value.length} paiements sélectionnés ?`,header:"Confirmation de suppression multiple",rejectClass:"p-button-secondary p-button-outlined",rejectLabel:"Annuler",acceptLabel:"Supprimer",acceptClass:"p-button-danger",accept:()=>{X()}})},X=()=>{const n=v.value.map(l=>l.id);K.post(route("payments.bulkDestroy"),{ids:n},{onSuccess:()=>{_.add({severity:"success",summary:"Succès",detail:`${n.length} paiements supprimés avec succès.`,life:3e3}),v.value=null},onError:()=>{_.add({severity:"error",summary:"Erreur",detail:"Une erreur est survenue lors de la suppression multiple.",life:3e3})},preserveState:!1})},Z=()=>{a.reset(),g.value=!1,h.value=!1,a.payment_date=new Date,a.paid_by=A==null?void 0:A.id,V.value=!0},J=()=>{V.value=!1,h.value=!1},Y=n=>{a.id=n.id,a.amount=n.amount,a.payment_date=n.payment_date?new Date(n.payment_date):null,a.payment_method=n.payment_method,a.reference=n.reference,a.notes=n.notes,a.status=n.status,a.paid_by=n.paid_by,a.payable_type=n.payable_type,a.payable_id=n.payable_id,a.category=n.category,g.value=!0,V.value=!0},ee=()=>{if(h.value=!0,!a.amount||!a.payment_date||!a.paid_by||!a.payable_type||!a.payable_id){_.add({severity:"warn",summary:"Attention",detail:"Veuillez remplir tous les champs obligatoires (Montant, Date, Payé par, Payable à).",life:3e3});return}const n=g.value?route("payments.update",a.id):route("payments.store"),l=g.value?"put":"post";a.submit(l,n,{onSuccess:()=>{V.value=!1,_.add({severity:"success",summary:"Succès",detail:`Paiement ${g.value?"mis à jour":"créé"} avec succès`,life:3e3}),a.reset(),v.value=null},onError:k=>{console.error("Erreur lors de la sauvegarde du paiement",k),_.add({severity:"error",summary:"Erreur",detail:"Une erreur est survenue.",life:3e3})}})},ae=n=>{N.require({message:`Êtes-vous sûr de vouloir supprimer le paiement de ${n.amount} à ${n.payable_name} ?`,header:"Confirmation de suppression",icon:"pi pi-info-circle",rejectClass:"p-button-secondary p-button-outlined",rejectLabel:"Annuler",acceptLabel:"Supprimer",acceptClass:"p-button-danger",accept:()=>{K.delete(route("payments.destroy",n.id),{onSuccess:()=>{_.add({severity:"success",summary:"Succès",detail:"Paiement supprimé avec succès",life:3e3})},onError:()=>{_.add({severity:"error",summary:"Erreur",detail:"Une erreur est survenue lors de la suppression.",life:3e3})}})}})},te=m([{label:"Virement bancaire",value:"bank_transfer"},{label:"Espèces",value:"cash"},{label:"Chèque",value:"check"},{label:"Autre",value:"other"}]),I=m([{label:"Salaire",value:"salary"},{label:"Prime",value:"bonus"},{label:"Remboursement de dépenses",value:"expense_reimbursement"},{label:"Avance",value:"advance"},{label:"Autre",value:"other"}]),z=m([{label:"En attente",value:"pending"},{label:"Terminé",value:"completed"},{label:"Échoué",value:"failed"},{label:"Remboursé",value:"refunded"}]),le=n=>({pending:"warning",completed:"success",failed:"danger",refunded:"info"})[n]||"secondary",se=(n,l)=>{const k=G.payables.find(U=>U.type===n&&U.id===l);return k?k.name:"N/A"},oe=()=>{M.value.exportCSV()},ne=D(()=>g.value?"Modifier le Paiement":"Créer un nouveau Paiement");return(n,l)=>{const k=ie,U=re;return r(),O(ge,{title:"Gestion des Équipes"},{default:p(()=>[s(e(ce),{title:"Équipes"}),o("div",Ae,[o("div",De,[o("div",Fe,[s(e($e)),s(e(Le)),s(e(Se),{class:"mb-4"},{start:p(()=>[o("div",Ne,[o("span",Me,[s(e(y),{label:"Ajouter un paiement",icon:"pi pi-plus",class:"p-button-sm mr-2",onClick:Z}),s(e(y),{label:"Supprimer la sélection",icon:"pi pi-trash",class:"p-button-sm p-button-danger",disabled:!j.value,onClick:W},null,8,["disabled"])])])]),end:p(()=>[o("div",Re,[s(e(Ve),{class:"mr-2"},{default:p(()=>[s(e(ke),null,{default:p(()=>[Te]),_:1}),s(e(L),{modelValue:S.value.global.value,"onUpdate:modelValue":l[0]||(l[0]=t=>S.value.global.value=t),placeholder:"Rechercher...",class:"p-inputtext-sm"},null,8,["modelValue"])]),_:1}),s(e(y),{icon:"pi pi-filter-slash",outlined:"",severity:"secondary",onClick:T,class:"p-button-sm"}),s(e(y),{icon:"pi pi-download",label:"Exporter",class:"p-button-text p-button-secondary p-button-sm font-bold",onClick:oe}),s(e(y),{icon:"pi pi-columns",class:"p-button-text p-button-secondary",onClick:l[1]||(l[1]=t=>R.value.toggle(t))})])]),_:1}),s(e(Ce),{ref_key:"op",ref:R,class:"quantum-overlay"},{default:p(()=>[o("div",Ee,[je,s(e(Q),{modelValue:P.value,"onUpdate:modelValue":l[2]||(l[2]=t=>P.value=t),options:E.value,optionLabel:"header",optionValue:"field",display:"chip",class:"w-64 quantum-multiselect"},null,8,["modelValue","options"])])]),_:1},512),s(e(xe),{ref_key:"dt",ref:M,value:b.payments.data,dataKey:"id",paginator:!0,rows:10,filters:S.value,"onUpdate:filters":l[3]||(l[3]=t=>S.value=t),filterDisplay:"menu",globalFilterFields:["payable_name","category","status","amount"],paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",rowsPerPageOptions:[5,10,25],currentPageReportTemplate:"Affichage de {first} à {last} sur {totalRecords} paiements",responsiveLayout:"scroll",selection:v.value,"onUpdate:selection":l[4]||(l[4]=t=>v.value=t)},{default:p(()=>[s(e(F),{selectionMode:"multiple",headerStyle:"width: 3rem",frozen:""}),(r(!0),d(_e,null,fe(H.value,t=>(r(),O(e(F),{key:t.field,field:t.field,header:t.header,sortable:!0,style:{"min-width":"12rem"}},ye({body:p(i=>[t.field==="amount"?(r(),d("span",Ie,u(new Intl.NumberFormat("fr-FR",{style:"currency",currency:"USD",minimumFractionDigits:2,maximumFractionDigits:2}).format(i.data.amount)),1)):t.field==="payment_date"?(r(),d("span",ze,u(new Date(i.data.payment_date).toLocaleDateString("fr-FR")),1)):t.field==="status"?(r(),d("span",qe,[s(k,{value:i.data.status,severity:le(i.data.status)},null,8,["value","severity"])])):t.field==="paid_by_user.name"?(r(),d("span",Oe,u(i.data.paid_by_user?i.data.paid_by_user.name:"N/A"),1)):t.field==="payable_name"?(r(),d("span",Be,u(i.data.payable_name),1)):(r(),d("span",Ke,u(i.data[t.field]),1))]),_:2},[t.field==="status"?{name:"filter",fn:p(({filterModel:i})=>[s(e(x),{modelValue:i.value,"onUpdate:modelValue":w=>i.value=w,options:z.value,optionLabel:"label",optionValue:"value",placeholder:"Tous les statuts",class:"p-column-filter",showClear:""},null,8,["modelValue","onUpdate:modelValue","options"])]),key:"0"}:void 0,t.field==="category"?{name:"filter",fn:p(({filterModel:i})=>[s(e(Q),{modelValue:i.value,"onUpdate:modelValue":w=>i.value=w,options:I.value,optionLabel:"label",optionValue:"value",placeholder:"Toutes les catégories",class:"p-column-filter"},null,8,["modelValue","onUpdate:modelValue","options"])]),key:"1"}:void 0,t.field==="payable_name"?{name:"filter",fn:p(({filterModel:i,filterCallback:w})=>[s(e(L),{modelValue:i.value,"onUpdate:modelValue":q=>i.value=q,type:"text",onKeydown:be(q=>w(),["enter"]),class:"p-column-filter",placeholder:"Rechercher par nom"},null,8,["modelValue","onUpdate:modelValue","onKeydown"])]),key:"2"}:void 0]),1032,["field","header"]))),128)),s(e(F),{headerStyle:"min-width:10rem;",header:"Actions",bodyStyle:"text-align: right",frozen:"",alignFrozen:"right"},{body:p(t=>[s(e(y),{icon:"pi pi-pencil",class:"p-button-rounded mr-2",severity:"info",onClick:i=>Y(t.data)},null,8,["onClick"]),s(e(y),{icon:"pi pi-trash",class:"p-button-rounded",severity:"error",onClick:i=>ae(t.data)},null,8,["onClick"])]),_:1})]),_:1},8,["value","filters","selection"]),s(e(we),{visible:V.value,"onUpdate:visible":l[15]||(l[15]=t=>V.value=t),modal:"",header:ne.value,style:{width:"45rem"}},{default:p(()=>[g.value?(r(),d("span",Qe,"Mettez à jour les informations du paiement.")):f("",!0),o("div",Ge,[o("div",He,[We,s(U,{id:"amount",modelValue:e(a).amount,"onUpdate:modelValue":l[5]||(l[5]=t=>e(a).amount=t),mode:"currency",currency:"USD",locale:"fr-FR",class:$([{"p-invalid":h.value&&!e(a).amount},"flex-auto"])},null,8,["modelValue","class"])]),e(a).errors.amount?(r(),d("small",Xe,u(e(a).errors.amount),1)):f("",!0),o("div",Ze,[Je,s(e(Ue),{id:"payment_date",modelValue:e(a).payment_date,"onUpdate:modelValue":l[6]||(l[6]=t=>e(a).payment_date=t),dateFormat:"dd/mm/yy",showIcon:"",class:$([{"p-invalid":h.value&&!e(a).payment_date},"flex-auto"])},null,8,["modelValue","class"])]),e(a).errors.payment_date?(r(),d("small",Ye,u(e(a).errors.payment_date),1)):f("",!0),o("div",ea,[aa,s(e(x),{id:"payment_method",modelValue:e(a).payment_method,"onUpdate:modelValue":l[7]||(l[7]=t=>e(a).payment_method=t),options:te.value,optionLabel:"label",optionValue:"value",placeholder:"Sélectionner une méthode",class:"flex-auto"},null,8,["modelValue","options"])]),e(a).errors.payment_method?(r(),d("small",ta,u(e(a).errors.payment_method),1)):f("",!0),o("div",la,[sa,s(e(L),{id:"reference",modelValue:e(a).reference,"onUpdate:modelValue":l[8]||(l[8]=t=>e(a).reference=t),modelModifiers:{trim:!0},class:"flex-auto",autocomplete:"off"},null,8,["modelValue"])]),e(a).errors.reference?(r(),d("small",oa,u(e(a).errors.reference),1)):f("",!0),o("div",na,[ra,s(e(x),{id:"category",modelValue:e(a).category,"onUpdate:modelValue":l[9]||(l[9]=t=>e(a).category=t),options:I.value,optionLabel:"label",optionValue:"value",placeholder:"Sélectionner une catégorie",class:"flex-auto"},null,8,["modelValue","options"])]),e(a).errors.category?(r(),d("small",ia,u(e(a).errors.category),1)):f("",!0),o("div",da,[ua,s(e(x),{id:"paid_by",modelValue:e(a).paid_by,"onUpdate:modelValue":l[10]||(l[10]=t=>e(a).paid_by=t),options:b.users,optionLabel:"name",optionValue:"id",placeholder:"Sélectionner un utilisateur",class:$([{"p-invalid":h.value&&!e(a).paid_by},"flex-auto"])},null,8,["modelValue","options","class"])]),e(a).errors.paid_by?(r(),d("small",pa,u(e(a).errors.paid_by),1)):f("",!0),o("div",ma,[ca,s(e(x),{id:"payable",modelValue:e(a).payable_type,"onUpdate:modelValue":l[11]||(l[11]=t=>e(a).payable_type=t),options:b.payables,optionLabel:"name",placeholder:"Sélectionner une entité",class:$([{"p-invalid":h.value&&(!e(a).payable_type||!e(a).payable_id)},"flex-auto"]),onChange:l[12]||(l[12]=t=>{e(a).payable_type=t.value.type,e(a).payable_id=t.value.id})},{value:p(t=>[t.value?(r(),d("span",fa,u(se(t.value[0],t.value[1])),1)):(r(),d("span",ya,u(t.placeholder),1))]),option:p(t=>[o("span",null,u(t.option.name)+" ("+u(t.option.type.split("\\").pop())+")",1)]),_:1},8,["modelValue","options","class"])]),e(a).errors.payable_id||e(a).errors.payable_type?(r(),d("small",ba,"Veuillez sélectionner une entité payable.")):f("",!0),o("div",_a,[va,s(e(L),{id:"notes",modelValue:e(a).notes,"onUpdate:modelValue":l[13]||(l[13]=t=>e(a).notes=t),modelModifiers:{trim:!0},class:"flex-auto",autocomplete:"off"},null,8,["modelValue"])]),e(a).errors.notes?(r(),d("small",ha,u(e(a).errors.notes),1)):f("",!0),o("div",ga,[Va,s(e(x),{id:"status",modelValue:e(a).status,"onUpdate:modelValue":l[14]||(l[14]=t=>e(a).status=t),options:z.value,optionLabel:"label",optionValue:"value",placeholder:"Sélectionner un statut",class:"flex-auto"},null,8,["modelValue","options"])]),e(a).errors.status?(r(),d("small",ka,u(e(a).errors.status),1)):f("",!0)]),o("div",xa,[s(e(y),{type:"button",label:"Annuler",severity:"secondary",onClick:J}),s(e(y),{type:"button",label:"Sauvegarder",onClick:ee,loading:e(a).processing},null,8,["loading"])])]),_:1},8,["visible","header"])])])])]),_:1})}}},Wa=Pe(Sa,[["__scopeId","data-v-d1bdf76e"]]);export{Wa as default};
