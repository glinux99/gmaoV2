import{T as ie}from"./index-BbFIc-qF.js";import{a as ne,b as re,u as de,r as _,d as b,T as ce,h as O,e as C,f as x,g as e,o as p,i as a,Z as ue,j as t,t as d,q as T,p as j,l as g,n as pe,m as S,k as M,x as me,y as xe}from"./app-BRAmWWDK.js";import{_ as fe}from"./AppLayout-DcYAlXcr.js";import{d as ve}from"./debounce-DtANB3cg.js";import{s as B,a as he}from"./index-6CLnIpjK.js";import{s as u}from"./index-BLI3-ZB5.js";import{s as _e}from"./index-CsEuBKcf.js";import{s as F}from"./index-BN5aQcOg.js";import{s as be}from"./index-CNGgL0Kp.js";import{s as y}from"./index-BeaEkU56.js";import{s as ge}from"./index-RIg7_KOk.js";import{s as ye}from"./index-B0W91G3B.js";import{s as we}from"./index-CEA3Snwx.js";import{a as ke,s as Ve}from"./index-BvqM3u8T.js";import{s as Ce}from"./index-Ci1herNU.js";import{s as je}from"./index-DZHXsoj_.js";import{s as Se}from"./index-BQJ1L68S.js";import{s as X}from"./index-ZzNQsZaI.js";import{_ as $e}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./DropdownLink-BJ7aGovM.js";import"./index-ClmdxtMW.js";import"./index-CDA2CSiu.js";import"./index-LMQAJ2bo.js";import"./index-DBlwtJFe.js";import"./index-CcU6oDqo.js";import"./index-D3aGqElX.js";const r=v=>(me("data-v-8c4cdc5d"),v=v(),xe(),v),Ue={class:"min-h-screen bg-slate-50 p-4 md:p-10"},Te={class:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-8"},Fe={class:"flex items-center gap-4"},De=r(()=>t("div",{class:"flex h-16 w-16 items-center justify-center rounded-[2rem] bg-primary-600 shadow-xl shadow-primary-200"},[t("i",{class:"pi pi-wallet text-2xl text-white"})],-1)),Ae=r(()=>t("h1",{class:"text-3xl font-black text-slate-900 tracking-tight"},[M("Gestion des "),t("span",{class:"text-primary-600"},"Dépenses")],-1)),Ee={class:"text-slate-500 font-medium"},Ne={class:"flex gap-3"},Ie={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 mb-8"},Le={class:"bg-white p-6 rounded-3xl border border-slate-200 shadow-sm hover:shadow-lg hover:-translate-y-1 transition-all"},Oe={class:"text-xs font-black text-slate-400 uppercase tracking-widest"},Be={class:"flex items-center justify-between mt-2"},Me={class:"text-3xl font-black text-slate-800"},ze=r(()=>t("div",{class:"w-10 h-10 rounded-2xl bg-slate-50 flex items-center justify-center"},[t("i",{class:"pi pi-dollar text-slate-400"})],-1)),Pe={class:"bg-white p-6 rounded-3xl border border-slate-200 shadow-sm hover:shadow-lg hover:-translate-y-1 transition-all"},qe={class:"text-xs font-black text-slate-400 uppercase tracking-widest"},Ge={class:"flex items-center justify-between mt-2"},Re={class:"text-3xl font-black text-slate-800"},He=r(()=>t("div",{class:"w-10 h-10 rounded-2xl bg-slate-50 flex items-center justify-center"},[t("i",{class:"pi pi-clock text-slate-400"})],-1)),Ke={class:"bg-white p-6 rounded-3xl border border-slate-200 shadow-sm hover:shadow-lg hover:-translate-y-1 transition-all"},Ze={class:"text-xs font-black text-slate-400 uppercase tracking-widest"},Je={class:"flex items-center justify-between mt-2"},Qe={class:"text-3xl font-black text-slate-800"},We=r(()=>t("div",{class:"w-10 h-10 rounded-2xl bg-slate-50 flex items-center justify-center"},[t("i",{class:"pi pi-chart-line text-slate-400"})],-1)),Xe={class:"overflow-hidden rounded-[2.5rem] border border-white bg-white shadow-xl"},Ye={class:"flex flex-col md:flex-row justify-between items-center gap-4 p-4"},et={class:"flex items-center gap-2"},tt={key:2,class:"w-px h-6 bg-slate-200"},st={key:0,class:"font-bold text-slate-900"},lt={class:"flex gap-2"},ot={class:"text-right p-2 text-slate-500 font-bold"},at={class:"px-8 py-5 bg-slate-900 text-white rounded-xl flex justify-between items-center relative z-50"},it={class:"flex items-center gap-4"},nt=r(()=>t("div",{class:"w-12 h-12 bg-primary-600 rounded-xl flex items-center justify-center text-white shadow-lg shadow-primary-200"},[t("i",{class:"pi pi-receipt text-xl"})],-1)),rt={class:"font-black text-slate-100 m-0"},dt={class:"text-xs text-slate-400 m-0"},ct={class:"p-6 bg-white max-h-[80vh] overflow-y-auto scroll-smooth"},ut={class:"grid grid-cols-1 md:grid-cols-12 gap-8"},pt={class:"md:col-span-12 space-y-8"},mt={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},xt={class:"flex flex-col gap-2"},ft=r(()=>t("label",{class:"text-xs font-black text-slate-500 uppercase"},"Montant HT (USD)",-1)),vt={class:"flex flex-col gap-2"},ht=r(()=>t("label",{class:"text-xs font-black text-slate-500 uppercase"},"TVA (%)",-1)),_t={class:"flex flex-col gap-2"},bt=r(()=>t("label",{class:"text-xs font-black text-slate-500 uppercase"},"Date d'opération",-1)),gt={class:"flex flex-col gap-2"},yt=r(()=>t("label",{class:"text-xs font-black text-slate-500 uppercase"},"Fournisseur",-1)),wt={class:"flex flex-col gap-2"},kt=r(()=>t("label",{class:"text-xs font-black text-slate-500 uppercase"},"N° Facture",-1)),Vt={class:"flex flex-col gap-2"},Ct=r(()=>t("label",{class:"text-xs font-black text-slate-500 uppercase"},"Libellé court",-1)),jt={class:"flex flex-col gap-2"},St=r(()=>t("label",{class:"text-xs font-black text-slate-500 uppercase"},"Catégorie",-1)),$t={class:"flex flex-col gap-2"},Ut=r(()=>t("label",{class:"text-xs font-black text-slate-500 uppercase"},"Paiement",-1)),Tt={class:"flex flex-col gap-2"},Ft=r(()=>t("label",{class:"text-xs font-black text-slate-500 uppercase"},"Projet",-1)),Dt={class:"flex flex-col gap-2"},At=r(()=>t("label",{class:"text-xs font-black text-slate-500 uppercase"},"Véhicule",-1)),Et={class:"md:col-span-2 flex flex-col gap-2"},Nt=r(()=>t("label",{class:"text-xs font-black text-slate-500 uppercase"},"Description",-1)),It={class:"flex justify-between items-center w-full px-8 py-5 bg-slate-50 border-t border-slate-100"},Lt={class:"flex gap-3"},Ot={class:"text-xs font-black uppercase mb-3"},Bt={class:"space-y-4"},Mt={class:"text-xs font-semibold"},zt={class:"text-xs font-semibold"},Pt={__name:"Expenses",props:{expenses:{type:Array,default:()=>[]},filters:Object,users:Array,categories:Array,projects:Array,vehicles:Array,expensables:{type:Array,default:()=>[]}},setup(v){var Z,J,Q,W;const w=v,D=ne(),z=re(),{t:n}=de(),V=_(!1),k=_(!1),P=_(),h=_([]),c=_({search:((Z=w.filters)==null?void 0:Z.search)||"",status:((J=w.filters)==null?void 0:J.status)||null,category_id:((Q=w.filters)==null?void 0:Q.category_id)||null,date:((W=w.filters)==null?void 0:W.date)||null}),q=_(),G=_(),A=_([{field:"description",header:b(()=>n("expenses.table.description")),default:!0},{field:"amount",header:b(()=>n("expenses.table.amount")),default:!0},{field:"expense_date",header:b(()=>n("expenses.table.date")),default:!0},{field:"category",header:b(()=>n("expenses.table.category")),default:!0},{field:"status",header:b(()=>n("expenses.table.status")),default:!0},{field:"user.name",header:b(()=>n("expenses.table.createdBy")),default:!0},{field:"expensable_title",header:b(()=>n("expenses.table.linkedTo")),default:!0},{field:"provider",header:"Fournisseur",default:!1},{field:"invoice_number",header:"N° Facture",default:!1}]),E=_(A.value.filter(o=>o.default).map(o=>o.field)),i=ce({id:null,label:"",description:"",amount:null,tax_rate:20,expense_date:new Date,category_id:null,provider:"",invoice_number:"",payment_method:"Carte Bancaire",project_id:null,vehicle_id:null,notes:"",status:"pending"}),R=b(()=>w.expenses?w.expenses.flatMap(o=>o.details.map(s=>({...s,expensable_title:o.expensable_title}))):[]),N=b(()=>{const o=R.value,s=o.reduce((m,l)=>m+parseFloat(l.amount||0),0);return{totalAmount:s,pending:o.filter(m=>m.status==="pending").length,average:o.length>0?s/o.length:0}}),$=o=>new Intl.NumberFormat("fr-FR",{style:"currency",currency:"USD"}).format(o),Y=()=>{i.reset(),k.value=!1,V.value=!0},I=()=>{V.value=!1},ee=o=>{i.id=o.id,i.label=o.description,i.description=o.description,i.amount=parseFloat(o.amount),i.expense_date=new Date(o.expense_date),i.category_id=o.category_id,i.provider=o.provider,i.invoice_number=o.invoice_number,i.status=o.status,k.value=!0,V.value=!0},te=()=>{const o=k.value?route("expenses.update",i.id):route("expenses.store"),s=k.value?"put":"post";i[s](o,{onSuccess:()=>{D.add({severity:"success",summary:"Succès",detail:"Opération réussie",life:3e3}),I()}})},H=(o,s)=>{z.require({message:`Voulez-vous vraiment passer cette dépense en statut : ${s} ?`,header:"Confirmation de statut",icon:"pi pi-exclamation-triangle",acceptClass:s==="approved"?"p-button-success":"p-button-danger",accept:()=>{O.put(route("expenses.updateStatus",o.id),{status:s},{onSuccess:()=>D.add({severity:"success",summary:"Mis à jour",life:3e3})})}})},K=(o,s)=>{const m=o.map(l=>l.id);z.require({message:`Confirmer le changement de statut pour ${m.length} éléments ?`,accept:()=>{O.put(route("expenses.updateGroupStatus"),{ids:m,status:s},{onSuccess:()=>{h.value=[],D.add({severity:"success",summary:"Traitement groupé terminé"})}})}})},se=()=>{Object.keys(c.value).forEach(o=>c.value[o]=null),L()},le=o=>({pending:"warning",approved:"success",rejected:"danger",paid:"info"})[o]||"secondary",L=ve(()=>{const o={search:c.value.search,status:c.value.status,category_id:c.value.category_id};c.value.date&&c.value.date.length===2&&(o.start_date=c.value.date[0].toISOString().split("T")[0],o.end_date=c.value.date[1].toISOString().split("T")[0]),O.get(route("expenses.index"),o,{preserveState:!0,replace:!0})},300),oe=o=>q.value.toggle(o),ae=()=>P.value.exportCSV();return(o,s)=>{const m=ie;return p(),C(fe,{title:e(n)("expenses.headTitle")},{default:x(()=>[a(e(ue),{title:e(n)("expenses.headTitle")},null,8,["title"]),a(e(Ce)),a(e(je)),t("div",Ue,[t("div",Te,[t("div",Fe,[De,t("div",null,[Ae,t("p",Ee,d(e(n)("expenses.subtitle")),1)])]),t("div",Ne,[a(e(u),{label:e(n)("expenses.addNew"),icon:"pi pi-plus",raised:"",onClick:Y,class:"rounded-xl px-6"},null,8,["label"])])]),t("div",Ie,[t("div",Le,[t("span",Oe,d(e(n)("expenses.stats.totalAmount")),1),t("div",Be,[t("span",Me,d($(N.value.totalAmount)),1),ze])]),t("div",Pe,[t("span",qe,d(e(n)("expenses.stats.pending")),1),t("div",Ge,[t("span",Re,d(N.value.pending),1),He])]),t("div",Ke,[t("span",Ze,d(e(n)("expenses.stats.average")),1),t("div",Je,[t("span",Qe,d($(N.value.average)),1),We])])]),t("div",Xe,[a(e(he),{value:R.value,ref_key:"dt",ref:P,dataKey:"id",paginator:!0,rows:10,selection:h.value,"onUpdate:selection":s[4]||(s[4]=l=>h.value=l),class:"v11-table",responsiveLayout:"scroll"},{header:x(()=>[t("div",Ye,[a(e(ke),{iconPosition:"left"},{default:x(()=>[a(e(Ve),{class:"pi pi-search text-slate-400"}),a(e(F),{modelValue:c.value.search,"onUpdate:modelValue":s[0]||(s[0]=l=>c.value.search=l),onInput:e(L),placeholder:e(n)("expenses.searchPlaceholder"),class:"w-full md:w-80 rounded-2xl border-slate-200 bg-slate-50/50 focus:bg-white"},null,8,["modelValue","onInput","placeholder"])]),_:1}),t("div",et,[h.value.length?T((p(),C(e(u),{key:0,icon:"pi pi-check",severity:"success",onClick:s[1]||(s[1]=l=>K(h.value,"approved"))},null,512)),[[m,"Approuver la sélection",void 0,{top:!0}]]):j("",!0),h.value.length?T((p(),C(e(u),{key:1,icon:"pi pi-times",severity:"danger",onClick:s[2]||(s[2]=l=>K(h.value,"rejected"))},null,512)),[[m,"Rejeter la sélection",void 0,{top:!0}]]):j("",!0),h.value.length?(p(),g("div",tt)):j("",!0),a(e(u),{icon:"pi pi-filter",text:"",rounded:"",severity:"secondary",onClick:s[3]||(s[3]=l=>G.value.toggle(l))}),T(a(e(u),{icon:"pi pi-file-excel",text:"",rounded:"",severity:"secondary",onClick:ae},null,512),[[m,"Exporter en CSV",void 0,{top:!0}]]),T(a(e(u),{icon:"pi pi-cog",text:"",rounded:"",severity:"secondary",onClick:oe},null,512),[[m,"Choisir les colonnes",void 0,{top:!0}]])])])]),footer:x(()=>[t("div",ot," Total sélection : "+d($(h.value.reduce((l,f)=>l+parseFloat(f.amount||0),0))),1)]),default:x(()=>[a(e(B),{selectionMode:"multiple",headerStyle:"width: 3rem"}),(p(!0),g(S,null,pe(A.value,l=>(p(),g(S,{key:l.field},[E.value.includes(l.field)?(p(),C(e(B),{key:0,field:l.field,header:l.header,sortable:""},{body:x(({data:f,field:U})=>[U==="amount"?(p(),g("span",st,d($(f.amount)),1)):U==="status"?(p(),C(e(we),{key:1,value:f.status,severity:le(f.status),class:"!rounded-full !px-3"},null,8,["value","severity"])):U==="expense_date"?(p(),g(S,{key:2},[M(d(new Date(f.expense_date).toLocaleDateString()),1)],64)):(p(),g(S,{key:3},[M(d(f[U]),1)],64))]),_:2},1032,["field","header"])):j("",!0)],64))),128)),a(e(B),{header:"Actions",alignFrozen:"right",frozen:""},{body:x(({data:l})=>[t("div",lt,[a(e(u),{icon:"pi pi-pencil",text:"",rounded:"",severity:"info",onClick:f=>ee(l)},null,8,["onClick"]),l.status==="pending"?(p(),g(S,{key:0},[a(e(u),{icon:"pi pi-check",text:"",rounded:"",severity:"success",onClick:f=>H(l,"approved")},null,8,["onClick"]),a(e(u),{icon:"pi pi-times",text:"",rounded:"",severity:"danger",onClick:f=>H(l,"rejected")},null,8,["onClick"])],64)):j("",!0)])]),_:1})]),_:1},8,["value","selection"])])]),a(e(_e),{visible:V.value,"onUpdate:visible":s[16]||(s[16]=l=>V.value=l),modal:"",header:!1,closable:!1,style:{width:"55rem"},pt:{root:{class:"rounded-[3rem] overflow-hidden border-none shadow-2xl"},mask:{style:"backdrop-filter: blur(8px)"}}},{footer:x(()=>[t("div",It,[a(e(u),{label:e(n)("common.cancel"),icon:"pi pi-times",text:"",severity:"secondary",onClick:I,class:"font-bold uppercase text-[10px] tracking-widest"},null,8,["label"]),t("div",Lt,[a(e(u),{label:k.value?e(n)("common.update"):e(n)("common.save"),icon:"pi pi-check-circle",severity:"indigo",class:"px-10 h-14 rounded-2xl shadow-xl shadow-indigo-100 font-black uppercase tracking-widest text-xs",onClick:te,loading:e(i).processing},null,8,["label","loading"])])])]),default:x(()=>[t("div",at,[t("div",it,[nt,t("div",null,[t("h4",rt,d(k.value?e(n)("expenses.dialog.editTitle"):e(n)("expenses.dialog.createTitle")),1),t("p",dt,d(e(n)("expenses.subtitle")),1)])]),a(e(u),{icon:"pi pi-times",variant:"text",severity:"secondary",rounded:"",onClick:I,class:"text-white hover:bg-white/10"})]),t("div",ct,[t("div",ut,[t("div",pt,[t("div",mt,[t("div",xt,[ft,a(e(ge),{modelValue:e(i).amount,"onUpdate:modelValue":s[5]||(s[5]=l=>e(i).amount=l),mode:"decimal",class:"w-full",inputClass:"py-3.5 rounded-xl border-slate-200"},null,8,["modelValue"])]),t("div",vt,[ht,a(e(y),{modelValue:e(i).tax_rate,"onUpdate:modelValue":s[6]||(s[6]=l=>e(i).tax_rate=l),options:[0,5,10,18,20],class:"w-full rounded-xl border-slate-200 py-1"},null,8,["modelValue"])]),t("div",_t,[bt,a(e(ye),{modelValue:e(i).expense_date,"onUpdate:modelValue":s[7]||(s[7]=l=>e(i).expense_date=l),dateFormat:"dd/mm/yy",class:"w-full",inputClass:"py-3.5 rounded-xl border-slate-200"},null,8,["modelValue"])]),t("div",gt,[yt,a(e(F),{modelValue:e(i).provider,"onUpdate:modelValue":s[8]||(s[8]=l=>e(i).provider=l),class:"w-full py-3.5 rounded-xl border-slate-200 focus:ring-4 focus:ring-primary-50",placeholder:"Nom du fournisseur"},null,8,["modelValue"])]),t("div",wt,[kt,a(e(F),{modelValue:e(i).invoice_number,"onUpdate:modelValue":s[9]||(s[9]=l=>e(i).invoice_number=l),class:"w-full py-3.5 rounded-xl border-slate-200 focus:ring-4 focus:ring-primary-50",placeholder:"Numéro de facture"},null,8,["modelValue"])]),t("div",Vt,[Ct,a(e(F),{modelValue:e(i).label,"onUpdate:modelValue":s[10]||(s[10]=l=>e(i).label=l),class:"w-full py-3.5 rounded-xl border-slate-200 focus:ring-4 focus:ring-primary-50",placeholder:"Libellé de la dépense"},null,8,["modelValue"])]),t("div",jt,[St,a(e(y),{modelValue:e(i).category_id,"onUpdate:modelValue":s[11]||(s[11]=l=>e(i).category_id=l),options:v.categories,optionLabel:"name",optionValue:"id",class:"w-full rounded-xl border-slate-200 py-1"},null,8,["modelValue","options"])]),t("div",$t,[Ut,a(e(y),{modelValue:e(i).payment_method,"onUpdate:modelValue":s[12]||(s[12]=l=>e(i).payment_method=l),options:["Carte","Espèces","Virement"],class:"w-full rounded-xl border-slate-200 py-1"},null,8,["modelValue"])]),t("div",Tt,[Ft,a(e(y),{modelValue:e(i).project_id,"onUpdate:modelValue":s[13]||(s[13]=l=>e(i).project_id=l),options:v.projects,optionLabel:"name",optionValue:"id",class:"w-full rounded-xl border-slate-200 py-1",showClear:""},null,8,["modelValue","options"])]),t("div",Dt,[At,a(e(y),{modelValue:e(i).vehicle_id,"onUpdate:modelValue":s[14]||(s[14]=l=>e(i).vehicle_id=l),options:v.vehicles,optionLabel:"license_plate",optionValue:"id",class:"w-full rounded-xl border-slate-200 py-1",showClear:""},null,8,["modelValue","options"])]),t("div",Et,[Nt,a(e(be),{modelValue:e(i).description,"onUpdate:modelValue":s[15]||(s[15]=l=>e(i).description=l),rows:"3",class:"w-full p-4 rounded-2xl border border-slate-200 bg-slate-50 focus:bg-white focus:ring-4 focus:ring-primary-50 transition-all text-sm outline-none",placeholder:"Description détaillée de la dépense"},null,8,["modelValue"])])])])])])]),_:1},8,["visible"]),a(e(X),{ref_key:"op",ref:q,class:"p-3"},{default:x(()=>[t("h4",Ot,d(e(n)("common.columnSelector.title")),1),a(e(Se),{modelValue:E.value,"onUpdate:modelValue":s[17]||(s[17]=l=>E.value=l),options:A.value,optionLabel:"header",optionValue:"field",display:"chip",class:"w-64"},null,8,["modelValue","options"])]),_:1},512),a(e(X),{ref_key:"filtersOp",ref:G,class:"p-4"},{default:x(()=>[t("div",Bt,[t("div",null,[t("label",Mt,d(e(n)("expenses.filter.status")),1),a(e(y),{modelValue:c.value.status,"onUpdate:modelValue":s[18]||(s[18]=l=>c.value.status=l),options:["pending","approved","rejected","paid"],showClear:"",class:"w-full mt-1"},null,8,["modelValue"])]),t("div",null,[t("label",zt,d(e(n)("expenses.filter.category")),1),a(e(y),{modelValue:c.value.category_id,"onUpdate:modelValue":s[19]||(s[19]=l=>c.value.category_id=l),options:v.categories,optionLabel:"name",optionValue:"id",showClear:"",class:"w-full mt-1"},null,8,["modelValue","options"])]),a(e(u),{label:e(n)("expenses.filter.apply"),icon:"pi pi-check",onClick:e(L),class:"w-full"},null,8,["label","onClick"]),a(e(u),{label:e(n)("toolbar.resetFilters"),icon:"pi pi-filter-slash",text:"",onClick:se,class:"w-full"},null,8,["label"])])]),_:1},512)]),_:1},8,["title"])}}},fs=$e(Pt,[["__scopeId","data-v-8c4cdc5d"]]);export{fs as default};
