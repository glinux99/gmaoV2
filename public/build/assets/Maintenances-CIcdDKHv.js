import{T as vt}from"./index-CQck-czE.js";import{s as gt,a as yt,c as xt}from"./index-Dpj4P_iu.js";import{s as wt}from"./index-DR-PVOhd.js";import{s as kt}from"./index-DggD9_PH.js";import{s as Vt}from"./index-DWk9iUT_.js";import{d as Dt}from"./debounce-D2RdOKIu.js";import{a as qt,b as St,u as Ut,r as w,F as N,c as Y,T as be,d as T,w as G,h as le,e as A,f as y,g as e,o as m,i as r,Z as Ct,j as t,t as c,k as q,l as v,m as P,n as J,p as g,q as re,s as fe}from"./app-BTm5MPCd.js";import{_ as Tt}from"./AppLayout-PXrFRazT.js";import{s as At}from"./index-5eLJkV0u.js";import{s as he}from"./index-DGQuV0xQ.js";import{s as ve}from"./index-C9ua_LZc.js";import{s as Le}from"./index-CM1LmSBY.js";import{s as z}from"./index-DGDWVGXJ.js";import{s as D}from"./index-DR_P-HCg.js";import{s as de}from"./index-C3ZvT3G3.js";import{a as $t,s as Mt}from"./index-CwE9RYdH.js";import{s as ae}from"./index-B_B1CqLL.js";import{s as Ee}from"./index-BMBaB7B1.js";import{s as W}from"./index-X3iKIzTH.js";import{s as Nt}from"./index-CMJxrKp_.js";import"./index-DOcyrvpR.js";import"./index-U7kuayBf.js";import"./index-sPpDuk3t.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./DropdownLink-CqRe5Bfh.js";import"./index-CZPsBpjb.js";import"./index-DJd_Kodp.js";const jt={class:"min-h-screen bg-slate-50 p-4 md:p-10 font-sans"},It={class:"flex flex-col lg:flex-row justify-between items-start lg:items-center gap-6 mb-8"},Lt={class:"flex items-center gap-4"},Et=t("div",{class:"flex h-16 w-16 items-center justify-center rounded-[1rem] bg-primary-600 shadow-xl shadow-primary-200"},[t("i",{class:"pi pi-wrench text-2xl text-white"})],-1),Ft={class:"text-3xl font-black tracking-tighter text-slate-900 md:text-4xl"},Ot={class:"text-[10px] font-bold uppercase tracking-[0.3em] text-slate-400"},Pt={class:"flex w-full items-center gap-3 lg:w-auto"},zt=t("i",{class:"pi pi-file-excel"},null,-1),Rt=t("i",{class:"pi pi-plus-circle"},null,-1),Xt={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 mb-8"},Jt={class:"p-6 bg-white rounded-2xl border border-slate-200 shadow-sm flex items-center gap-5"},Wt=t("div",{class:"w-14 h-14 rounded-xl bg-slate-100 flex items-center justify-center"},[t("i",{class:"pi pi-wrench text-2xl text-slate-500"})],-1),Ht={class:"text-2xl font-black text-slate-800"},Bt=t("div",{class:"text-[10px] font-bold text-slate-400 uppercase tracking-widest"},"Maintenances Totales",-1),Qt={class:"p-6 bg-white rounded-2xl border border-slate-200 shadow-sm flex items-center gap-5"},Zt=t("div",{class:"w-14 h-14 rounded-xl bg-amber-50 flex items-center justify-center"},[t("i",{class:"pi pi-spin pi-spinner text-2xl text-amber-500"})],-1),Gt={class:"text-2xl font-black text-slate-800"},Kt=t("div",{class:"text-[10px] font-bold text-slate-400 uppercase tracking-widest"},"En Cours",-1),Yt={class:"p-6 bg-white rounded-2xl border border-slate-200 shadow-sm flex items-center gap-5"},es=t("div",{class:"w-14 h-14 rounded-xl bg-green-50 flex items-center justify-center"},[t("i",{class:"pi pi-check-circle text-2xl text-green-500"})],-1),ts={class:"text-2xl font-black text-slate-800"},ss=t("div",{class:"text-[10px] font-bold text-slate-400 uppercase tracking-widest"},"Terminées",-1),ls={class:"overflow-hidden rounded-[1rem] border border-white bg-white shadow-2xl shadow-slate-200/60"},as={class:"flex flex-col md:flex-row justify-between items-center gap-4 p-4"},ns={class:"flex items-center gap-2"},os=["onClick"],is=t("div",{class:"flex h-12 w-12 items-center justify-center rounded-2xl bg-slate-100 transition-all group-hover:bg-primary-100 text-primary-500"},[t("i",{class:"pi pi-tag text-xl"})],-1),rs={class:"flex flex-col"},ds={class:"text-lg font-black tracking-tight text-slate-800"},cs={class:"text-[10px] font-bold uppercase tracking-widest text-primary-500"},us={key:0,class:"flex flex-wrap gap-1"},ps={key:0,class:"flex w-fit items-center gap-3 rounded-full bg-slate-50 p-1 pr-4 border border-slate-100"},ms={class:"text-sm font-bold text-slate-700"},_s={class:"font-mono text-sm bg-primary-50 text-primary-600 px-2 py-1 rounded-md"},bs={class:"flex justify-end gap-2"},fs={class:"p-6 bg-slate-50 border-t border-b border-slate-200"},hs=t("h4",{class:"text-xs font-black uppercase tracking-widest text-slate-600 mb-4"},[t("i",{class:"pi pi-calendar-times mr-2"}),q(" Prochaines Occurrences Planifiées ")],-1),vs={key:0,class:"flex flex-wrap gap-3"},gs={class:"text-xs font-bold text-slate-700"},ys={key:1,class:"text-center py-4 text-slate-400 italic text-sm"},xs={class:"font-semibold mb-3"},ws={class:"flex items-center gap-3"},ks=t("div",{class:"w-8 h-8 bg-slate-900 rounded-xl flex items-center justify-center"},[t("i",{class:"pi pi-layers text-white text-xs"})],-1),Vs={class:"text-sm font-bold text-slate-900 leading-none"},Ds={class:"text-[10px] text-slate-500 font-medium mt-1 uppercase tracking-wider"},qs={key:0,class:"flex flex-col h-[75vh]"},Ss={class:"bg-slate-900 px-6 py-4 flex items-center justify-between shrink-0"},Us={class:"flex items-center gap-6"},Cs={class:"space-y-1"},Ts={class:"text-[9px] font-black text-primary-400 uppercase tracking-[0.2em]"},As={class:"text-white text-sm font-bold flex items-center gap-2"},$s=t("i",{class:"pi pi-external-link text-[10px] text-slate-500"},null,-1),Ms=t("div",{class:"h-8 w-px bg-slate-800"},null,-1),Ns={class:"space-y-1"},js={class:"text-[9px] font-black text-slate-500 uppercase tracking-[0.2em]"},Is={class:"text-white text-sm font-bold"},Ls={class:"flex gap-2"},Es={class:"flex-1 overflow-y-auto bg-slate-50/50 p-6 space-y-6"},Fs={class:"flex items-center px-4 py-2 border-b border-slate-100 bg-white sticky top-0 z-10"},Os={class:"text-[10px] font-black text-slate-400 mr-4"},Ps={class:"flex items-center gap-4"},zs={class:"flex items-center gap-2 px-3 py-1 bg-slate-100 rounded text-[10px] font-bold text-slate-600 uppercase"},Rs={class:"p-2 grid grid-cols-12 gap-2"},Xs={class:"col-span-12 lg:col-span-7 space-y-4"},Js={class:"p-2 grid grid-cols-12 gap-2"},Ws={class:"col-span-12 lg:col-span-6 space-y-4"},Hs={class:"p-4 border border-slate-100 rounded-md bg-slate-50/30"},Bs={class:"text-[10px] font-black text-slate-900 uppercase mb-3 flex items-center gap-2"},Qs=t("i",{class:"pi pi-user text-primary-500"},null,-1),Zs={class:"space-y-3"},Gs={class:"field"},Ks={class:"field"},Ys={class:"col-span-12 lg:col-span-6 space-y-4"},el={class:"p-4 border border-slate-100 rounded-md flex flex-col"},tl={class:"text-[10px] font-black text-slate-900 uppercase mb-3 flex items-center gap-2"},sl=t("i",{class:"pi pi-box text-primary-500"},null,-1),ll={class:"mt-3 p-3 bg-primary-50 rounded border border-primary-100"},al={class:"flex items-center justify-between text-[10px]"},nl={class:"font-bold text-primary-700"},ol={class:"p-4 border border-slate-100 rounded-md bg-slate-50/30"},il={class:"text-[10px] font-black text-slate-900 uppercase mb-3 flex items-center gap-2"},rl=t("i",{class:"pi pi-calendar text-primary-500"},null,-1),dl={class:"grid grid-cols-2 gap-2"},cl={class:"field"},ul={class:"text-[9px] font-bold text-slate-500 uppercase"},pl={class:"field"},ml={class:"text-[9px] font-bold text-slate-500 uppercase"},_l={class:"field col-span-2"},bl={class:"text-[9px] font-bold text-slate-500 uppercase"},fl={class:"col-span-12 lg:col-span-5 space-y-4"},hl={class:"p-4 border border-slate-100 rounded-md bg-white shadow-inner flex flex-col h-[180px]"},vl={class:"flex justify-between items-center mb-2"},gl={class:"text-[10px] font-black text-slate-900 uppercase"},yl={class:"flex-1 overflow-y-auto space-y-2 pr-1 custom-scrollbar"},xl={key:0,class:"text-center py-4 text-[10px] text-slate-400 italic font-medium"},wl={class:"p-4 border border-slate-100 rounded-md bg-white shadow-inner flex flex-col h-[180px]"},kl={class:"flex justify-between items-center mb-2"},Vl={class:"text-[10px] font-black text-slate-900 uppercase"},Dl={class:"flex-1 overflow-hidden space-y-1"},ql={class:"px-6 py-4 border-t border-slate-200 bg-white flex justify-between items-center shrink-0"},Sl={class:"flex items-center gap-3"},Ul={class:"px-8 py-4 bg-slate-900 rounded-xl text-white flex justify-between items-center shadow-lg relative z-50"},Cl={class:"flex items-center gap-4"},Tl=t("div",{class:"p-2 bg-blue-500/20 rounded-lg border border-blue-500/30"},[t("i",{class:"pi pi-shield text-blue-400 text-xl"})],-1),Al={class:"flex flex-col"},$l={class:"text-sm font-black uppercase tracking-widest text-white leading-none"},Ml={class:"text-[9px] text-blue-300 font-bold uppercase tracking-tighter mt-1 italic"},Nl={class:"flex items-center gap-6"},jl={key:0,class:"flex flex-col items-end mr-4"},Il=t("span",{class:"text-[9px] font-bold text-slate-400 uppercase mb-1"},"Réseau Sélectionné",-1),Ll={class:"p-2"},El={class:"grid grid-cols-1 md:grid-cols-12 gap-8"},Fl={class:"md:col-span-7 space-y-6"},Ol={class:"p-6 bg-slate-50 rounded-3xl border border-slate-100 space-y-5"},Pl={class:"text-xs font-black uppercase tracking-widest text-primary-600 mb-2 flex items-center gap-2"},zl=t("i",{class:"pi pi-tag"},null,-1),Rl={class:"field"},Xl={for:"title",class:"text-[10px] font-bold uppercase text-slate-500 mb-1 block ml-1"},Jl={key:0,class:"p-error block mt-1"},Wl={class:"field"},Hl=t("label",{for:"network",class:"text-[10px] font-bold uppercase text-slate-500 mb-1 block ml-1"}," Réseau ",-1),Bl={key:0},Ql={key:1},Zl={class:"field"},Gl={for:"related_equipments",class:"text-[10px] font-bold uppercase text-slate-500 mb-1 block ml-1"},Kl={class:"field"},Yl={class:"flex flex-col gap-1"},ea={class:"flex items-center gap-2"},ta=t("i",{class:"pi pi-bolt text-primary-500 text-xs"},null,-1),sa={class:"font-bold text-sm"},la={class:"flex items-center gap-2 text-[10px] text-slate-400 uppercase tracking-wider ml-5"},aa=t("i",{class:"pi pi-map-marker"},null,-1),na={key:0,class:"p-error block mt-1"},oa={class:"field"},ia={for:"description",class:"text-[10px] font-bold uppercase text-slate-500 mb-1 block ml-1"},ra={key:0,class:"p-error block mt-1"},da={class:"space-y-4"},ca={class:"flex items-center justify-between px-2"},ua={class:"text-xs font-black uppercase tracking-widest text-slate-700 flex items-center gap-2"},pa=t("i",{class:"pi pi-sitemap text-primary-500"},null,-1),ma={key:0,class:"space-y-4 transition-all"},_a={key:0,class:"p-8 border-2 border-dashed border-slate-200 rounded-3xl text-center bg-slate-50/50"},ba=t("i",{class:"pi pi-exclamation-circle text-slate-300 text-3xl mb-3 block"},null,-1),fa={class:"text-xs font-bold text-slate-400 uppercase tracking-tight"},ha=["onClick"],va={class:"flex items-center gap-3"},ga=t("div",{class:"w-8 h-8 rounded-full bg-white flex items-center justify-center shadow-sm"},[t("i",{class:"pi pi-folder text-slate-400 text-xs"})],-1),ya={class:"font-black text-xs text-slate-700 uppercase tracking-wider"},xa={key:0,class:"p-4 space-y-6 border-t border-slate-50"},wa={class:"flex flex-wrap justify-between items-center gap-4 mb-4 border-b border-slate-200/60 pb-3"},ka={class:"text-xs font-black text-primary-600 uppercase"},Va={class:"flex gap-2"},Da={class:"space-y-3"},qa={key:0,class:"flex justify-end items-center gap-2"},Sa={class:"md:col-span-6"},Ua={class:"md:col-span-3"},Ca={class:"md:col-span-2 flex items-center justify-center gap-2"},Ta=["for"],Aa={class:"md:col-span-1 flex justify-end"},$a={key:1,class:"text-center py-4 text-[10px] font-bold text-slate-400 uppercase tracking-tighter italic"},Ma={class:"md:col-span-5 space-y-6"},Na={class:"p-8 bg-slate-900 rounded-[1rem] text-white shadow-2xl relative overflow-hidden"},ja=t("div",{class:"absolute top-0 right-0 p-6 opacity-10"},[t("i",{class:"pi pi-calendar-plus text-6xl"})],-1),Ia={class:"text-[10px] font-black uppercase tracking-[0.2em] mb-8 text-primary-400 flex items-center gap-2"},La=t("span",{class:"w-2 h-2 rounded-full bg-primary-500 animate-pulse"},null,-1),Ea={class:"space-y-6"},Fa={class:"grid grid-cols-2 gap-4"},Oa={class:"field"},Pa={class:"text-[9px] font-bold uppercase text-slate-400 mb-2 block ml-1"},za={key:0,class:"p-error block mt-1 text-red-400"},Ra={class:"field"},Xa={class:"text-[9px] font-bold uppercase text-slate-400 mb-2 block ml-1"},Ja={key:0,class:"p-error block mt-1 text-red-400"},Wa={class:"field bg-white/5 p-4 rounded-2xl border border-white/10"},Ha={class:"text-[9px] font-bold uppercase text-slate-400 mb-3 block"},Ba={class:"flex gap-2"},Qa={key:0,class:"p-error block mt-1 text-red-400"},Za={class:"grid grid-cols-2 gap-4"},Ga={class:"field"},Ka={class:"text-[9px] font-bold uppercase text-slate-400 mb-2 block ml-1"},Ya={class:"field"},en={class:"text-[9px] font-bold uppercase text-slate-400 mb-2 block ml-1"},tn={class:"grid grid-cols-2 gap-4"},sn={class:"field"},ln={class:"text-[9px] font-bold uppercase text-slate-400 mb-2 block ml-1"},an={class:"field"},nn={class:"text-[9px] font-bold uppercase text-slate-400 mb-2 block ml-1"},on={class:"p-8 bg-primary-50 rounded-[1rem] border border-primary-100 shadow-sm space-y-6"},rn={class:"text-[10px] font-black uppercase tracking-widest text-primary-700 flex items-center gap-2"},dn=t("i",{class:"pi pi-sync"},null,-1),cn={class:"space-y-5"},un={class:"field"},pn={class:"text-[9px] font-bold uppercase text-primary-400 mb-2 block ml-1"},mn={key:0,class:"field animate-fade-in p-4 bg-white rounded-2xl border border-primary-100"},_n=t("label",{class:"text-[9px] font-bold uppercase text-primary-400 mb-2 block ml-1"},"Intervalle (en jours)",-1),bn={key:1,class:"field animate-fade-in p-4 bg-white rounded-2xl border border-primary-100"},fn={class:"text-[9px] font-bold uppercase text-primary-400 mb-2 block"},hn={key:2,class:"space-y-4 animate-fade-in p-4 bg-white rounded-2xl border border-primary-100 shadow-sm"},vn={class:"flex items-center gap-6 pb-2 border-b border-slate-50"},gn={class:"flex items-center"},yn=t("label",{for:"monthly_day_of_month",class:"ml-2 text-xs font-bold text-slate-600 cursor-pointer"},"Le jour du mois",-1),xn={class:"flex items-center"},wn=t("label",{for:"monthly_day_of_week",class:"ml-2 text-xs font-bold text-slate-600 cursor-pointer"},"Le jour de la semaine",-1),kn={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Vn={key:0,class:"field animate-fade-in col-span-full md:col-span-1"},Dn=t("label",{class:"text-[9px] font-bold uppercase text-primary-400 mb-1 block ml-1"},"Le quantième du mois",-1),qn={key:1,class:"field animate-fade-in col-span-full md:col-span-1"},Sn=t("label",{class:"text-[9px] font-bold uppercase text-primary-400 mb-1 block ml-1"},"Quel jour ?",-1),Un={class:"field p-4 bg-primary-600 rounded-2xl text-white shadow-lg shadow-primary-100"},Cn={class:"text-[9px] font-bold uppercase opacity-80 mb-2 block tracking-widest"},Tn={class:"flex items-center gap-3"},An={class:"relative flex-1"},$n=t("div",{class:"p-2.5 bg-primary-500 rounded-xl"},[t("i",{class:"pi pi-bell animate-pulse text-white"})],-1),Mn={key:3,class:"field animate-fade-in"},Nn={class:"text-[9px] font-bold uppercase text-primary-400 mb-2 block"},jn={class:"grid grid-cols-2 gap-4"},In={class:"p-6 bg-white rounded-3xl border border-slate-100 flex flex-col items-center text-center shadow-sm group hover:border-primary-300 transition-colors"},Ln=t("div",{class:"w-10 h-10 rounded-full bg-slate-50 flex items-center justify-center mb-3 group-hover:bg-primary-50"},[t("i",{class:"pi pi-clock text-slate-400 group-hover:text-primary-500"})],-1),En={for:"estimated_duration",class:"text-[8px] font-black uppercase text-slate-400 tracking-tighter mb-1 block"},Fn={class:"p-6 bg-white rounded-3xl border border-slate-100 flex flex-col items-center text-center shadow-sm group hover:border-emerald-300 transition-colors"},On=t("div",{class:"w-10 h-10 rounded-full bg-slate-50 flex items-center justify-center mb-3 group-hover:bg-emerald-50"},[t("i",{class:"pi pi-wallet text-slate-400 group-hover:text-emerald-500"})],-1),Pn={for:"cost",class:"text-[8px] font-black uppercase text-slate-400 tracking-tighter mb-1 block"},zn={class:"flex justify-between items-center w-full px-4 py-2"},Rn={class:"flex gap-3"},Xn={class:"field"},Jn=t("label",{for:"template_name",class:"font-semibold"},"Nom du modèle",-1),Wn={class:"p-error"},Hn={class:"mt-4 p-3 bg-slate-100 rounded-lg border border-slate-200"},Bn={class:"text-xs text-slate-600"},Qn=t("i",{class:"pi pi-info-circle mr-2"},null,-1),Fe=(F,b)=>{const S=new Date;S.setHours(0,0,0,0);const H=new Date(F);H.setHours(0,0,0,0);const a=H-S,I=Math.ceil(a/(1e3*60*60*24));return I<0?{label:"Passée",severity:"secondary"}:I===0?{label:"En cours",severity:"danger"}:b&&I<=b?{label:"Approche",severity:"warning"}:{label:"À venir",severity:"info"}},Oe=F=>{if(!F)return[];try{const b=JSON.parse(F);return Array.isArray(b)?b.sort((S,H)=>new Date(S)-new Date(H)):[]}catch(b){return console.error("Erreur d'analyse des dates régénérées:",b),[]}},Zn=F=>new Date(F).toLocaleDateString("fr-FR",{day:"2-digit",month:"long",year:"numeric"}),Do={__name:"Maintenances",props:{maintenances:Object,filters:Object,equipments:Array,users:Array,teams:Object,regions:Array,tasks:Array,zones:Array,spareParts:Array,networks:Array,equipmentTree:Array,instructionTemplates:Array},setup(F){var Ie;const b=F,S=qt(),H=St(),{t:a}=Ut(),I=w(!1),ne=w(!1),ee=w(!1),Pe=w(((Ie=b.filters)==null?void 0:Ie.search)||""),ge=w(),ye=w(),xe=w([]),te=w({global:{value:null,matchMode:N.CONTAINS},title:{operator:Y.AND,constraints:[{value:null,matchMode:N.STARTS_WITH}]},"assignable.name":{operator:Y.AND,constraints:[{value:null,matchMode:N.STARTS_WITH}]},status:{value:null,matchMode:N.EQUALS},priority:{value:null,matchMode:N.EQUALS},type:{value:null,matchMode:N.EQUALS},"region.designation":{operator:Y.AND,constraints:[{value:null,matchMode:N.STARTS_WITH}]}}),ze=()=>{te.value={global:{value:null,matchMode:N.CONTAINS},title:{operator:Y.AND,constraints:[{value:null,matchMode:N.STARTS_WITH}]},"assignable.name":{operator:Y.AND,constraints:[{value:null,matchMode:N.STARTS_WITH}]},status:{value:null,matchMode:N.EQUALS},priority:{value:null,matchMode:N.EQUALS},type:{value:null,matchMode:N.EQUALS},"region.designation":{operator:Y.AND,constraints:[{value:null,matchMode:N.STARTS_WITH}]}}},we=w([{field:"title",header:a("maintenances.columns.title")},{field:"equipments",header:a("maintenances.columns.equipments")},{field:"assignable",header:a("maintenances.columns.assignable")},{field:"status",header:a("maintenances.columns.status")},{field:"priority",header:a("maintenances.columns.priority")},{field:"scheduled_start_date",header:a("maintenances.columns.scheduled_start_date")},{field:"description",header:a("maintenances.columns.description")},{field:"estimated_duration",header:a("maintenances.columns.estimated_duration")},{field:"cost",header:a("maintenances.columns.cost")},{field:"region.designation",header:a("maintenances.columns.region")},{field:"recurrence_type",header:a("maintenances.columns.recurrence_type")},{field:"recurrence_interval",header:a("maintenances.columns.recurrence_interval")},{field:"recurrence_month_interval",header:a("maintenances.columns.recurrence_month_interval")},{field:"recurrence_days",header:a("maintenances.columns.recurrence_days")},{field:"recurrence_day_of_month",header:a("maintenances.columns.recurrence_day_of_month")},{field:"recurrence_month",header:a("maintenances.columns.recurrence_month")}]),$=w(we.value.slice(0,5).map(l=>l.field)),Re=l=>{ye.value.toggle(l)},oe=w({}),K=w(!1),Xe=w(!1),B=w(null),ce=w({}),ue=w({}),Q=w({}),Z=w(!1),U=be({name:"",instructions:[],id:null}),se=w(!1),O=w(null),Je=w([{label:a("maintenances.status.scheduled"),value:"scheduled"},{label:a("maintenances.status.in_progress"),value:"in_progress"},{label:a("maintenances.status.completed"),value:"completed"},{label:a("maintenances.status.completed_with_issues"),value:"completed_with_issues"},{label:a("maintenances.status.suspended"),value:"suspended"},{label:a("maintenances.status.canceled"),value:"canceled"},{label:a("maintenances.status.awaiting_resources"),value:"awaiting_resources"},{label:a("maintenances.status.to_be_reviewed_later"),value:"to_be_reviewed_later"}]),j=be({maintenance_id:null,activities:[]}),ke=()=>{var l,n,d,p;j.activities.push({title:`${a("maintenances.activityDialog.newActivity")} ${((l=O.value)==null?void 0:l.title)||""}`,status:"scheduled",assignable_type:null,assignable_id:null,equipment_ids:((n=O.value)==null?void 0:n.equipments.map(u=>u.id))||[],actual_start_time:(d=O.value)!=null&&d.scheduled_start_date?new Date(O.value.scheduled_start_date):null,actual_end_time:(p=O.value)!=null&&p.scheduled_end_date?new Date(O.value.scheduled_end_date):null,spare_parts:[],instructions:[]})},s=be({id:null,title:"",description:"",assignable_type:null,assignable_id:null,region_id:null,maintenance_schedule_id:null,intervention_request_id:null,network_node_id:null,network_id:null,type:"Préventive",status:"Planifiée",priority:"Moyenne",scheduled_start_date:null,scheduled_end_date:null,estimated_duration:null,started_at:null,completed_at:null,cost:null,recurrence_type:null,recurrence_interval:null,recurrence_month_interval:null,recurrence_days:[],recurrence_day:null,recurrence_day_of_month:null,recurrence_month:null,monthly_recurrence_type:"day_of_month",recurrence_week_of_month:1,reminder_days:null,custom_recurrence_config:null,placementType:null,zone_id:null,network_id:null,node_instructions:{},regenerated_dates:null,related_equipments:{},network_node_id:null}),Ve=w(["Préventive","Corrective","Améliorative","Périodique"]),De=T(()=>[{label:a("maintenances.status.scheduled"),value:"scheduled"},{label:a("maintenances.status.in_progress"),value:"in_progress"},{label:a("maintenances.status.completed"),value:"completed"},{label:a("maintenances.status.completed_with_issues"),value:"completed_with_issues"},{label:a("maintenances.status.suspended"),value:"suspended"},{label:a("maintenances.status.canceled"),value:"canceled"},{label:a("maintenances.status.awaiting_resources"),value:"awaiting_resources"},{label:a("maintenances.status.to_be_reviewed_later"),value:"to_be_reviewed_later"}]),pe=T(()=>[a("maintenances.priority.low"),a("maintenances.priority.medium"),a("maintenances.priority.high"),a("maintenances.priority.urgent")]),qe=w([{label:a("maintenances.assignableTypes.none"),value:null},{label:a("maintenances.assignableTypes.user"),value:"App\\Models\\User"},{label:a("maintenances.assignableTypes.team"),value:"App\\Models\\Team"}]),me=T(()=>{const l=b.maintenances.data.length,n=b.maintenances.data.filter(p=>p.status==="in_progress").length,d=b.maintenances.data.filter(p=>p.status==="completed").length;return{total:l,inProgress:n,completed:d}}),We=T(()=>s.assignable_type==="App\\Models\\User"?b.users:s.assignable_type==="App\\Models\\Team"?b.teams:[]),He=w([{label:a("maintenances.recurrence.none"),value:null},{label:a("maintenances.recurrence.daily"),value:"daily"},{label:a("maintenances.recurrence.weekly"),value:"weekly"},{label:a("maintenances.recurrence.monthly"),value:"monthly"},{label:a("maintenances.recurrence.quarterly"),value:"quarterly"},{label:a("maintenances.recurrence.biannual"),value:"biannual"},{label:a("maintenances.recurrence.annual"),value:"annual"},{label:a("maintenances.recurrence.custom"),value:"custom"}]),Se=w([{label:"Lundi",value:1},{label:"Mardi",value:2},{label:"Mercredi",value:3},{label:"Jeudi",value:4},{label:"Vendredi",value:5},{label:"Samedi",value:6},{label:"Dimanche",value:0}]),Ue=w([{label:"Texte",value:"text"},{label:"Nombre",value:"number"},{label:"Date",value:"date"},{label:"Image",value:"image"},{label:"Signature",value:"signature"},{label:"Booléen",value:"boolean"}]);w([{label:"Janvier",value:1},{label:"Février",value:2},{label:"Mars",value:3},{label:"Avril",value:4},{label:"Mai",value:5},{label:"Juin",value:6},{label:"Juillet",value:7},{label:"Août",value:8},{label:"Septembre",value:9},{label:"Octobre",value:10},{label:"Novembre",value:11},{label:"Décembre",value:12}]),w([{label:"Première",value:1},{label:"Deuxième",value:2},{label:"Troisième",value:3},{label:"Quatrième",value:4},{label:"Dernière",value:-1}]),G(()=>s.recurrence_type,l=>{}),G(()=>s.monthly_recurrence_type,l=>{l==="day_of_month"?s.recurrence_day=null:l==="day_of_week"&&(s.recurrence_day_of_month=null)}),G(()=>s.network_id,l=>{s.placementType=null,s.region_id=null,s.zone_id=null,s.network_node_id=null}),G(()=>s.related_equipments,(l,n)=>{const d=l?Object.keys(l):[];(n?Object.keys(n):[]).forEach(u=>{d.includes(u)||delete s.node_instructions[u]})}),G(()=>s.related_equipments,l=>{let n=[];typeof l=="object"&&l!==null&&!Array.isArray(l)?n=Object.keys(l).filter(d=>l[d].checked).map(String):Array.isArray(l)&&(n=l.map(String));for(const d in Q.value)n.includes(d)&&!s.node_instructions[d]&&(s.node_instructions[d]=JSON.parse(JSON.stringify(Q.value[d])));for(const d in s.node_instructions)n.includes(d)&&(Q.value[d]=JSON.parse(JSON.stringify(s.node_instructions[d])))},{deep:!0});const Be=()=>{s.reset(),ee.value=!1,ne.value=!1,K.value=!1,I.value=!0,Q.value={},s.network_node_id=null,oe.value={};const l=new Date,n=new Date(l.getFullYear(),l.getMonth(),l.getDate(),7,0),d=new Date(l.getFullYear(),l.getMonth(),l.getDate(),16,0);s.scheduled_start_date=n,s.scheduled_end_date=d},Ce=()=>{I.value=!1,ne.value=!1},Te=l=>{s.id=l.id,s.title=l.title,s.description=l.description,s.assignable_type=l.assignable_type,s.assignable_id=l.assignable_id,s.region_id=l.region_id,s.maintenance_schedule_id=l.maintenance_schedule_id,s.intervention_request_id=l.intervention_request_id,s.network_node_id=l.network_node_id,s.network_id=l.network_id,s.type=l.type,s.status=l.status,s.priority=l.priority,s.scheduled_start_date=l.scheduled_start_date?new Date(l.scheduled_start_date):null,s.scheduled_end_date=l.scheduled_end_date?new Date(l.scheduled_end_date):null,s.estimated_duration=l.estimated_duration,s.started_at=l.started_at,s.completed_at=l.completed_at,s.cost=l.cost,s.recurrence_type=l.recurrence_type,s.recurrence_interval=l.recurrence_interval,s.recurrence_month_interval=l.recurrence_month_interval,s.recurrence_days=l.recurrence_days,s.recurrence_day_of_month=l.recurrence_day_of_month,s.recurrence_month=l.recurrence_month,s.assignable_id=l.assignable_id,s.type=l.type,s.status=l.status,s.network_node_id=l.network_node_id,s.network_id=l.network_id,s.priority=l.priority,s.recurrence_month_interval=l.recurrence_month_interval,s.recurrence_month=l.recurrence_month,s.reminder_days=l.reminder_days,s.custom_recurrence_config=l.custom_recurrence_config,s.scheduled_start_date=l.scheduled_start_date?new Date(l.scheduled_start_date):null,s.scheduled_end_date=l.scheduled_end_date?new Date(l.scheduled_end_date):null,s.estimated_duration=l.estimated_duration,s.cost=l.cost,s.region_id=l.region_id,s.recurrence_type=l.recurrence_type,s.recurrence_interval=l.recurrence_interval,s.recurrence_days=l.recurrence_days||[],s.recurrence_day_of_month=l.recurrence_day_of_month,s.recurrence_day=l.recurrence_day,s.placementType=l.region_id?"region":l.zone_id?"zone":null,s.network_id=l.network_id,s.monthly_recurrence_type=l.monthly_recurrence_type,Ae.value=s.network_node_id,console.log(s.id),s.related_equipments=l.equipments.map(d=>d.id),console.log(l.instructions);const n={};if(l.instructions){const d=Array.isArray(l.instructions)?l.instructions:[l.instructions];for(const p of d)if(p&&p.equipment_id){const u=String(p.equipment_id);n[u]||(n[u]=[]),n[u].push({...p})}}s.node_instructions=n,Q.value=JSON.parse(JSON.stringify(n)),console.log("XXXXXXXXXXXXXXXXXXXXXX345"),console.log(s.recurrence_month),console.log(l.recurrence_month),I.value=!0,ee.value=!0},Ae=w(null),Qe=()=>{if(s.equipment_ids=s.related_equipments,ne.value=!0,!s.title||!s.type){S.add({severity:"error",summary:"Erreur",detail:"Veuillez remplir les champs obligatoires.",life:3e3});return}let l=[];if(typeof s.related_equipments=="object"&&s.related_equipments!==null&&!Array.isArray(s.related_equipments))l=Object.keys(s.related_equipments).filter(p=>s.related_equipments[p].checked).map(p=>parseInt(p,10)).filter(p=>!isNaN(p));else if(Array.isArray(s.related_equipments))l=s.related_equipments.map(p=>parseInt(p,10)).filter(p=>!isNaN(p));else if(s.related_equipments){const p=parseInt(s.related_equipments,10);isNaN(p)||(l=[p])}const n={};for(const p of l)s.node_instructions[p]&&(n[p]=s.node_instructions[p]);const d={...s.data(),equipment_ids:l,scheduled_start_date:s.scheduled_start_date?new Date(s.scheduled_start_date).toISOString().slice(0,19).replace("T"," "):null,scheduled_end_date:s.scheduled_end_date?new Date(s.scheduled_end_date).toISOString().slice(0,19).replace("T"," "):null};console.log("form.equipment_ids"),d.node_instructions=n,console.log(d),s.assignable_type||(d.assignable_id=null),console.log(s),ee.value?le.put(route("maintenances.update",s.id),d,{onSuccess:()=>{I.value=!1,S.add({severity:"success",summary:"Succès",detail:"Maintenance mise à jour avec succès.",life:3e3}),s.reset(),Q.value={}},onError:p=>{console.error("Erreur lors de la mise à jour de la maintenance",p),S.add({severity:"error",summary:"Erreur",detail:"Une erreur est survenue.",life:3e3}),s.errors=p}}):(console.log(d),le.post(route("maintenances.store"),d,{onSuccess:()=>{I.value=!1,S.add({severity:"success",summary:"Succès",detail:"Maintenance créée avec succès.",life:3e3}),s.reset(),Q.value={}},onError:p=>{console.error("Erreur lors de la sauvegarde de la maintenance",p),S.add({severity:"error",summary:"Erreur",detail:"Une erreur est survenue.",life:3e3}),s.errors=p}}))},Ze=l=>{const n=s.node_instructions[l];if(!n||n.length===0){S.add({severity:"warn",summary:"Attention",detail:"Aucune instruction à sauvegarder pour cet équipement.",life:3e3});return}U.reset(),U.id=null,U.instructions=n.map(({id:d,maintenance_id:p,equipment_id:u,created_at:f,updated_at:k,..._})=>_),Z.value=!0},Ge=()=>{U.post(route("instruction-templates.store"),{preserveScroll:!0,onSuccess:()=>{Z.value=!1,S.add({severity:"success",summary:"Succès",detail:"Modèle sauvegardé.",life:3e3})},onError:l=>{const n=Object.values(l).flat().join(" ; ");S.add({severity:"error",summary:"Erreur",detail:n||"Impossible de sauvegarder le modèle.",life:5e3})}})},Ke=l=>{l&&(U.id=l.id,U.name=l.name,U.instructions=l.instructions,Z.value=!0)},Ye=()=>{U.id?U.put(route("instruction-templates.update",U.id),{preserveScroll:!0,onSuccess:()=>{Z.value=!1,S.add({severity:"success",summary:"Succès",detail:"Modèle mis à jour.",life:3e3})}}):Ge()},et=l=>{l&&H.require({message:`Êtes-vous sûr de vouloir supprimer le modèle "${l.name}" ?`,header:"Confirmation de suppression",accept:()=>le.delete(route("instruction-templates.destroy",l.id),{preserveScroll:!0})})},tt=l=>{H.require({message:`Êtes-vous sûr de vouloir supprimer la maintenance "${l.title}" ?`,header:"Confirmation de suppression",icon:"pi pi-info-circle",acceptClass:"p-button-danger",accept:()=>{le.delete(route("maintenances.destroy",l.id),{onSuccess:()=>{S.add({severity:"success",summary:"Succès",detail:"Maintenance supprimée.",life:3e3})}})}})},st=()=>b.equipments,lt=l=>l.assignable_type==="App\\Models\\User"?b.users:l.assignable_type==="App\\Models\\Team"?b.teams:[],at=l=>{j.activities[l].instructions.push({label:"",type:"text",is_required:!1})},nt=(l,n)=>{j.activities[l].instructions.splice(n,1)},ot=(l,n=!1)=>{O.value=l,j.reset(),j.maintenance_id=l.id;const d=n?2:1;for(let p=0;p<d;p++)ke();se.value=!0},it=l=>{j.activities[l].spare_parts.push({id:null,quantity_used:1})},rt=(l,n)=>{j.activities[l].spare_parts.splice(n,1)},dt=l=>{j.activities.splice(l,1)},ct=()=>{console.log({...j}),j.post(route("activities.bulkStore"),{onSuccess:()=>{se.value=!1,S.add({severity:"success",summary:"Succès",detail:"Activités créées avec succès.",life:3e3})},onError:l=>{console.error(l),S.add({severity:"error",summary:"Erreur",detail:"La création des activités a échoué.",life:4e3})}})};Dt(()=>{le.get(route("maintenances.index"),{search:Pe.value},{preserveState:!0,replace:!0})},400);const $e=()=>{ge.value.exportCSV()},ut=l=>({scheduled:"info",in_progress:"warning",completed:"success",completed_with_issues:"danger",suspended:"warning",canceled:"secondary",awaiting_resources:"help",to_be_reviewed_later:"contrast","En retard":"danger"})[l]||null,pt=l=>({Basse:"info",Moyenne:"success",Haute:"warning",Urgente:"danger"})[l]||null;T(()=>ee.value?a("maintenances.formDialog.editTitle"):a("maintenances.formDialog.createTitle"));const mt=T(()=>{if(!R.value.length)return[];const l=new Map,n=(d,p)=>{for(const u of d){if(u.children&&u.children.some(f=>f.key===p))return u;if(u.children){const f=n(u.children,p);if(f)return f}}return null};return R.value.forEach(d=>{const p=n(_e.value,d.key),u=p?p.key:"root",f=p?p.label:a("maintenances.formDialog.parentGroupLabel");l.has(u)||l.set(u,{parent:{key:u,label:f},children:[]}),l.get(u).children.push(d)}),Array.from(l.values())}),_t=l=>{ue.value[l]=!(ue.value[l]??!0)},Me=l=>ue.value[l]??!0,bt=l=>{s.node_instructions[l]||(s.node_instructions[l]=[]),s.node_instructions[l].push({label:"",type:"text",is_required:!1})},ft=(l,n)=>{s.node_instructions[l]&&s.node_instructions[l][n]&&s.node_instructions[l].splice(n,1)},ht=l=>{B.value=l,ce.value={},Ne.value.filter(n=>String(n.value)!==String(l)),Xe.value=!0,console.log(`Copie initiée depuis la source : ${l}`)};T(()=>B.value?R.value.find(l=>l.key===B.value):null),T(()=>{const l=B.value;if(!l)return[];const n=new Set(R.value.filter(p=>p.key!==l&&oe.value[p.key]).map(p=>p.key)),d=p=>p.map(u=>{const f=u.children?d(u.children):[];return n.has(u.key)||f.length>0?{...u,children:f.length>0?f:void 0}:null}).filter(Boolean);return d(_e.value)}),T(()=>{const l=B.value;if(!l)return[];const n=R.value.filter(u=>u.key!==l&&oe.value[u.key]),d=new Map,p=(u,f)=>{for(const k of u){if(k.children&&k.children.some(_=>_.key===f))return k;if(k.children){const _=p(k.children,f);if(_)return _}}return null};return n.forEach(u=>{const f=p(_e.value,u.key);f&&(d.has(f.key)||d.set(f.key,{parent:f,children:[]}),d.get(f.key).children.push(u))}),Array.from(d.values())});const R=T(()=>{if(!s.related_equipments)return[];let l=[];typeof s.related_equipments=="object"&&!Array.isArray(s.related_equipments)&&s.related_equipments!==null?l=Object.keys(s.related_equipments).filter(p=>s.related_equipments[p].checked):Array.isArray(s.related_equipments)&&(l=s.related_equipments.map(String));const n=[],d=p=>{for(const u of p)l.includes(String(u.id))&&n.push(u),u.children&&d(u.children)};return d(b.equipmentTree),n});T(()=>B.value?R.value.filter(l=>l.key!==B.value&&oe.value[l.key]):[]),T(()=>Object.keys(ce.value).filter(l=>ce.value[l]).length),T(()=>{if(!s.network_id)return b.regions;const l=b.networks.find(d=>d.id===s.network_id);if(!l||!l.nodes)return[];const n=new Set(l.nodes.filter(d=>d.region_id).map(d=>d.region_id));return b.regions.filter(d=>n.has(d.id))}),T(()=>{if(!s.network_id)return b.zones;const l=b.networks.find(d=>d.id===s.network_id);if(!l||!l.nodes)return[];const n=new Set(l.nodes.filter(d=>d.zone_id).map(d=>d.zone_id));return b.zones.filter(d=>n.has(d.id))});const _e=T(()=>{if(!s.network_id)return[];const l=b.networks.find(_=>_.id===s.network_id);if(!l||!l.nodes)return[];const n=new Map((b.equipments??[]).map(_=>[_.id,_])),d=new Map((b.regions??[]).map(_=>[_.id,_])),p=new Map((b.zones??[]).map(_=>[_.id,_])),u=new Map,f=new Set;return l.nodes.filter(_=>{const V=`${_.equipment_id}-${_.region_id}-${_.zone_id}`;return f.has(V)?!1:(f.add(V),!0)}).forEach(_=>{const V=d.get(_.region_id),o=p.get(_.zone_id),i=n.get(_.equipment_id);if(!V)return;u.has(V.id)||u.set(V.id,{key:`region-${V.id}`,label:V.designation||V.name||"Région sans nom",selectable:!1,children:new Map});const x=u.get(V.id);if(i){const h=o?`zone-${o.id}`:"no-zone",L=o?o.title||o.name||"Zone sans titre":"Hors zone";x.children.has(h)||x.children.set(h,{key:h,label:L,selectable:!1,children:[]});const C=i.designation||i.name||i.tag||"Équipement inconnu",ie=o?`${C} / ${L}`:C;x.children.get(h).children.push({key:String(_.id),label:ie,data:_})}}),Array.from(u.values()).map(_=>({..._,children:Array.from(_.children.values())}))}),Ne=T(()=>{var f;if(!s.network_id)return[];const l=b.networks.find(k=>k.id===s.network_id);if(!l||!l.nodes)return[];const n=new Map((b.equipments??[]).map(k=>[k.id,k])),d=new Map;(b.zones??(b.regions??[]).flatMap(k=>k.zones??[])).forEach(k=>d.set(k.id,k));const u=((f=l.region)==null?void 0:f.designation)||"Région Réseau Indéfinie";return l.nodes.map(k=>{const _=n.get(k.equipment_id),V=d.get(k.zone_id),o=_!=null&&_.tag?`[${_.tag}] `:"",i=(_==null?void 0:_.designation)||"Équipement sans nom",x=(V==null?void 0:V.nomenclature)||(V==null?void 0:V.title)||"Zone non définie";return{value:k.id,label:`${o}${i} / ${x} / ${u}`,equipment_id:k.equipment_id}}).sort((k,_)=>k.label.localeCompare(_.label))});G(()=>s.network_id,()=>{s.network_node_id=Ae.value}),G(()=>s.network_node_id,l=>{if(!l){s.related_equipments=[],s.region_id=null;return}const n=b.networks.find(p=>p.id===s.network_id);if(!n||!n.nodes)return;const d=n.nodes.find(p=>p.id===l);d?(s.region_id=n.region_id,s.related_equipments=d.equipment_id?[d.equipment_id]:[],console.log(`Région ID ${d.region_id} et Équipement ID ${d.equipment_id} liés automatiquement au nœud ${l}`)):(s.region_id=null,s.related_equipments=[])},{immediate:!0});const je=l=>{var d;if(!l)return"";const n=(d=l.region)!=null&&d.designation?` (${l.region.designation})`:"";return`${l.name}${n}`};return(l,n)=>{const d=Vt,p=kt,u=wt,f=gt,k=yt,_=xt,V=vt;return m(),A(Tt,{title:e(a)("maintenances.title")},{default:y(()=>[r(e(Ct),{title:"Maintenances"}),r(d),r(p),t("div",jt,[t("div",It,[t("div",Lt,[Et,t("div",null,[t("h1",Ft,c(e(a)("maintenances.headTitle")),1),t("p",Ot,c(e(a)("maintenances.subtitle")),1)])]),t("div",Pt,[t("button",{onClick:$e,class:"flex flex-1 items-center justify-center gap-2 rounded-2xl border border-slate-200 bg-white px-5 py-3 text-sm font-bold text-emerald-600 shadow-sm transition-all hover:bg-emerald-50 active:scale-95 lg:flex-none"},[zt,q(" "+c(e(a)("maintenances.exportExcel")),1)]),t("button",{onClick:Be,class:"flex flex-[2] items-center justify-center gap-2 rounded-2xl bg-primary-600 px-6 py-4 text-sm font-black text-white shadow-lg shadow-primary-100 transition-all hover:bg-primary-700 active:scale-95 lg:flex-none"},[Rt,q(" "+c(e(a)("maintenances.new")),1)])])]),t("div",Xt,[t("div",Jt,[Wt,t("div",null,[t("div",Ht,c(me.value.total),1),Bt])]),t("div",Qt,[Zt,t("div",null,[t("div",Gt,c(me.value.inProgress),1),Kt])]),t("div",Yt,[es,t("div",null,[t("div",ts,c(me.value.completed),1),ss])])]),t("div",ls,[r(k,{value:F.maintenances.data,ref_key:"dt",ref:ge,dataKey:"id",expandedRows:xe.value,"onUpdate:expandedRows":n[1]||(n[1]=o=>xe.value=o),paginator:!0,rows:10,scrollable:"",scrollHeight:"600px",class:"v11-table",filters:te.value,"onUpdate:filters":n[2]||(n[2]=o=>te.value=o),filterDisplay:"menu",globalFilterFields:["title","assignable.name","status","priority","type","region.designation"],removableSort:""},{header:y(()=>[t("div",as,[r(e($t),{iconPosition:"left"},{default:y(()=>[r(e(Mt),{class:"pi pi-search text-slate-400"}),r(e(z),{modelValue:te.value.global.value,"onUpdate:modelValue":n[0]||(n[0]=o=>te.value.global.value=o),placeholder:e(a)("maintenances.searchPlaceholder"),class:"w-full md:w-80 rounded-2xl border-slate-200 bg-slate-50/50 focus:bg-white"},null,8,["modelValue","placeholder"])]),_:1}),t("div",ns,[r(u,{icon:"pi pi-filter-slash",outlined:"",severity:"secondary",onClick:ze,class:"rounded-xl"}),r(u,{icon:"pi pi-download",text:"",rounded:"",severity:"secondary",onClick:$e}),r(u,{icon:"pi pi-cog",text:"",rounded:"",severity:"secondary",onClick:Re})])])]),expansion:y(({data:o})=>[t("div",fs,[hs,o.regenerated_dates&&Oe(o.regenerated_dates).length>0?(m(),v("div",vs,[(m(!0),v(P,null,J(Oe(o.regenerated_dates),i=>(m(),v("div",{key:i,class:"flex items-center gap-2 bg-white p-2 rounded-lg border border-slate-200 shadow-sm"},[r(e(ae),{value:Fe(i,o.reminder_days).label,severity:Fe(i,o.reminder_days).severity,class:"text-[9px] uppercase font-black"},null,8,["value","severity"]),t("span",gs,c(Zn(i)),1)]))),128))])):(m(),v("div",ys," Aucune date de récurrence n'est configurée pour cette maintenance. "))])]),default:y(()=>[r(f,{expander:!0,headerStyle:"width: 3rem"}),r(f,{selectionMode:"multiple",headerStyle:"width: 4rem",class:"pl-8"}),$.value.includes("title")?(m(),A(f,{key:0,header:e(a)("maintenances.columns.title"),minWidth:"300px"},{body:y(({data:o})=>[t("div",{class:"group flex cursor-pointer items-center gap-4 py-2",onClick:i=>Te(o)},[is,t("div",rs,[t("span",ds,c(o.title),1),t("span",cs,"ID: #"+c(o.id.toString().padStart(4,"0")),1)])],8,os)]),filter:y(({filterModel:o})=>[r(e(z),{modelValue:o.constraints[0].value,"onUpdate:modelValue":i=>o.constraints[0].value=i,type:"text",class:"p-column-filter",placeholder:e(a)("maintenances.filter.title")},null,8,["modelValue","onUpdate:modelValue","placeholder"])]),_:1},8,["header"])):g("",!0),$.value.includes("equipments")?(m(),A(f,{key:1,header:e(a)("maintenances.columns.equipments"),minWidth:"250px"},{body:y(o=>{var i;return[(i=o.data.equipments)!=null&&i.length?(m(),v("div",us,[(m(!0),v(P,null,J(o.data.equipments,x=>(m(),A(e(ae),{key:x.id,value:x.designation,class:"!bg-slate-200 !text-slate-700 !font-bold"},null,8,["value"]))),128))])):g("",!0)]}),_:1},8,["header"])):g("",!0),$.value.includes("assignable")?(m(),A(f,{key:2,field:"assignable.name",header:e(a)("maintenances.columns.assignable"),minWidth:"200px"},{body:y(o=>[o.data.assignable?(m(),v("div",ps,[r(e(Nt),{label:o.data.assignable.name[0],shape:"circle",class:"!bg-slate-900 !text-white !font-black"},null,8,["label"]),t("span",ms,c(o.data.assignable.name),1)])):g("",!0)]),filter:y(({filterModel:o})=>[r(e(z),{modelValue:o.value,"onUpdate:modelValue":i=>o.value=i,type:"text",class:"p-column-filter",placeholder:e(a)("maintenances.filter.assignable")},null,8,["modelValue","onUpdate:modelValue","placeholder"])]),_:1},8,["header"])):g("",!0),$.value.includes("status")?(m(),A(f,{key:3,field:"status",header:e(a)("maintenances.columns.status"),minWidth:"150px"},{body:y(o=>[r(e(ae),{value:o.data.status,severity:ut(o.data.status)},null,8,["value","severity"])]),filter:y(({filterModel:o})=>[r(e(D),{modelValue:o.value,"onUpdate:modelValue":i=>o.value=i,options:De.value,optionLabel:"label",optionValue:"value",placeholder:e(a)("maintenances.filter.status"),class:"p-column-filter",showClear:""},null,8,["modelValue","onUpdate:modelValue","options","placeholder"])]),_:1},8,["header"])):g("",!0),$.value.includes("priority")?(m(),A(f,{key:4,field:"priority",header:e(a)("maintenances.columns.priority"),minWidth:"150px"},{body:y(o=>[r(e(ae),{value:o.data.priority,severity:pt(o.data.priority)},null,8,["value","severity"])]),filter:y(({filterModel:o})=>[r(e(D),{modelValue:o.value,"onUpdate:modelValue":i=>o.value=i,options:pe.value,placeholder:e(a)("maintenances.filter.priority"),class:"p-column-filter",showClear:""},null,8,["modelValue","onUpdate:modelValue","options","placeholder"])]),_:1},8,["header"])):g("",!0),$.value.includes("scheduled_start_date")?(m(),A(f,{key:5,field:"scheduled_start_date",header:e(a)("maintenances.columns.scheduled_start_date"),minWidth:"200px"},{body:y(o=>[t("span",_s,c(new Date(o.data.scheduled_start_date).toLocaleString()),1)]),_:1},8,["header"])):g("",!0),$.value.includes("type")?(m(),A(f,{key:6,field:"type",header:e(a)("maintenances.columns.type"),sortable:!0,style:{"min-width":"10rem"}},{body:y(o=>[q(c(o.data.type),1)]),filter:y(({filterModel:o})=>[r(e(D),{modelValue:o.value,"onUpdate:modelValue":i=>o.value=i,options:Ve.value,placeholder:e(a)("maintenances.filter.type"),class:"p-column-filter",showClear:""},null,8,["modelValue","onUpdate:modelValue","options","placeholder"])]),_:1},8,["header"])):g("",!0),$.value.includes("description")?(m(),A(f,{key:7,field:"description",header:e(a)("maintenances.columns.description"),sortable:!0,style:{"min-width":"15rem"}},null,8,["header"])):g("",!0),$.value.includes("estimated_duration")?(m(),A(f,{key:8,field:"estimated_duration",header:e(a)("maintenances.columns.estimated_duration"),sortable:!0,style:{"min-width":"10rem"}},{body:y(o=>[q(c(o.data.estimated_duration)+" min ",1)]),_:1},8,["header"])):g("",!0),$.value.includes("cost")?(m(),A(f,{key:9,field:"cost",header:e(a)("maintenances.columns.cost"),sortable:!0,style:{"min-width":"10rem"}},{body:y(o=>[q(c(o.data.cost)+" USD ",1)]),_:1},8,["header"])):g("",!0),$.value.includes("region.designation")?(m(),A(f,{key:10,field:"region.designation",header:e(a)("maintenances.columns.region"),sortable:!0,style:{"min-width":"10rem"}},{body:y(o=>[q(c(o.data.region?o.data.region.designation:"N/A"),1)]),filter:y(({filterModel:o})=>[r(e(z),{modelValue:o.value,"onUpdate:modelValue":i=>o.value=i,type:"text",class:"p-column-filter",placeholder:e(a)("maintenances.filter.region")},null,8,["modelValue","onUpdate:modelValue","placeholder"])]),_:1},8,["header"])):g("",!0),$.value.includes("recurrence_type")?(m(),A(f,{key:11,field:"recurrence_type",header:e(a)("maintenances.columns.recurrence_type"),sortable:!0,style:{"min-width":"10rem"}},{body:y(o=>[q(c(o.data.recurrence_type||"Aucune"),1)]),_:1},8,["header"])):g("",!0),r(f,{header:e(a)("maintenances.columns.actions"),alignFrozen:"right",frozen:"",class:"pr-8"},{body:y(({data:o})=>[t("div",bs,[r(u,{icon:"pi pi-pencil",text:"",rounded:"",onClick:i=>Te(o),class:"!text-slate-400 hover:!bg-primary-50 hover:!text-primary-600 transition-all"},null,8,["onClick"]),re(r(u,{icon:"pi pi-bolt",text:"",rounded:"",onClick:i=>ot(o,!1),class:"!text-slate-400 hover:!bg-green-50 hover:!text-green-600 transition-all"},null,8,["onClick"]),[[V,"Créer une activité",void 0,{top:!0}]]),r(u,{icon:"pi pi-trash",text:"",rounded:"",onClick:i=>tt(o),class:"!text-slate-400 hover:!bg-red-50 hover:!text-red-500 transition-all"},null,8,["onClick"])])]),_:1},8,["header"])]),_:1},8,["value","expandedRows","filters"]),r(e(At),{ref_key:"op",ref:ye,appendTo:"body",id:"column_op",class:"p-4"},{default:y(()=>[t("div",xs,c(e(a)("maintenances.columnSelector.title")),1),r(e(he),{modelValue:$.value,"onUpdate:modelValue":n[3]||(n[3]=o=>$.value=o),options:we.value,optionLabel:"header",optionValue:"field",display:"chip",placeholder:e(a)("maintenances.columnSelector.placeholder"),class:"w-full max-w-xs"},null,8,["modelValue","options","placeholder"])]),_:1},512)])]),r(e(ve),{visible:se.value,"onUpdate:visible":n[5]||(n[5]=o=>se.value=o),modal:"",header:!1,closable:!1,class:"v12-enterprise-dialog w-full max-w-7xl",pt:{root:{class:"border-none shadow-2xl"},header:{class:"bg-slate-50 border-b border-slate-200 p-4"},content:{class:"p-0"}}},{header:y(()=>[t("div",ws,[ks,t("div",null,[t("h2",Vs,c(e(a)("maintenances.activityDialog.batchManagerTitle")),1),t("p",Ds,c(e(a)("maintenances.activityDialog.batchManagerSubtitle")),1)])])]),default:y(()=>[O.value?(m(),v("div",qs,[t("div",Ss,[t("div",Us,[t("div",Cs,[t("span",Ts,c(e(a)("maintenances.activityDialog.parentMaintenance")),1),t("h3",As,[q(c(O.value.title)+" ",1),$s])]),Ms,t("div",Ns,[t("span",js,c(e(a)("maintenances.activityDialog.activityVolume")),1),t("p",Is,c(e(j).activities.length)+" Item(s)",1)])]),t("div",Ls,[r(u,{label:e(a)("maintenances.activityDialog.newActivity"),icon:"pi pi-plus",class:"p-button-sm p-button-raised bg-primary-600 border-none text-[11px] font-bold",onClick:ke},null,8,["label"])])]),t("div",Es,[(m(!0),v(P,null,J(e(j).activities,(o,i)=>{var x;return m(),v("div",{key:i,class:"bg-white border border-slate-200 rounded-lg shadow-sm transition-all hover:border-slate-300"},[t("div",Fs,[t("span",Os,"#0"+c(i+1),1),r(e(z),{modelValue:o.title,"onUpdate:modelValue":h=>o.title=h,class:"flex-1 !bg-transparent !border-none !shadow-none font-bold text-slate-800 focus:ring-0 py-1",placeholder:e(a)("maintenances.activityDialog.activityNamePlaceholder")},null,8,["modelValue","onUpdate:modelValue","placeholder"]),t("div",Ps,[t("div",zs,[q(c(e(a)("maintenances.activityDialog.statusLabel"))+" ",1),r(e(D),{modelValue:o.status,"onUpdate:modelValue":h=>o.status=h,options:Je.value,optionLabel:"label",optionValue:"value",class:"v12-minimal-dropdown"},null,8,["modelValue","onUpdate:modelValue","options"])]),re(r(u,{icon:"pi pi-clone",class:"p-button-text p-button-secondary p-button-sm"},null,512),[[V,e(a)("maintenances.activityDialog.duplicateTooltip"),void 0,{top:!0}]]),r(u,{icon:"pi pi-trash",class:"p-button-text p-button-danger p-button-sm",onClick:h=>dt(i)},null,8,["onClick"])])]),t("div",Rs,[t("div",Xs,[t("div",Js,[t("div",Ws,[t("div",Hs,[t("h5",Bs,[Qs,q(" "+c(e(a)("maintenances.activityDialog.attribution")),1)]),t("div",Zs,[t("div",Gs,[r(e(D),{modelValue:o.assignable_type,"onUpdate:modelValue":h=>o.assignable_type=h,options:qe.value,optionLabel:"label",optionValue:"value",placeholder:e(a)("maintenances.activityDialog.entityTypePlaceholder"),class:"w-full v12-input"},null,8,["modelValue","onUpdate:modelValue","options","placeholder"])]),t("div",Ks,[r(e(D),{modelValue:o.assignable_id,"onUpdate:modelValue":h=>o.assignable_id=h,options:lt(o),optionLabel:"name",optionValue:"id",filter:"",disabled:!o.assignable_type,placeholder:e(a)("maintenances.activityDialog.responsiblePlaceholder"),class:"w-full v12-input"},null,8,["modelValue","onUpdate:modelValue","options","disabled","placeholder"])])])])]),t("div",Ys,[t("div",el,[t("h5",tl,[sl,q(" "+c(e(a)("maintenances.activityDialog.concernedAssets")),1)]),r(e(he),{modelValue:o.equipment_ids,"onUpdate:modelValue":h=>o.equipment_ids=h,options:st(i),optionLabel:"designation",optionValue:"id",display:"chip",class:"w-full v12-input flex-1",filter:"",placeholder:e(a)("maintenances.activityDialog.searchEquipmentsPlaceholder")},null,8,["modelValue","onUpdate:modelValue","options","placeholder"]),t("div",ll,[t("div",al,[t("span",nl,c(e(a)("maintenances.activityDialog.estimatedCost")),1),r(e(W),{modelValue:o.cost,"onUpdate:modelValue":h=>o.cost=h,mode:"currency",currency:"USD",class:"quantum-input-transparent text-right font-black"},null,8,["modelValue","onUpdate:modelValue"])])])])])]),t("div",ol,[t("h5",il,[rl,q(" "+c(e(a)("maintenances.activityDialog.planning")),1)]),t("div",dl,[t("div",cl,[t("label",ul,c(e(a)("maintenances.activityDialog.priority")),1),r(e(D),{modelValue:o.priority,"onUpdate:modelValue":h=>o.priority=h,options:pe.value,class:"w-full v12-input"},null,8,["modelValue","onUpdate:modelValue","options"])]),t("div",pl,[t("label",ml,c(e(a)("maintenances.activityDialog.durationInMinutes")),1),r(e(W),{modelValue:o.estimated_duration,"onUpdate:modelValue":h=>o.estimated_duration=h,class:"w-full v12-input"},null,8,["modelValue","onUpdate:modelValue"])]),t("div",_l,[t("label",bl,c(e(a)("maintenances.activityDialog.executionPeriod")),1),r(e(de),{modelValue:o.actual_start_time,"onUpdate:modelValue":h=>o.actual_start_time=h,showTime:"",hourFormat:"24",placeholder:e(a)("maintenances.activityDialog.start"),class:"w-full v12-input mb-1"},null,8,["modelValue","onUpdate:modelValue","placeholder"]),r(e(de),{modelValue:o.actual_end_time,"onUpdate:modelValue":h=>o.actual_end_time=h,showTime:"",hourFormat:"24",placeholder:e(a)("maintenances.activityDialog.end"),class:"w-full v12-input"},null,8,["modelValue","onUpdate:modelValue","placeholder"])])])])]),t("div",fl,[t("div",hl,[t("div",vl,[t("h5",gl,c(e(a)("maintenances.activityDialog.checklist")),1),r(u,{icon:"pi pi-plus",class:"p-button-text p-button-sm !p-0 h-4 w-4",onClick:h=>at(i)},null,8,["onClick"])]),t("div",yl,[(m(!0),v(P,null,J(o.instructions,(h,L)=>(m(),v("div",{key:L,class:"flex items-center gap-2 bg-slate-50 p-1.5 rounded border border-slate-100"},[r(e(Ee),{modelValue:h.is_required,"onUpdate:modelValue":C=>h.is_required=C,binary:"",class:"scale-75"},null,8,["modelValue","onUpdate:modelValue"]),r(e(z),{modelValue:h.label,"onUpdate:modelValue":C=>h.label=C,placeholder:e(a)("maintenances.activityDialog.instructionPlaceholder"),class:"flex-1 text-[10px] border-none !bg-transparent p-0"},null,8,["modelValue","onUpdate:modelValue","placeholder"]),r(e(D),{modelValue:h.type,"onUpdate:modelValue":C=>h.type=C,options:Ue.value,optionLabel:"label",optionValue:"value",placeholder:e(a)("maintenances.activityDialog.selectType"),class:"v12-instruction-type-dropdown flex-1 text-[9px]"},null,8,["modelValue","onUpdate:modelValue","options","placeholder"]),r(u,{icon:"pi pi-trash",class:"p-button-danger p-button-text p-button-sm !p-0",onClick:C=>nt(i,L)},null,8,["onClick"])]))),128)),(x=o.instructions)!=null&&x.length?g("",!0):(m(),v("div",xl,c(e(a)("maintenances.activityDialog.zeroInstructions")),1))])]),t("div",wl,[t("div",kl,[t("h5",Vl,c(e(a)("maintenances.activityDialog.spareParts")),1),r(u,{icon:"pi pi-plus",class:"p-button-text p-button-sm !p-0 h-4 w-4",onClick:h=>it(i)},null,8,["onClick"])]),t("div",Dl,[(m(!0),v(P,null,J(o.spare_parts,(h,L)=>(m(),v("div",{key:L,class:"flex items-center gap-1 bg-slate-50 p-1 rounded border border-slate-100 min-w-0"},[r(e(D),{modelValue:h.id,"onUpdate:modelValue":C=>h.id=C,options:F.spareParts,optionLabel:"reference",optionValue:"id",filter:"",class:"flex-1 min-w-0 text-[9px] border-none !bg-transparent v12-spare-select"},null,8,["modelValue","onUpdate:modelValue","options"]),r(e(W),{modelValue:h.quantity_used,"onUpdate:modelValue":C=>h.quantity_used=C,min:1,inputClass:"w-[80px] text-[9px] p-0 text-center font-black bg-white border border-slate-200 rounded shadow-sm",class:"shrink-0"},null,8,["modelValue","onUpdate:modelValue"]),r(u,{icon:"pi pi-times",class:"p-button-text p-button-danger p-button-sm !p-0 shrink-0 w-4 h-4",onClick:C=>rt(i,L)},null,8,["onClick"])]))),128))])])])])])}),128))]),t("div",ql,[r(u,{label:e(a)("maintenances.activityDialog.resetForm"),icon:"pi pi-refresh",class:"p-button-text p-button-secondary text-xs font-bold"},null,8,["label"]),t("div",Sl,[r(u,{label:e(a)("maintenances.activityDialog.cancel"),class:"p-button-text p-button-secondary font-bold text-xs",onClick:n[4]||(n[4]=o=>se.value=!1)},null,8,["label"]),r(u,{label:e(a)("maintenances.activityDialog.validateAndDeploy"),icon:"pi pi-send",class:"bg-slate-900 border-none px-6 py-2.5 rounded text-xs font-black tracking-widest shadow-lg hover:bg-slate-800",onClick:ct,loading:e(j).processing},null,8,["label","loading"])])])])):g("",!0)]),_:1},8,["visible"]),r(e(ve),{visible:I.value,"onUpdate:visible":n[30]||(n[30]=o=>I.value=o),modal:"",header:!1,closable:!1,class:"quantum-dialog w-full max-w-7xl",pt:{mask:{style:"backdrop-filter: blur(4px)"}}},{footer:y(()=>[t("div",zn,[r(u,{label:e(a)("maintenances.formDialog.cancelChanges"),icon:"pi pi-times",class:"p-button-text p-button-secondary font-bold",onClick:Ce},null,8,["label"]),t("div",Rn,[r(u,{label:e(a)("maintenances.formDialog.savePlan"),icon:"pi pi-check-circle",class:"p-button-primary px-8 py-4 !rounded-2xl shadow-xl shadow-primary-100 font-black tracking-tight transition-all hover:scale-[1.02] active:scale-95",onClick:Qe,loading:e(s).processing},null,8,["label","loading"])])])]),default:y(()=>{var o;return[t("div",Ul,[t("div",Cl,[Tl,t("div",Al,[t("h2",$l,c(ee.value?e(a)("maintenances.formDialog.editTitle"):e(a)("maintenances.formDialog.createTitle")),1),t("span",Ml,c(e(a)("maintenances.formDialog.gmaoConsole")),1)])]),t("div",Nl,[e(s).network_id?(m(),v("div",jl,[Il,r(e(ae),{value:(o=b.networks.find(i=>i.id===e(s).network_id))==null?void 0:o.name,class:"bg-primary-500/20 text-primary-300 border border-primary-500/30"},null,8,["value"])])):g("",!0),r(u,{icon:"pi pi-times",variant:"text",severity:"secondary",rounded:"",onClick:Ce,class:"text-white hover:bg-white/10"})])]),t("div",Ll,[t("div",El,[t("div",Fl,[t("div",Ol,[t("h3",Pl,[zl,q(" "+c(e(a)("maintenances.formDialog.missionId")),1)]),t("div",Rl,[t("label",Xl,c(e(a)("maintenances.formDialog.interventionTitle")),1),r(e(z),{id:"title",modelValue:e(s).title,"onUpdate:modelValue":n[6]||(n[6]=i=>e(s).title=i),modelModifiers:{trim:!0},class:fe(["w-full",{"p-invalid":ne.value&&!e(s).title}]),placeholder:e(a)("maintenances.formDialog.interventionTitlePlaceholder")},null,8,["modelValue","class","placeholder"]),e(s).errors.title?(m(),v("small",Jl,c(e(s).errors.title),1)):g("",!0)]),t("div",Wl,[Hl,r(e(D),{id:"network",modelValue:e(s).network_id,"onUpdate:modelValue":n[7]||(n[7]=i=>e(s).network_id=i),options:b.networks,optionValue:"id",placeholder:"Sélectionner un réseau",filter:"",class:"w-full quantum-input !bg-white"},{value:y(i=>[i.value?(m(),v("div",Bl,c(je(b.networks.find(x=>x.id===i.value))),1)):(m(),v("span",Ql,c(i.placeholder),1))]),option:y(i=>[t("div",null,c(je(i.option)),1)]),_:1},8,["modelValue","options"])]),t("div",Zl,[t("label",Gl,c(e(a)("maintenances.formDialog.concernedEquipments")),1),t("div",Kl,[r(e(D),{id:"network_node_id",modelValue:e(s).network_node_id,"onUpdate:modelValue":n[8]||(n[8]=i=>e(s).network_node_id=i),options:Ne.value,optionLabel:"label",optionValue:"value",placeholder:e(a)("maintenances.formDialog.selectAssets"),filter:!0,showClear:!0,filterPlaceholder:"Rechercher un équipement, une zone...",class:"w-full quantum-input",disabled:!e(s).network_id},{option:y(i=>[t("div",Yl,[t("div",ea,[ta,t("span",sa,c(i.option.label.split(" / ")[0]),1)]),t("div",la,[aa,t("span",null,c(i.option.label.split(" / ").slice(1).join(" • ")),1)])])]),_:1},8,["modelValue","options","placeholder","disabled"])]),e(s).errors.related_equipments?(m(),v("small",na,c(e(s).errors.related_equipments),1)):g("",!0)]),t("div",oa,[t("label",ia,c(e(a)("maintenances.formDialog.detailedDescription")),1),r(e(Le),{id:"description",modelValue:e(s).description,"onUpdate:modelValue":n[9]||(n[9]=i=>e(s).description=i),rows:"4",class:"w-full p-4 rounded-2xl border border-slate-200 focus:ring-2 focus:ring-primary-500 text-sm bg-white",placeholder:e(a)("maintenances.formDialog.generalInstructions")},null,8,["modelValue","placeholder"]),e(s).errors.description?(m(),v("small",ra,c(e(s).errors.description),1)):g("",!0)])]),t("div",da,[t("div",ca,[t("h3",ua,[pa,q(" "+c(e(a)("maintenances.formDialog.configPerEquipment")),1)]),r(u,{label:K.value?e(a)("maintenances.formDialog.hideControlPoints"):e(a)("maintenances.formDialog.showControlPoints"),icon:K.value?"pi pi-chevron-up":"pi pi-cog",class:"p-button-text p-button-sm font-bold text-primary-600",onClick:n[10]||(n[10]=i=>K.value=!K.value)},null,8,["label","icon"])]),K.value?(m(),v("div",ma,[!R.value||R.value.length===0?(m(),v("div",_a,[ba,t("p",fa,c(e(a)("maintenances.formDialog.noEquipmentSelected")),1)])):(m(!0),v(P,{key:1},J(mt.value,i=>(m(),v("div",{key:i.parent.key,class:"border border-slate-100 rounded-3xl overflow-hidden bg-white shadow-sm"},[t("div",{class:"flex justify-between items-center p-4 bg-slate-50/80 cursor-pointer hover:bg-slate-100 transition-colors",onClick:x=>_t(i.parent.key)},[t("div",va,[ga,t("span",ya,c(i.parent.label),1)]),t("i",{class:fe([Me(i.parent.key)?"pi pi-chevron-up":"pi pi-chevron-down","text-[10px] text-slate-400"])},null,2)],8,ha),Me(i.parent.key)?(m(),v("div",xa,[(m(!0),v(P,null,J(i.children,x=>{var h,L,C,ie;return m(),v("div",{key:x.key,class:"p-5 rounded-2xl bg-slate-50/50 border border-slate-100"},[t("div",wa,[t("span",ka,c(x.label),1),t("div",Va,[(h=e(s).node_instructions[x.key])!=null&&h.length?(m(),A(u,{key:0,icon:"pi pi-copy",label:e(a)("maintenances.formDialog.clone"),class:"p-button-text p-button-sm text-[10px] font-bold",onClick:M=>ht(x.key)},null,8,["label","onClick"])):g("",!0),(L=e(s).node_instructions[x.key])!=null&&L.length?(m(),A(u,{key:1,icon:"pi pi-save",label:"Modèle",class:"p-button-text p-button-secondary p-button-sm text-[10px] font-bold",onClick:M=>Ze(x.key)},null,8,["onClick"])):g("",!0),r(u,{icon:"pi pi-plus",label:e(a)("maintenances.formDialog.addInstruction"),class:"p-button-primary p-button-sm text-[10px] font-bold shadow-sm",onClick:M=>bt(x.key)},null,8,["label","onClick"])])]),t("div",Da,[b.instructionTemplates&&b.instructionTemplates.length>0?(m(),v("div",qa,[(C=e(s).node_instructions[x.key])!=null&&C.template_id?(m(),v(P,{key:0},[re(r(u,{icon:"pi pi-pencil",onClick:M=>Ke(b.instructionTemplates.find(E=>E.id===e(s).node_instructions[x.key].template_id)),text:"",rounded:"",severity:"secondary"},null,8,["onClick"]),[[V,"Modifier le modèle appliqué",void 0,{top:!0}]]),re(r(u,{icon:"pi pi-trash",onClick:M=>et(b.instructionTemplates.find(E=>E.id===e(s).node_instructions[x.key].template_id)),text:"",rounded:"",severity:"danger"},null,8,["onClick"]),[[V,"Supprimer le modèle appliqué",void 0,{top:!0}]])],64)):g("",!0),r(e(D),{options:b.instructionTemplates,optionLabel:"name",placeholder:"Appliquer un modèle",class:"p-dropdown-sm !w-auto text-xs",onChange:M=>{const E=M.value,X=JSON.parse(JSON.stringify(E.instructions));e(s).node_instructions[x.key]=X,e(s).node_instructions[x.key].template_id=E.id,e(S).add({severity:"info",summary:"Modèle appliqué",detail:`Les instructions de '${M.value.name}' ont été chargées.`,life:3e3})}},null,8,["options","onChange"])])):g("",!0),(m(!0),v(P,null,J(e(s).node_instructions[x.key],(M,E)=>(m(),v("div",{key:E,class:"grid grid-cols-1 md:grid-cols-12 gap-3 items-center bg-white p-3 rounded-xl border border-slate-200 shadow-sm relative group"},[t("div",Sa,[r(e(z),{modelValue:M.label,"onUpdate:modelValue":X=>M.label=X,placeholder:e(a)("maintenances.formDialog.instructionLabelPlaceholder"),class:"w-full p-inputtext-sm border-none shadow-none font-medium"},null,8,["modelValue","onUpdate:modelValue","placeholder"])]),t("div",Ua,[r(e(D),{modelValue:M.type,"onUpdate:modelValue":X=>M.type=X,options:Ue.value,optionLabel:"label",optionValue:"value",class:"w-full p-inputtext-sm border-slate-100"},null,8,["modelValue","onUpdate:modelValue","options"])]),t("div",Ca,[r(e(Ee),{modelValue:M.is_required,"onUpdate:modelValue":X=>M.is_required=X,binary:"",inputId:`req-${x.key}-${E}`},null,8,["modelValue","onUpdate:modelValue","inputId"]),t("label",{for:`req-${x.key}-${E}`,class:"text-[9px] font-black uppercase text-slate-400 cursor-pointer"},c(e(a)("maintenances.formDialog.required")),9,Ta)]),t("div",Aa,[r(u,{icon:"pi pi-trash",class:"p-button-danger p-button-text p-button-sm opacity-0 group-hover:opacity-100 transition-opacity",onClick:X=>ft(x.key,E)},null,8,["onClick"])])]))),128)),(ie=e(s).node_instructions[x.key])!=null&&ie.length?g("",!0):(m(),v("div",$a,c(e(a)("maintenances.formDialog.noSpecificInstruction")),1))])])}),128))])):g("",!0)]))),128))])):g("",!0)])]),t("div",Ma,[t("div",Na,[ja,t("h4",Ia,[La,q(" "+c(e(a)("maintenances.formDialog.logisticsAndTiming")),1)]),t("div",Ea,[t("div",Fa,[t("div",Oa,[t("label",Pa,c(e(s).status==="Planifiée"?e(a)("maintenances.formDialog.plannedStart"):e(a)("maintenances.formDialog.actualStart")),1),r(e(de),{modelValue:e(s).scheduled_start_date,"onUpdate:modelValue":n[11]||(n[11]=i=>e(s).scheduled_start_date=i),showTime:"",dateFormat:"dd/mm/yy",showIcon:"",class:"quantum-calendar-dark w-full"},null,8,["modelValue"]),e(s).errors.scheduled_start_date?(m(),v("small",za,c(e(s).errors.scheduled_start_date),1)):g("",!0)]),t("div",Ra,[t("label",Xa,c(e(s).status==="Planifiée"?e(a)("maintenances.formDialog.plannedEnd"):e(a)("maintenances.formDialog.actualEnd")),1),r(e(de),{modelValue:e(s).scheduled_end_date,"onUpdate:modelValue":n[12]||(n[12]=i=>e(s).scheduled_end_date=i),showTime:"",dateFormat:"dd/mm/yy",showIcon:"",class:"quantum-calendar-dark w-full"},null,8,["modelValue"]),e(s).errors.scheduled_end_date?(m(),v("small",Ja,c(e(s).errors.scheduled_end_date),1)):g("",!0)])]),t("div",Wa,[t("label",Ha,c(e(a)("maintenances.formDialog.interventionResponsible")),1),t("div",Ba,[r(e(D),{modelValue:e(s).assignable_type,"onUpdate:modelValue":n[13]||(n[13]=i=>e(s).assignable_type=i),options:qe.value,optionLabel:"label",optionValue:"value",placeholder:e(a)("maintenances.formDialog.assignableTypePlaceholder"),class:"w-1/3 bg-transparent border-white/20 text-white"},null,8,["modelValue","options","placeholder"]),r(e(D),{modelValue:e(s).assignable_id,"onUpdate:modelValue":n[14]||(n[14]=i=>e(s).assignable_id=i),options:We.value,optionLabel:"name",optionValue:"id",placeholder:e(a)("maintenances.formDialog.assignableSelectPlaceholder"),disabled:!e(s).assignable_type,filter:"",class:"flex-1 bg-transparent border-white/20 text-white"},null,8,["modelValue","options","placeholder","disabled"])]),e(s).errors.assignable_id?(m(),v("small",Qa,c(e(s).errors.assignable_id),1)):g("",!0)]),t("div",Za,[t("div",Ga,[t("label",Ka,c(e(a)("maintenances.formDialog.maintenanceType")),1),r(e(D),{modelValue:e(s).type,"onUpdate:modelValue":n[15]||(n[15]=i=>e(s).type=i),options:Ve.value,class:"w-full bg-white/5 border-white/10 text-white rounded-xl"},null,8,["modelValue","options"])]),t("div",Ya,[t("label",en,c(e(a)("maintenances.formDialog.currentStatus")),1),r(e(D),{modelValue:e(s).status,"onUpdate:modelValue":n[16]||(n[16]=i=>e(s).status=i),options:De.value,optionLabel:"label",optionValue:"value",class:"w-full bg-white/5 border-white/10 text-white rounded-xl"},null,8,["modelValue","options"])])]),t("div",tn,[t("div",sn,[t("label",ln,c(e(a)("maintenances.formDialog.priorityLevel")),1),r(e(D),{modelValue:e(s).priority,"onUpdate:modelValue":n[17]||(n[17]=i=>e(s).priority=i),options:pe.value,class:"w-full bg-white/5 border-white/10 text-white rounded-xl"},null,8,["modelValue","options"])]),t("div",an,[t("label",nn,c(e(a)("maintenances.formDialog.interventionRegion")),1),r(e(D),{modelValue:e(s).region_id,"onUpdate:modelValue":n[18]||(n[18]=i=>e(s).region_id=i),options:b.regions,optionLabel:"designation",optionValue:"id",readonly:"",class:"w-full bg-white/5 border-white/10 text-white rounded-xl",disabled:!0},null,8,["modelValue","options"])])])])]),t("div",on,[t("h4",rn,[dn,q(" "+c(e(a)("maintenances.formDialog.recurrenceCycle")),1)]),t("div",cn,[t("div",un,[t("label",pn,c(e(a)("maintenances.formDialog.frequency")),1),r(e(D),{modelValue:e(s).recurrence_type,"onUpdate:modelValue":n[19]||(n[19]=i=>e(s).recurrence_type=i),options:He.value,optionLabel:"label",optionValue:"value",class:"w-full quantum-input !bg-white shadow-none"},null,8,["modelValue","options"])]),e(s).recurrence_type==="daily"?(m(),v("div",mn,[_n,r(e(W),{modelValue:e(s).recurrence_interval,"onUpdate:modelValue":n[20]||(n[20]=i=>e(s).recurrence_interval=i),min:1,max:365,class:"w-full"},null,8,["modelValue"])])):g("",!0),e(s).recurrence_type==="weekly"?(m(),v("div",bn,[t("label",fn,c(e(a)("maintenances.formDialog.daysSelection")),1),r(e(he),{modelValue:e(s).recurrence_days,"onUpdate:modelValue":n[21]||(n[21]=i=>e(s).recurrence_days=i),options:Se.value,optionLabel:"label",optionValue:"value",display:"chip",class:"w-full border-none p-0"},null,8,["modelValue","options"])])):g("",!0),["monthly","quarterly","biannual","annual"].includes(e(s).recurrence_type)?(m(),v("div",hn,[t("div",vn,[t("div",gn,[r(_,{modelValue:e(s).monthly_recurrence_type,"onUpdate:modelValue":n[22]||(n[22]=i=>e(s).monthly_recurrence_type=i),inputId:"monthly_day_of_month",name:"monthly_type",value:"day_of_month"},null,8,["modelValue"]),yn]),t("div",xn,[r(_,{modelValue:e(s).monthly_recurrence_type,"onUpdate:modelValue":n[23]||(n[23]=i=>e(s).monthly_recurrence_type=i),inputId:"monthly_day_of_week",name:"monthly_type",value:"day_of_week"},null,8,["modelValue"]),wn])]),t("div",kn,[e(s).monthly_recurrence_type==="day_of_month"?(m(),v("div",Vn,[Dn,r(e(W),{modelValue:e(s).recurrence_day_of_month,"onUpdate:modelValue":n[24]||(n[24]=i=>e(s).recurrence_day_of_month=i),min:1,max:31,placeholder:"Ex: 15",class:"w-full",inputClass:"py-2"},null,8,["modelValue"])])):g("",!0),e(s).monthly_recurrence_type==="day_of_week"?(m(),v("div",qn,[Sn,r(e(D),{modelValue:e(s).recurrence_day,"onUpdate:modelValue":n[25]||(n[25]=i=>e(s).recurrence_day=i),options:Se.value,optionLabel:"label",optionValue:"value",class:"w-full bg-white"},null,8,["modelValue","options"])])):g("",!0)]),t("div",Un,[t("label",Cn,c(e(a)("maintenances.formDialog.earlyReminder")),1),t("div",Tn,[t("div",An,[r(e(W),{modelValue:e(s).reminder_days,"onUpdate:modelValue":n[26]||(n[26]=i=>e(s).reminder_days=i),min:0,suffix:" jours",class:"w-full",inputClass:"bg-primary-700/50 border-none text-white placeholder:text-primary-300 py-2.5 px-4 rounded-xl w-full"},null,8,["modelValue"])]),$n])])])):g("",!0),e(s).recurrence_type==="custom"?(m(),v("div",Mn,[t("label",Nn,c(e(a)("maintenances.formDialog.customRule")),1),r(e(Le),{modelValue:e(s).custom_recurrence_config,"onUpdate:modelValue":n[27]||(n[27]=i=>e(s).custom_recurrence_config=i),rows:"2",class:"w-full quantum-input !bg-white",placeholder:e(a)("maintenances.formDialog.customRulePlaceholder")},null,8,["modelValue","placeholder"])])):g("",!0)])]),t("div",jn,[t("div",In,[Ln,t("label",En,c(e(a)("maintenances.formDialog.estimatedDuration")),1),r(e(W),{id:"estimated_duration",modelValue:e(s).estimated_duration,"onUpdate:modelValue":n[28]||(n[28]=i=>e(s).estimated_duration=i),suffix:" min",class:"quantum-input-transparent",min:0},null,8,["modelValue"])]),t("div",Fn,[On,t("label",Pn,c(e(a)("maintenances.formDialog.estimatedBudget")),1),r(e(W),{id:"cost",modelValue:e(s).cost,"onUpdate:modelValue":n[29]||(n[29]=i=>e(s).cost=i),mode:"currency",currency:"USD",locale:"fr-FR",class:"quantum-input-transparent text-emerald-600 font-bold",min:0},null,8,["modelValue"])])])])])])]}),_:1},8,["visible"]),r(e(ve),{visible:Z.value,"onUpdate:visible":n[33]||(n[33]=o=>Z.value=o),modal:"",header:e(U).id?"Modifier le modèle":"Sauvegarder comme modèle",style:{width:"30rem"}},{footer:y(()=>[r(u,{label:"Annuler",icon:"pi pi-times",onClick:n[32]||(n[32]=o=>Z.value=!1),class:"p-button-text"}),r(u,{label:e(U).id?"Mettre à jour":"Sauvegarder",icon:"pi pi-save",onClick:Ye,loading:e(U).processing},null,8,["label","loading"])]),default:y(()=>[t("div",Xn,[Jn,r(e(z),{id:"template_name",modelValue:e(U).name,"onUpdate:modelValue":n[31]||(n[31]=o=>e(U).name=o),class:fe(["w-full",{"p-invalid":e(U).errors.name}]),placeholder:"Ex: Contrôle standard Moteur"},null,8,["modelValue","class"]),t("small",Wn,c(e(U).errors.name),1)]),t("div",Hn,[t("p",Bn,[Qn,q(" Vous êtes sur le point de sauvegarder "),t("strong",null,c(e(U).instructions.length)+" instruction(s)",1),q(" comme un modèle réutilisable. ")])])]),_:1},8,["visible","header"])]),_:1},8,["title"])}}};export{Do as default};
