import{T as gt}from"./index-CrFEKHH1.js";import{s as yt,a as xt,c as wt}from"./index-C2t85Ev4.js";import{s as kt}from"./index-BFXGy4uN.js";import{s as Vt}from"./index-D4DTux10.js";import{s as Dt}from"./index-psDJnd0s.js";import{d as qt}from"./debounce-CURsxuVQ.js";import{a as St,b as Ut,u as Ct,r as w,F as N,c as te,T as fe,d as T,w as K,h as ae,e as A,f as y,g as e,o as m,i as r,Z as Tt,j as t,t as c,k as q,l as v,m as P,n as W,p as g,q as de,s as he}from"./app-gDNqx2_D.js";import{_ as At}from"./AppLayout-SGD7JHFV.js";import{s as $t}from"./index-LIEjb82k.js";import{s as ve}from"./index-5fxx7ZJm.js";import{s as ge}from"./index-bSGFH6Vt.js";import{s as Ee}from"./index-tkdp3lW-.js";import{s as z}from"./index-DnMOyY1I.js";import{s as D}from"./index-qtJx-Jx6.js";import{s as ce}from"./index-CadKbAM9.js";import{a as Mt,s as Nt}from"./index-3Y3FmX7C.js";import{s as ne}from"./index-BHExvObj.js";import{s as Fe}from"./index-Dqyvdu4C.js";import{s as H}from"./index-DWMCXZ5G.js";import{s as jt}from"./index-DNoI7EM0.js";import"./index-Sf75UUsw.js";import"./index-qcYzN5_Q.js";import"./index-CaNPRaEQ.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./DropdownLink-DIW2SyDI.js";import"./index-E0OnojZQ.js";import"./index-C57fO0mp.js";const It={class:"min-h-screen bg-slate-50 p-4 md:p-10 font-sans"},Lt={class:"flex flex-col lg:flex-row justify-between items-start lg:items-center gap-6 mb-8"},Et={class:"flex items-center gap-4"},Ft=t("div",{class:"flex h-16 w-16 items-center justify-center rounded-[1rem] bg-primary-600 shadow-xl shadow-primary-200"},[t("i",{class:"pi pi-wrench text-2xl text-white"})],-1),Ot={class:"text-3xl font-black tracking-tighter text-slate-900 md:text-4xl"},Pt={class:"text-[10px] font-bold uppercase tracking-[0.3em] text-slate-400"},zt={class:"flex w-full items-center gap-3 lg:w-auto"},Rt=t("i",{class:"pi pi-file-excel"},null,-1),Xt=t("i",{class:"pi pi-plus-circle"},null,-1),Jt={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 mb-8"},Wt={class:"p-6 bg-white rounded-2xl border border-slate-200 shadow-sm flex items-center gap-5"},Ht=t("div",{class:"w-14 h-14 rounded-xl bg-slate-100 flex items-center justify-center"},[t("i",{class:"pi pi-wrench text-2xl text-slate-500"})],-1),Bt={class:"text-2xl font-black text-slate-800"},Qt=t("div",{class:"text-[10px] font-bold text-slate-400 uppercase tracking-widest"},"Maintenances Totales",-1),Zt={class:"p-6 bg-white rounded-2xl border border-slate-200 shadow-sm flex items-center gap-5"},Gt=t("div",{class:"w-14 h-14 rounded-xl bg-amber-50 flex items-center justify-center"},[t("i",{class:"pi pi-spin pi-spinner text-2xl text-amber-500"})],-1),Kt={class:"text-2xl font-black text-slate-800"},Yt=t("div",{class:"text-[10px] font-bold text-slate-400 uppercase tracking-widest"},"En Cours",-1),es={class:"p-6 bg-white rounded-2xl border border-slate-200 shadow-sm flex items-center gap-5"},ts=t("div",{class:"w-14 h-14 rounded-xl bg-green-50 flex items-center justify-center"},[t("i",{class:"pi pi-check-circle text-2xl text-green-500"})],-1),ss={class:"text-2xl font-black text-slate-800"},ls=t("div",{class:"text-[10px] font-bold text-slate-400 uppercase tracking-widest"},"Terminées",-1),as={class:"overflow-hidden rounded-[1rem] border border-white bg-white shadow-2xl shadow-slate-200/60"},ns={class:"flex flex-col md:flex-row justify-between items-center gap-4 p-4"},os={class:"flex items-center gap-2"},is=["onClick"],rs=t("div",{class:"flex h-12 w-12 items-center justify-center rounded-2xl bg-slate-100 transition-all group-hover:bg-primary-100 text-primary-500"},[t("i",{class:"pi pi-tag text-xl"})],-1),ds={class:"flex flex-col"},cs={class:"text-lg font-black tracking-tight text-slate-800"},us={class:"text-[10px] font-bold uppercase tracking-widest text-primary-500"},ps={key:0,class:"flex flex-wrap gap-1"},ms={key:0,class:"flex w-fit items-center gap-3 rounded-full bg-slate-50 p-1 pr-4 border border-slate-100"},_s={class:"text-sm font-bold text-slate-700"},bs={class:"font-mono text-sm bg-primary-50 text-primary-600 px-2 py-1 rounded-md"},fs={class:"flex justify-end gap-2"},hs={class:"p-6 bg-slate-50 border-t border-b border-slate-200"},vs=t("h4",{class:"text-xs font-black uppercase tracking-widest text-slate-600 mb-4"},[t("i",{class:"pi pi-calendar-times mr-2"}),q(" Prochaines Occurrences Planifiées ")],-1),gs={key:0,class:"flex flex-wrap gap-3"},ys={class:"text-xs font-bold text-slate-700"},xs={key:1,class:"text-center py-4 text-slate-400 italic text-sm"},ws={class:"font-semibold mb-3"},ks={class:"flex items-center gap-3"},Vs=t("div",{class:"w-8 h-8 bg-slate-900 rounded-xl flex items-center justify-center"},[t("i",{class:"pi pi-layers text-white text-xs"})],-1),Ds={class:"text-sm font-bold text-slate-900 leading-none"},qs={class:"text-[10px] text-slate-500 font-medium mt-1 uppercase tracking-wider"},Ss={key:0,class:"flex flex-col h-[75vh]"},Us={class:"bg-slate-900 px-6 py-4 flex items-center justify-between shrink-0"},Cs={class:"flex items-center gap-6"},Ts={class:"space-y-1"},As={class:"text-[9px] font-black text-primary-400 uppercase tracking-[0.2em]"},$s={class:"text-white text-sm font-bold flex items-center gap-2"},Ms=t("i",{class:"pi pi-external-link text-[10px] text-slate-500"},null,-1),Ns=t("div",{class:"h-8 w-px bg-slate-800"},null,-1),js={class:"space-y-1"},Is={class:"text-[9px] font-black text-slate-500 uppercase tracking-[0.2em]"},Ls={class:"text-white text-sm font-bold"},Es={class:"flex gap-2"},Fs={class:"flex-1 overflow-y-auto bg-slate-50/50 p-6 space-y-6"},Os={class:"flex items-center px-4 py-2 border-b border-slate-100 bg-white sticky top-0 z-10"},Ps={class:"text-[10px] font-black text-slate-400 mr-4"},zs={class:"flex items-center gap-4"},Rs={class:"flex items-center gap-2 px-3 py-1 bg-slate-100 rounded text-[10px] font-bold text-slate-600 uppercase"},Xs={class:"p-2 grid grid-cols-12 gap-2"},Js={class:"col-span-12 lg:col-span-7 space-y-4"},Ws={class:"p-2 grid grid-cols-12 gap-2"},Hs={class:"col-span-12 lg:col-span-6 space-y-4"},Bs={class:"p-4 border border-slate-100 rounded-md bg-slate-50/30"},Qs={class:"text-[10px] font-black text-slate-900 uppercase mb-3 flex items-center gap-2"},Zs=t("i",{class:"pi pi-user text-primary-500"},null,-1),Gs={class:"space-y-3"},Ks={class:"field"},Ys={class:"field"},el={class:"col-span-12 lg:col-span-6 space-y-4"},tl={class:"p-4 border border-slate-100 rounded-md flex flex-col"},sl={class:"text-[10px] font-black text-slate-900 uppercase mb-3 flex items-center gap-2"},ll=t("i",{class:"pi pi-box text-primary-500"},null,-1),al={class:"mt-3 p-3 bg-primary-50 rounded border border-primary-100"},nl={class:"flex items-center justify-between text-[10px]"},ol={class:"font-bold text-primary-700"},il={class:"p-4 border border-slate-100 rounded-md bg-slate-50/30"},rl={class:"text-[10px] font-black text-slate-900 uppercase mb-3 flex items-center gap-2"},dl=t("i",{class:"pi pi-calendar text-primary-500"},null,-1),cl={class:"grid grid-cols-2 gap-2"},ul={class:"field"},pl={class:"text-[9px] font-bold text-slate-500 uppercase"},ml={class:"field"},_l={class:"text-[9px] font-bold text-slate-500 uppercase"},bl={class:"field col-span-2"},fl={class:"text-[9px] font-bold text-slate-500 uppercase"},hl={class:"col-span-12 lg:col-span-5 space-y-4"},vl={class:"p-4 border border-slate-100 rounded-md bg-white shadow-inner flex flex-col h-[180px]"},gl={class:"flex justify-between items-center mb-2"},yl={class:"text-[10px] font-black text-slate-900 uppercase"},xl={class:"flex-1 overflow-y-auto space-y-2 pr-1 custom-scrollbar"},wl={key:0,class:"text-center py-4 text-[10px] text-slate-400 italic font-medium"},kl={class:"p-4 border border-slate-100 rounded-md bg-white shadow-inner flex flex-col h-[180px]"},Vl={class:"flex justify-between items-center mb-2"},Dl={class:"text-[10px] font-black text-slate-900 uppercase"},ql={class:"flex-1 overflow-hidden space-y-1"},Sl={class:"px-6 py-4 border-t border-slate-200 bg-white flex justify-between items-center shrink-0"},Ul={class:"flex items-center gap-3"},Cl={class:"px-8 py-4 bg-slate-900 rounded-xl text-white flex justify-between items-center shadow-lg relative z-50"},Tl={class:"flex items-center gap-4"},Al=t("div",{class:"p-2 bg-blue-500/20 rounded-lg border border-blue-500/30"},[t("i",{class:"pi pi-shield text-blue-400 text-xl"})],-1),$l={class:"flex flex-col"},Ml={class:"text-sm font-black uppercase tracking-widest text-white leading-none"},Nl={class:"text-[9px] text-blue-300 font-bold uppercase tracking-tighter mt-1 italic"},jl={class:"flex items-center gap-6"},Il={key:0,class:"flex flex-col items-end mr-4"},Ll=t("span",{class:"text-[9px] font-bold text-slate-400 uppercase mb-1"},"Réseau Sélectionné",-1),El={class:"p-2"},Fl={class:"grid grid-cols-1 md:grid-cols-12 gap-8"},Ol={class:"md:col-span-7 space-y-6"},Pl={class:"p-6 bg-slate-50 rounded-3xl border border-slate-100 space-y-5"},zl={class:"text-xs font-black uppercase tracking-widest text-primary-600 mb-2 flex items-center gap-2"},Rl=t("i",{class:"pi pi-tag"},null,-1),Xl={class:"field"},Jl={for:"title",class:"text-[10px] font-bold uppercase text-slate-500 mb-1 block ml-1"},Wl={key:0,class:"p-error block mt-1"},Hl={class:"field"},Bl=t("label",{for:"network",class:"text-[10px] font-bold uppercase text-slate-500 mb-1 block ml-1"}," Réseau ",-1),Ql={key:0},Zl={key:1},Gl={class:"field"},Kl={for:"related_equipments",class:"text-[10px] font-bold uppercase text-slate-500 mb-1 block ml-1"},Yl={class:"field"},ea={class:"flex flex-col gap-1"},ta={class:"flex items-center gap-2"},sa=t("i",{class:"pi pi-bolt text-primary-500 text-xs"},null,-1),la={class:"font-bold text-sm"},aa={class:"flex items-center gap-2 text-[10px] text-slate-400 uppercase tracking-wider ml-5"},na=t("i",{class:"pi pi-map-marker"},null,-1),oa={key:0,class:"p-error block mt-1"},ia={class:"field"},ra={for:"description",class:"text-[10px] font-bold uppercase text-slate-500 mb-1 block ml-1"},da={key:0,class:"p-error block mt-1"},ca={class:"space-y-4"},ua={class:"flex items-center justify-between px-2"},pa={class:"text-xs font-black uppercase tracking-widest text-slate-700 flex items-center gap-2"},ma=t("i",{class:"pi pi-sitemap text-primary-500"},null,-1),_a={key:0,class:"space-y-4 transition-all"},ba={key:0,class:"p-8 border-2 border-dashed border-slate-200 rounded-3xl text-center bg-slate-50/50"},fa=t("i",{class:"pi pi-exclamation-circle text-slate-300 text-3xl mb-3 block"},null,-1),ha={class:"text-xs font-bold text-slate-400 uppercase tracking-tight"},va=["onClick"],ga={class:"flex items-center gap-3"},ya=t("div",{class:"w-8 h-8 rounded-full bg-white flex items-center justify-center shadow-sm"},[t("i",{class:"pi pi-folder text-slate-400 text-xs"})],-1),xa={class:"font-black text-xs text-slate-700 uppercase tracking-wider"},wa={key:0,class:"p-4 space-y-6 border-t border-slate-50"},ka={class:"flex flex-wrap justify-between items-center gap-4 mb-4 border-b border-slate-200/60 pb-3"},Va={class:"text-xs font-black text-primary-600 uppercase"},Da={class:"flex gap-2"},qa={class:"space-y-3"},Sa={key:0,class:"flex justify-end items-center gap-2"},Ua={class:"md:col-span-6"},Ca={class:"md:col-span-3"},Ta={class:"md:col-span-2 flex items-center justify-center gap-2"},Aa=["for"],$a={class:"md:col-span-1 flex justify-end"},Ma={key:1,class:"text-center py-4 text-[10px] font-bold text-slate-400 uppercase tracking-tighter italic"},Na={class:"md:col-span-5 space-y-6"},ja={class:"p-8 bg-slate-900 rounded-[1rem] text-white shadow-2xl relative overflow-hidden"},Ia=t("div",{class:"absolute top-0 right-0 p-6 opacity-10"},[t("i",{class:"pi pi-calendar-plus text-6xl"})],-1),La={class:"text-[10px] font-black uppercase tracking-[0.2em] mb-8 text-primary-400 flex items-center gap-2"},Ea=t("span",{class:"w-2 h-2 rounded-full bg-primary-500 animate-pulse"},null,-1),Fa={class:"space-y-6"},Oa={class:"grid grid-cols-2 gap-4"},Pa={class:"field"},za={class:"text-[9px] font-bold uppercase text-slate-400 mb-2 block ml-1"},Ra={key:0,class:"p-error block mt-1 text-red-400"},Xa={class:"field"},Ja={class:"text-[9px] font-bold uppercase text-slate-400 mb-2 block ml-1"},Wa={key:0,class:"p-error block mt-1 text-red-400"},Ha={class:"field bg-white/5 p-4 rounded-2xl border border-white/10"},Ba={class:"text-[9px] font-bold uppercase text-slate-400 mb-3 block"},Qa={class:"flex gap-2"},Za={key:0,class:"p-error block mt-1 text-red-400"},Ga={class:"grid grid-cols-2 gap-4"},Ka={class:"field"},Ya={class:"text-[9px] font-bold uppercase text-slate-400 mb-2 block ml-1"},en={class:"field"},tn={class:"text-[9px] font-bold uppercase text-slate-400 mb-2 block ml-1"},sn={class:"grid grid-cols-2 gap-4"},ln={class:"field"},an={class:"text-[9px] font-bold uppercase text-slate-400 mb-2 block ml-1"},nn={class:"field"},on={class:"text-[9px] font-bold uppercase text-slate-400 mb-2 block ml-1"},rn={class:"p-8 bg-primary-50 rounded-[1rem] border border-primary-100 shadow-sm space-y-6"},dn={class:"text-[10px] font-black uppercase tracking-widest text-primary-700 flex items-center gap-2"},cn=t("i",{class:"pi pi-sync"},null,-1),un={class:"space-y-5"},pn={class:"field"},mn={class:"text-[9px] font-bold uppercase text-primary-400 mb-2 block ml-1"},_n={key:0,class:"field animate-fade-in p-4 bg-white rounded-2xl border border-primary-100"},bn=t("label",{class:"text-[9px] font-bold uppercase text-primary-400 mb-2 block ml-1"},"Intervalle (en jours)",-1),fn={key:1,class:"field animate-fade-in p-4 bg-white rounded-2xl border border-primary-100"},hn={class:"text-[9px] font-bold uppercase text-primary-400 mb-2 block"},vn={key:2,class:"space-y-4 animate-fade-in p-4 bg-white rounded-2xl border border-primary-100 shadow-sm"},gn={class:"flex items-center gap-6 pb-2 border-b border-slate-50"},yn={class:"flex items-center"},xn=t("label",{for:"monthly_day_of_month",class:"ml-2 text-xs font-bold text-slate-600 cursor-pointer"},"Le jour du mois",-1),wn={class:"flex items-center"},kn=t("label",{for:"monthly_day_of_week",class:"ml-2 text-xs font-bold text-slate-600 cursor-pointer"},"Le jour de la semaine",-1),Vn={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Dn={key:0,class:"field animate-fade-in col-span-full md:col-span-1"},qn=t("label",{class:"text-[9px] font-bold uppercase text-primary-400 mb-1 block ml-1"},"Le quantième du mois",-1),Sn={key:1,class:"field animate-fade-in col-span-full md:col-span-1"},Un=t("label",{class:"text-[9px] font-bold uppercase text-primary-400 mb-1 block ml-1"},"Quel jour ?",-1),Cn={class:"field p-4 bg-primary-600 rounded-2xl text-white shadow-lg shadow-primary-100"},Tn={class:"text-[9px] font-bold uppercase opacity-80 mb-2 block tracking-widest"},An={class:"flex items-center gap-3"},$n={class:"relative flex-1"},Mn=t("div",{class:"p-2.5 bg-primary-500 rounded-xl"},[t("i",{class:"pi pi-bell animate-pulse text-white"})],-1),Nn={key:3,class:"field animate-fade-in"},jn={class:"text-[9px] font-bold uppercase text-primary-400 mb-2 block"},In={class:"grid grid-cols-2 gap-4"},Ln={class:"p-6 bg-white rounded-3xl border border-slate-100 flex flex-col items-center text-center shadow-sm group hover:border-primary-300 transition-colors"},En=t("div",{class:"w-10 h-10 rounded-full bg-slate-50 flex items-center justify-center mb-3 group-hover:bg-primary-50"},[t("i",{class:"pi pi-clock text-slate-400 group-hover:text-primary-500"})],-1),Fn={for:"estimated_duration",class:"text-[8px] font-black uppercase text-slate-400 tracking-tighter mb-1 block"},On={class:"p-6 bg-white rounded-3xl border border-slate-100 flex flex-col items-center text-center shadow-sm group hover:border-emerald-300 transition-colors"},Pn=t("div",{class:"w-10 h-10 rounded-full bg-slate-50 flex items-center justify-center mb-3 group-hover:bg-emerald-50"},[t("i",{class:"pi pi-wallet text-slate-400 group-hover:text-emerald-500"})],-1),zn={for:"cost",class:"text-[8px] font-black uppercase text-slate-400 tracking-tighter mb-1 block"},Rn={class:"flex justify-between items-center w-full px-4 py-2"},Xn={class:"flex gap-3"},Jn={class:"field"},Wn=t("label",{for:"template_name",class:"font-semibold"},"Nom du modèle",-1),Hn={class:"p-error"},Bn={class:"mt-4 p-3 bg-slate-100 rounded-lg border border-slate-200"},Qn={class:"text-xs text-slate-600"},Zn=t("i",{class:"pi pi-info-circle mr-2"},null,-1),Oe=(F,b)=>{const S=new Date;S.setHours(0,0,0,0);const B=new Date(F);B.setHours(0,0,0,0);const a=B-S,I=Math.ceil(a/(1e3*60*60*24));return I<0?{label:"Passée",severity:"secondary"}:I===0?{label:"En cours",severity:"danger"}:b&&I<=b?{label:"Approche",severity:"warning"}:{label:"À venir",severity:"info"}},Pe=F=>{if(!F)return[];try{const b=JSON.parse(F);return Array.isArray(b)?b.sort((S,B)=>new Date(S)-new Date(B)):[]}catch(b){return console.error("Erreur d'analyse des dates régénérées:",b),[]}},Gn=F=>new Date(F).toLocaleDateString("fr-FR",{day:"2-digit",month:"long",year:"numeric"}),qo={__name:"Maintenances",props:{maintenances:Object,filters:Object,equipments:Array,users:Array,teams:Object,regions:Array,tasks:Array,zones:Array,spareParts:Array,networks:Array,equipmentTree:Array,instructionTemplates:Array},setup(F){var Le;const b=F,S=St(),B=Ut(),{t:a}=Ct(),I=w(!1),oe=w(!1),R=w(!1),ze=w(((Le=b.filters)==null?void 0:Le.search)||""),Y=w(!1),ye=w(),xe=w(),we=w([]),se=w({global:{value:null,matchMode:N.CONTAINS},title:{operator:te.AND,constraints:[{value:null,matchMode:N.STARTS_WITH}]},"assignable.name":{operator:te.AND,constraints:[{value:null,matchMode:N.STARTS_WITH}]},status:{value:null,matchMode:N.EQUALS},priority:{value:null,matchMode:N.EQUALS},type:{value:null,matchMode:N.EQUALS},"region.designation":{operator:te.AND,constraints:[{value:null,matchMode:N.STARTS_WITH}]}}),Re=()=>{se.value={global:{value:null,matchMode:N.CONTAINS},title:{operator:te.AND,constraints:[{value:null,matchMode:N.STARTS_WITH}]},"assignable.name":{operator:te.AND,constraints:[{value:null,matchMode:N.STARTS_WITH}]},status:{value:null,matchMode:N.EQUALS},priority:{value:null,matchMode:N.EQUALS},type:{value:null,matchMode:N.EQUALS},"region.designation":{operator:te.AND,constraints:[{value:null,matchMode:N.STARTS_WITH}]}}},ke=w([{field:"title",header:a("maintenances.columns.title")},{field:"equipments",header:a("maintenances.columns.equipments")},{field:"assignable",header:a("maintenances.columns.assignable")},{field:"status",header:a("maintenances.columns.status")},{field:"priority",header:a("maintenances.columns.priority")},{field:"scheduled_start_date",header:a("maintenances.columns.scheduled_start_date")},{field:"description",header:a("maintenances.columns.description")},{field:"estimated_duration",header:a("maintenances.columns.estimated_duration")},{field:"cost",header:a("maintenances.columns.cost")},{field:"region.designation",header:a("maintenances.columns.region")},{field:"recurrence_type",header:a("maintenances.columns.recurrence_type")},{field:"recurrence_interval",header:a("maintenances.columns.recurrence_interval")},{field:"recurrence_month_interval",header:a("maintenances.columns.recurrence_month_interval")},{field:"recurrence_days",header:a("maintenances.columns.recurrence_days")},{field:"recurrence_day_of_month",header:a("maintenances.columns.recurrence_day_of_month")},{field:"recurrence_month",header:a("maintenances.columns.recurrence_month")}]),$=w(ke.value.slice(0,5).map(l=>l.field)),Xe=l=>{xe.value.toggle(l)},ie=w({}),ee=w(!1),Je=w(!1),Q=w(null),ue=w({}),pe=w({}),Z=w({}),G=w(!1),U=fe({name:"",instructions:[],id:null}),le=w(!1),O=w(null),We=w([{label:a("maintenances.status.scheduled"),value:"scheduled"},{label:a("maintenances.status.in_progress"),value:"in_progress"},{label:a("maintenances.status.completed"),value:"completed"},{label:a("maintenances.status.completed_with_issues"),value:"completed_with_issues"},{label:a("maintenances.status.suspended"),value:"suspended"},{label:a("maintenances.status.canceled"),value:"canceled"},{label:a("maintenances.status.awaiting_resources"),value:"awaiting_resources"},{label:a("maintenances.status.to_be_reviewed_later"),value:"to_be_reviewed_later"}]),j=fe({maintenance_id:null,activities:[]}),Ve=()=>{var l,n,d,p;j.activities.push({title:`${a("maintenances.activityDialog.newActivity")} ${((l=O.value)==null?void 0:l.title)||""}`,status:"scheduled",assignable_type:null,assignable_id:null,equipment_ids:((n=O.value)==null?void 0:n.equipments.map(u=>u.id))||[],actual_start_time:(d=O.value)!=null&&d.scheduled_start_date?new Date(O.value.scheduled_start_date):null,actual_end_time:(p=O.value)!=null&&p.scheduled_end_date?new Date(O.value.scheduled_end_date):null,spare_parts:[],instructions:[]})},s=fe({id:null,title:"",description:"",assignable_type:null,assignable_id:null,region_id:null,maintenance_schedule_id:null,intervention_request_id:null,network_node_id:null,network_id:null,type:"Préventive",status:"Planifiée",priority:"Moyenne",scheduled_start_date:null,scheduled_end_date:null,estimated_duration:null,started_at:null,completed_at:null,cost:null,recurrence_type:null,recurrence_interval:null,recurrence_month_interval:null,recurrence_days:[],recurrence_day:null,recurrence_day_of_month:null,recurrence_month:null,monthly_recurrence_type:"day_of_month",recurrence_week_of_month:1,reminder_days:null,custom_recurrence_config:null,placementType:null,zone_id:null,network_id:null,node_instructions:{},regenerated_dates:null,related_equipments:{},network_node_id:null}),De=w(["Préventive","Corrective","Améliorative","Périodique"]),qe=T(()=>[{label:a("maintenances.status.scheduled"),value:"scheduled"},{label:a("maintenances.status.in_progress"),value:"in_progress"},{label:a("maintenances.status.completed"),value:"completed"},{label:a("maintenances.status.completed_with_issues"),value:"completed_with_issues"},{label:a("maintenances.status.suspended"),value:"suspended"},{label:a("maintenances.status.canceled"),value:"canceled"},{label:a("maintenances.status.awaiting_resources"),value:"awaiting_resources"},{label:a("maintenances.status.to_be_reviewed_later"),value:"to_be_reviewed_later"}]),me=T(()=>[a("maintenances.priority.low"),a("maintenances.priority.medium"),a("maintenances.priority.high"),a("maintenances.priority.urgent")]),Se=w([{label:a("maintenances.assignableTypes.none"),value:null},{label:a("maintenances.assignableTypes.user"),value:"App\\Models\\User"},{label:a("maintenances.assignableTypes.team"),value:"App\\Models\\Team"}]),_e=T(()=>{const l=b.maintenances.data.length,n=b.maintenances.data.filter(p=>p.status==="in_progress").length,d=b.maintenances.data.filter(p=>p.status==="completed").length;return{total:l,inProgress:n,completed:d}}),He=T(()=>s.assignable_type==="App\\Models\\User"?b.users:s.assignable_type==="App\\Models\\Team"?b.teams:[]),Be=w([{label:a("maintenances.recurrence.none"),value:null},{label:a("maintenances.recurrence.daily"),value:"daily"},{label:a("maintenances.recurrence.weekly"),value:"weekly"},{label:a("maintenances.recurrence.monthly"),value:"monthly"},{label:a("maintenances.recurrence.quarterly"),value:"quarterly"},{label:a("maintenances.recurrence.biannual"),value:"biannual"},{label:a("maintenances.recurrence.annual"),value:"annual"},{label:a("maintenances.recurrence.custom"),value:"custom"}]),Ue=w([{label:"Lundi",value:1},{label:"Mardi",value:2},{label:"Mercredi",value:3},{label:"Jeudi",value:4},{label:"Vendredi",value:5},{label:"Samedi",value:6},{label:"Dimanche",value:0}]),Ce=w([{label:"Texte",value:"text"},{label:"Nombre",value:"number"},{label:"Date",value:"date"},{label:"Image",value:"image"},{label:"Signature",value:"signature"},{label:"Booléen",value:"boolean"}]);w([{label:"Janvier",value:1},{label:"Février",value:2},{label:"Mars",value:3},{label:"Avril",value:4},{label:"Mai",value:5},{label:"Juin",value:6},{label:"Juillet",value:7},{label:"Août",value:8},{label:"Septembre",value:9},{label:"Octobre",value:10},{label:"Novembre",value:11},{label:"Décembre",value:12}]),w([{label:"Première",value:1},{label:"Deuxième",value:2},{label:"Troisième",value:3},{label:"Quatrième",value:4},{label:"Dernière",value:-1}]),K(()=>s.recurrence_type,l=>{}),K(()=>s.monthly_recurrence_type,l=>{l==="day_of_month"?s.recurrence_day=null:l==="day_of_week"&&(s.recurrence_day_of_month=null)}),K(()=>s.network_id,l=>{s.placementType=null,R.value||(s.region_id=null),s.zone_id=null,s.network_node_id=null}),K(()=>s.related_equipments,(l,n)=>{const d=l?Object.keys(l):[];(n?Object.keys(n):[]).forEach(u=>{d.includes(u)||delete s.node_instructions[u]})}),K(()=>s.related_equipments,l=>{let n=[];typeof l=="object"&&l!==null&&!Array.isArray(l)?n=Object.keys(l).filter(d=>l[d].checked).map(String):Array.isArray(l)&&(n=l.map(String));for(const d in Z.value)n.includes(d)&&!s.node_instructions[d]&&(s.node_instructions[d]=JSON.parse(JSON.stringify(Z.value[d])));for(const d in s.node_instructions)n.includes(d)&&(Z.value[d]=JSON.parse(JSON.stringify(s.node_instructions[d])))},{deep:!0});const Qe=()=>{s.reset(),R.value=!1,oe.value=!1,ee.value=!1,I.value=!0,Z.value={},s.network_node_id=null,ie.value={};const l=new Date,n=new Date(l.getFullYear(),l.getMonth(),l.getDate(),7,0),d=new Date(l.getFullYear(),l.getMonth(),l.getDate(),16,0);s.scheduled_start_date=n,s.scheduled_end_date=d},Te=()=>{I.value=!1,oe.value=!1},Ae=l=>{s.id=l.id,s.title=l.title,s.description=l.description,s.assignable_type=l.assignable_type,s.assignable_id=l.assignable_id,s.region_id=l.region_id,s.maintenance_schedule_id=l.maintenance_schedule_id,s.intervention_request_id=l.intervention_request_id,s.network_node_id=l.network_node_id,s.network_id=l.network_id,s.type=l.type,s.status=l.status,s.priority=l.priority,s.scheduled_start_date=l.scheduled_start_date?new Date(l.scheduled_start_date):null,s.scheduled_end_date=l.scheduled_end_date?new Date(l.scheduled_end_date):null,s.estimated_duration=l.estimated_duration,s.started_at=l.started_at,s.completed_at=l.completed_at,s.cost=l.cost,s.recurrence_type=l.recurrence_type,s.recurrence_interval=l.recurrence_interval,s.recurrence_month_interval=l.recurrence_month_interval,s.recurrence_days=l.recurrence_days,s.recurrence_day_of_month=l.recurrence_day_of_month,s.recurrence_month=l.recurrence_month,s.assignable_id=l.assignable_id,s.type=l.type,s.status=l.status,s.network_node_id=l.network_node_id,s.network_id=l.network_id,s.priority=l.priority,s.recurrence_month_interval=l.recurrence_month_interval,s.recurrence_month=l.recurrence_month,s.reminder_days=l.reminder_days,s.custom_recurrence_config=l.custom_recurrence_config,s.scheduled_start_date=l.scheduled_start_date?new Date(l.scheduled_start_date):null,s.scheduled_end_date=l.scheduled_end_date?new Date(l.scheduled_end_date):null,s.estimated_duration=l.estimated_duration,s.cost=l.cost,s.region_id=l.region_id,s.recurrence_type=l.recurrence_type,s.recurrence_interval=l.recurrence_interval,s.recurrence_days=l.recurrence_days||[],s.recurrence_day_of_month=l.recurrence_day_of_month,s.recurrence_day=l.recurrence_day,s.placementType=l.region_id?"region":l.zone_id?"zone":null,s.network_id=l.network_id,s.monthly_recurrence_type=l.monthly_recurrence_type,$e.value=s.network_node_id,console.log(s.id),s.related_equipments=l.equipments.map(d=>d.id),console.log(l.instructions);const n={};if(l.instructions){const d=Array.isArray(l.instructions)?l.instructions:[l.instructions];for(const p of d)if(p&&p.equipment_id){const u=String(p.equipment_id);n[u]||(n[u]=[]),n[u].push({...p})}}s.node_instructions=n,Z.value=JSON.parse(JSON.stringify(n)),console.log("XXXXXXXXXXXXXXXXXXXXXX345"),console.log(s.recurrence_month),console.log(l.recurrence_month),I.value=!0,R.value=!0},$e=w(null),Ze=()=>{if(s.equipment_ids=s.related_equipments,oe.value=!0,!s.title||!s.type){S.add({severity:"error",summary:"Erreur",detail:"Veuillez remplir les champs obligatoires.",life:3e3});return}Y.value=!0;let l=[];if(typeof s.related_equipments=="object"&&s.related_equipments!==null&&!Array.isArray(s.related_equipments))l=Object.keys(s.related_equipments).filter(p=>s.related_equipments[p].checked).map(p=>parseInt(p,10)).filter(p=>!isNaN(p));else if(Array.isArray(s.related_equipments))l=s.related_equipments.map(p=>parseInt(p,10)).filter(p=>!isNaN(p));else if(s.related_equipments){const p=parseInt(s.related_equipments,10);isNaN(p)||(l=[p])}const n={};for(const p of l)s.node_instructions[p]&&(n[p]=s.node_instructions[p]);const d={...s.data(),equipment_ids:l,scheduled_start_date:s.scheduled_start_date?new Date(s.scheduled_start_date).toISOString().slice(0,19).replace("T"," "):null,scheduled_end_date:s.scheduled_end_date?new Date(s.scheduled_end_date).toISOString().slice(0,19).replace("T"," "):null};console.log("form.equipment_ids"),d.node_instructions=n,console.log(d),s.assignable_type||(d.assignable_id=null),console.log(s),R.value?ae.put(route("maintenances.update",s.id),d,{onSuccess:()=>{I.value=!1,S.add({severity:"success",summary:"Succès",detail:"Maintenance mise à jour avec succès.",life:3e3}),s.reset(),Y.value=!1,Z.value={}},onError:p=>{console.error("Erreur lors de la mise à jour de la maintenance",p),S.add({severity:"error",summary:"Erreur",detail:"Une erreur est survenue.",life:3e3}),s.errors=p},onFinish:()=>Y.value=!1}):(console.log(d),ae.post(route("maintenances.store"),d,{onSuccess:()=>{I.value=!1,S.add({severity:"success",summary:"Succès",detail:"Maintenance créée avec succès.",life:3e3}),s.reset(),Y.value=!1,Z.value={}},onError:p=>{console.error("Erreur lors de la sauvegarde de la maintenance",p),S.add({severity:"error",summary:"Erreur",detail:"Une erreur est survenue.",life:3e3}),s.errors=p},onFinish:()=>Y.value=!1}))},Ge=l=>{const n=s.node_instructions[l];if(!n||n.length===0){S.add({severity:"warn",summary:"Attention",detail:"Aucune instruction à sauvegarder pour cet équipement.",life:3e3});return}U.reset(),U.id=null,U.instructions=n.map(({id:d,maintenance_id:p,equipment_id:u,created_at:f,updated_at:k,..._})=>_),G.value=!0},Ke=()=>{U.post(route("instruction-templates.store"),{preserveScroll:!0,onSuccess:()=>{G.value=!1,S.add({severity:"success",summary:"Succès",detail:"Modèle sauvegardé.",life:3e3})},onError:l=>{const n=Object.values(l).flat().join(" ; ");S.add({severity:"error",summary:"Erreur",detail:n||"Impossible de sauvegarder le modèle.",life:5e3})}})},Ye=l=>{l&&(U.id=l.id,U.name=l.name,U.instructions=l.instructions,G.value=!0)},et=()=>{U.id?U.put(route("instruction-templates.update",U.id),{preserveScroll:!0,onSuccess:()=>{G.value=!1,S.add({severity:"success",summary:"Succès",detail:"Modèle mis à jour.",life:3e3})}}):Ke()},tt=l=>{l&&B.require({message:`Êtes-vous sûr de vouloir supprimer le modèle "${l.name}" ?`,header:"Confirmation de suppression",accept:()=>ae.delete(route("instruction-templates.destroy",l.id),{preserveScroll:!0})})},st=l=>{B.require({message:`Êtes-vous sûr de vouloir supprimer la maintenance "${l.title}" ?`,header:"Confirmation de suppression",icon:"pi pi-info-circle",acceptClass:"p-button-danger",accept:()=>{ae.delete(route("maintenances.destroy",l.id),{onSuccess:()=>{S.add({severity:"success",summary:"Succès",detail:"Maintenance supprimée.",life:3e3})}})}})},lt=()=>b.equipments,at=l=>l.assignable_type==="App\\Models\\User"?b.users:l.assignable_type==="App\\Models\\Team"?b.teams:[],nt=l=>{j.activities[l].instructions.push({label:"",type:"text",is_required:!1})},ot=(l,n)=>{j.activities[l].instructions.splice(n,1)},it=(l,n=!1)=>{O.value=l,j.reset(),j.maintenance_id=l.id;const d=n?2:1;for(let p=0;p<d;p++)Ve();le.value=!0},rt=l=>{j.activities[l].spare_parts.push({id:null,quantity_used:1})},dt=(l,n)=>{j.activities[l].spare_parts.splice(n,1)},ct=l=>{j.activities.splice(l,1)},ut=()=>{console.log({...j}),j.post(route("activities.bulkStore"),{onSuccess:()=>{le.value=!1,S.add({severity:"success",summary:"Succès",detail:"Activités créées avec succès.",life:3e3})},onError:l=>{console.error(l),S.add({severity:"error",summary:"Erreur",detail:"La création des activités a échoué.",life:4e3})}})};qt(()=>{ae.get(route("maintenances.index"),{search:ze.value},{preserveState:!0,replace:!0})},400);const Me=()=>{ye.value.exportCSV()},pt=l=>({scheduled:"info",in_progress:"warning",completed:"success",completed_with_issues:"danger",suspended:"warning",canceled:"secondary",awaiting_resources:"help",to_be_reviewed_later:"contrast","En retard":"danger"})[l]||null,mt=l=>({Basse:"info",Moyenne:"success",Haute:"warning",Urgente:"danger"})[l]||null;T(()=>R.value?a("maintenances.formDialog.editTitle"):a("maintenances.formDialog.createTitle"));const _t=T(()=>{if(!X.value.length)return[];const l=new Map,n=(d,p)=>{for(const u of d){if(u.children&&u.children.some(f=>f.key===p))return u;if(u.children){const f=n(u.children,p);if(f)return f}}return null};return X.value.forEach(d=>{const p=n(be.value,d.key),u=p?p.key:"root",f=p?p.label:a("maintenances.formDialog.parentGroupLabel");l.has(u)||l.set(u,{parent:{key:u,label:f},children:[]}),l.get(u).children.push(d)}),Array.from(l.values())}),bt=l=>{pe.value[l]=!(pe.value[l]??!0)},Ne=l=>pe.value[l]??!0,ft=l=>{s.node_instructions[l]||(s.node_instructions[l]=[]),s.node_instructions[l].push({label:"",type:"text",is_required:!1})},ht=(l,n)=>{s.node_instructions[l]&&s.node_instructions[l][n]&&s.node_instructions[l].splice(n,1)},vt=l=>{Q.value=l,ue.value={},je.value.filter(n=>String(n.value)!==String(l)),Je.value=!0,console.log(`Copie initiée depuis la source : ${l}`)};T(()=>Q.value?X.value.find(l=>l.key===Q.value):null),T(()=>{const l=Q.value;if(!l)return[];const n=new Set(X.value.filter(p=>p.key!==l&&ie.value[p.key]).map(p=>p.key)),d=p=>p.map(u=>{const f=u.children?d(u.children):[];return n.has(u.key)||f.length>0?{...u,children:f.length>0?f:void 0}:null}).filter(Boolean);return d(be.value)}),T(()=>{const l=Q.value;if(!l)return[];const n=X.value.filter(u=>u.key!==l&&ie.value[u.key]),d=new Map,p=(u,f)=>{for(const k of u){if(k.children&&k.children.some(_=>_.key===f))return k;if(k.children){const _=p(k.children,f);if(_)return _}}return null};return n.forEach(u=>{const f=p(be.value,u.key);f&&(d.has(f.key)||d.set(f.key,{parent:f,children:[]}),d.get(f.key).children.push(u))}),Array.from(d.values())});const X=T(()=>{if(!s.related_equipments)return[];let l=[];typeof s.related_equipments=="object"&&!Array.isArray(s.related_equipments)&&s.related_equipments!==null?l=Object.keys(s.related_equipments).filter(p=>s.related_equipments[p].checked):Array.isArray(s.related_equipments)&&(l=s.related_equipments.map(String));const n=[],d=p=>{for(const u of p)l.includes(String(u.id))&&n.push(u),u.children&&d(u.children)};return d(b.equipmentTree),n});T(()=>Q.value?X.value.filter(l=>l.key!==Q.value&&ie.value[l.key]):[]),T(()=>Object.keys(ue.value).filter(l=>ue.value[l]).length),T(()=>{if(!s.network_id)return b.regions;const l=b.networks.find(d=>d.id===s.network_id);if(!l||!l.nodes)return[];const n=new Set(l.nodes.filter(d=>d.region_id).map(d=>d.region_id));return b.regions.filter(d=>n.has(d.id))}),T(()=>{if(!s.network_id)return b.zones;const l=b.networks.find(d=>d.id===s.network_id);if(!l||!l.nodes)return[];const n=new Set(l.nodes.filter(d=>d.zone_id).map(d=>d.zone_id));return b.zones.filter(d=>n.has(d.id))});const be=T(()=>{if(!s.network_id)return[];const l=b.networks.find(_=>_.id===s.network_id);if(!l||!l.nodes)return[];const n=new Map((b.equipments??[]).map(_=>[_.id,_])),d=new Map((b.regions??[]).map(_=>[_.id,_])),p=new Map((b.zones??[]).map(_=>[_.id,_])),u=new Map,f=new Set;return l.nodes.filter(_=>{const V=`${_.equipment_id}-${_.region_id}-${_.zone_id}`;return f.has(V)?!1:(f.add(V),!0)}).forEach(_=>{const V=d.get(_.region_id),o=p.get(_.zone_id),i=n.get(_.equipment_id);if(!V)return;u.has(V.id)||u.set(V.id,{key:`region-${V.id}`,label:V.designation||V.name||"Région sans nom",selectable:!1,children:new Map});const x=u.get(V.id);if(i){const h=o?`zone-${o.id}`:"no-zone",L=o?o.title||o.name||"Zone sans titre":"Hors zone";x.children.has(h)||x.children.set(h,{key:h,label:L,selectable:!1,children:[]});const C=i.designation||i.name||i.tag||"Équipement inconnu",re=o?`${C} / ${L}`:C;x.children.get(h).children.push({key:String(_.id),label:re,data:_})}}),Array.from(u.values()).map(_=>({..._,children:Array.from(_.children.values())}))}),je=T(()=>{var f;if(!s.network_id)return[];const l=b.networks.find(k=>k.id===s.network_id);if(!l||!l.nodes)return[];const n=new Map((b.equipments??[]).map(k=>[k.id,k])),d=new Map;(b.zones??(b.regions??[]).flatMap(k=>k.zones??[])).forEach(k=>d.set(k.id,k));const u=((f=l.region)==null?void 0:f.designation)||"Région Réseau Indéfinie";return l.nodes.map(k=>{const _=n.get(k.equipment_id),V=d.get(k.zone_id),o=_!=null&&_.tag?`[${_.tag}] `:"",i=(_==null?void 0:_.designation)||"Équipement sans nom",x=(V==null?void 0:V.nomenclature)||(V==null?void 0:V.title)||"Zone non définie";return{value:k.id,label:`${o}${i} / ${x} / ${u}`,equipment_id:k.equipment_id}}).sort((k,_)=>k.label.localeCompare(_.label))});K(()=>s.network_id,()=>{s.network_node_id=$e.value}),K(()=>s.network_node_id,l=>{if(!l){s.related_equipments=[],R.value||(s.region_id=null);return}const n=b.networks.find(p=>p.id===s.network_id);if(!n||!n.nodes)return;const d=n.nodes.find(p=>p.id===l);d?(s.region_id=n.region_id,s.related_equipments=d.equipment_id?[d.equipment_id]:[],console.log(`Région ID ${d.region_id} et Équipement ID ${d.equipment_id} liés automatiquement au nœud ${l}`)):(R.value||(s.region_id=null),s.related_equipments=[])},{immediate:!0});const Ie=l=>{var d;if(!l)return"";const n=(d=l.region)!=null&&d.designation?` (${l.region.designation})`:"";return`${l.name}${n}`};return(l,n)=>{const d=Dt,p=Vt,u=kt,f=yt,k=xt,_=wt,V=gt;return m(),A(At,{title:e(a)("maintenances.title")},{default:y(()=>[r(e(Tt),{title:"Maintenances"}),r(d),r(p),t("div",It,[t("div",Lt,[t("div",Et,[Ft,t("div",null,[t("h1",Ot,c(e(a)("maintenances.headTitle")),1),t("p",Pt,c(e(a)("maintenances.subtitle")),1)])]),t("div",zt,[t("button",{onClick:Me,class:"flex flex-1 items-center justify-center gap-2 rounded-2xl border border-slate-200 bg-white px-5 py-3 text-sm font-bold text-emerald-600 shadow-sm transition-all hover:bg-emerald-50 active:scale-95 lg:flex-none"},[Rt,q(" "+c(e(a)("maintenances.exportExcel")),1)]),t("button",{onClick:Qe,class:"flex flex-[2] items-center justify-center gap-2 rounded-2xl bg-primary-600 px-6 py-4 text-sm font-black text-white shadow-lg shadow-primary-100 transition-all hover:bg-primary-700 active:scale-95 lg:flex-none"},[Xt,q(" "+c(e(a)("maintenances.new")),1)])])]),t("div",Jt,[t("div",Wt,[Ht,t("div",null,[t("div",Bt,c(_e.value.total),1),Qt])]),t("div",Zt,[Gt,t("div",null,[t("div",Kt,c(_e.value.inProgress),1),Yt])]),t("div",es,[ts,t("div",null,[t("div",ss,c(_e.value.completed),1),ls])])]),t("div",as,[r(k,{value:F.maintenances.data,ref_key:"dt",ref:ye,dataKey:"id",expandedRows:we.value,"onUpdate:expandedRows":n[1]||(n[1]=o=>we.value=o),paginator:!0,rows:10,scrollable:"",scrollHeight:"600px",class:"v11-table",filters:se.value,"onUpdate:filters":n[2]||(n[2]=o=>se.value=o),filterDisplay:"menu",globalFilterFields:["title","assignable.name","status","priority","type","region.designation"],removableSort:""},{header:y(()=>[t("div",ns,[r(e(Mt),{iconPosition:"left"},{default:y(()=>[r(e(Nt),{class:"pi pi-search text-slate-400"}),r(e(z),{modelValue:se.value.global.value,"onUpdate:modelValue":n[0]||(n[0]=o=>se.value.global.value=o),placeholder:e(a)("maintenances.searchPlaceholder"),class:"w-full md:w-80 rounded-2xl border-slate-200 bg-slate-50/50 focus:bg-white"},null,8,["modelValue","placeholder"])]),_:1}),t("div",os,[r(u,{icon:"pi pi-filter-slash",outlined:"",severity:"secondary",onClick:Re,class:"rounded-xl"}),r(u,{icon:"pi pi-download",text:"",rounded:"",severity:"secondary",onClick:Me}),r(u,{icon:"pi pi-cog",text:"",rounded:"",severity:"secondary",onClick:Xe})])])]),expansion:y(({data:o})=>[t("div",hs,[vs,o.regenerated_dates&&Pe(o.regenerated_dates).length>0?(m(),v("div",gs,[(m(!0),v(P,null,W(Pe(o.regenerated_dates),i=>(m(),v("div",{key:i,class:"flex items-center gap-2 bg-white p-2 rounded-lg border border-slate-200 shadow-sm"},[r(e(ne),{value:Oe(i,o.reminder_days).label,severity:Oe(i,o.reminder_days).severity,class:"text-[9px] uppercase font-black"},null,8,["value","severity"]),t("span",ys,c(Gn(i)),1)]))),128))])):(m(),v("div",xs," Aucune date de récurrence n'est configurée pour cette maintenance. "))])]),default:y(()=>[r(f,{expander:!0,headerStyle:"width: 3rem"}),r(f,{selectionMode:"multiple",headerStyle:"width: 4rem",class:"pl-8"}),$.value.includes("title")?(m(),A(f,{key:0,header:e(a)("maintenances.columns.title"),minWidth:"300px"},{body:y(({data:o})=>[t("div",{class:"group flex cursor-pointer items-center gap-4 py-2",onClick:i=>Ae(o)},[rs,t("div",ds,[t("span",cs,c(o.title),1),t("span",us,"ID: #"+c(o.id.toString().padStart(4,"0")),1)])],8,is)]),filter:y(({filterModel:o})=>[r(e(z),{modelValue:o.constraints[0].value,"onUpdate:modelValue":i=>o.constraints[0].value=i,type:"text",class:"p-column-filter",placeholder:e(a)("maintenances.filter.title")},null,8,["modelValue","onUpdate:modelValue","placeholder"])]),_:1},8,["header"])):g("",!0),$.value.includes("equipments")?(m(),A(f,{key:1,header:e(a)("maintenances.columns.equipments"),minWidth:"250px"},{body:y(o=>{var i;return[(i=o.data.equipments)!=null&&i.length?(m(),v("div",ps,[(m(!0),v(P,null,W(o.data.equipments,x=>(m(),A(e(ne),{key:x.id,value:x.designation,class:"!bg-slate-200 !text-slate-700 !font-bold"},null,8,["value"]))),128))])):g("",!0)]}),_:1},8,["header"])):g("",!0),$.value.includes("assignable")?(m(),A(f,{key:2,field:"assignable.name",header:e(a)("maintenances.columns.assignable"),minWidth:"200px"},{body:y(o=>[o.data.assignable?(m(),v("div",ms,[r(e(jt),{label:o.data.assignable.name[0],shape:"circle",class:"!bg-slate-900 !text-white !font-black"},null,8,["label"]),t("span",_s,c(o.data.assignable.name),1)])):g("",!0)]),filter:y(({filterModel:o})=>[r(e(z),{modelValue:o.value,"onUpdate:modelValue":i=>o.value=i,type:"text",class:"p-column-filter",placeholder:e(a)("maintenances.filter.assignable")},null,8,["modelValue","onUpdate:modelValue","placeholder"])]),_:1},8,["header"])):g("",!0),$.value.includes("status")?(m(),A(f,{key:3,field:"status",header:e(a)("maintenances.columns.status"),minWidth:"150px"},{body:y(o=>[r(e(ne),{value:o.data.status,severity:pt(o.data.status)},null,8,["value","severity"])]),filter:y(({filterModel:o})=>[r(e(D),{modelValue:o.value,"onUpdate:modelValue":i=>o.value=i,options:qe.value,optionLabel:"label",optionValue:"value",placeholder:e(a)("maintenances.filter.status"),class:"p-column-filter",showClear:""},null,8,["modelValue","onUpdate:modelValue","options","placeholder"])]),_:1},8,["header"])):g("",!0),$.value.includes("priority")?(m(),A(f,{key:4,field:"priority",header:e(a)("maintenances.columns.priority"),minWidth:"150px"},{body:y(o=>[r(e(ne),{value:o.data.priority,severity:mt(o.data.priority)},null,8,["value","severity"])]),filter:y(({filterModel:o})=>[r(e(D),{modelValue:o.value,"onUpdate:modelValue":i=>o.value=i,options:me.value,placeholder:e(a)("maintenances.filter.priority"),class:"p-column-filter",showClear:""},null,8,["modelValue","onUpdate:modelValue","options","placeholder"])]),_:1},8,["header"])):g("",!0),$.value.includes("scheduled_start_date")?(m(),A(f,{key:5,field:"scheduled_start_date",header:e(a)("maintenances.columns.scheduled_start_date"),minWidth:"200px"},{body:y(o=>[t("span",bs,c(new Date(o.data.scheduled_start_date).toLocaleString()),1)]),_:1},8,["header"])):g("",!0),$.value.includes("type")?(m(),A(f,{key:6,field:"type",header:e(a)("maintenances.columns.type"),sortable:!0,style:{"min-width":"10rem"}},{body:y(o=>[q(c(o.data.type),1)]),filter:y(({filterModel:o})=>[r(e(D),{modelValue:o.value,"onUpdate:modelValue":i=>o.value=i,options:De.value,placeholder:e(a)("maintenances.filter.type"),class:"p-column-filter",showClear:""},null,8,["modelValue","onUpdate:modelValue","options","placeholder"])]),_:1},8,["header"])):g("",!0),$.value.includes("description")?(m(),A(f,{key:7,field:"description",header:e(a)("maintenances.columns.description"),sortable:!0,style:{"min-width":"15rem"}},null,8,["header"])):g("",!0),$.value.includes("estimated_duration")?(m(),A(f,{key:8,field:"estimated_duration",header:e(a)("maintenances.columns.estimated_duration"),sortable:!0,style:{"min-width":"10rem"}},{body:y(o=>[q(c(o.data.estimated_duration)+" min ",1)]),_:1},8,["header"])):g("",!0),$.value.includes("cost")?(m(),A(f,{key:9,field:"cost",header:e(a)("maintenances.columns.cost"),sortable:!0,style:{"min-width":"10rem"}},{body:y(o=>[q(c(o.data.cost)+" USD ",1)]),_:1},8,["header"])):g("",!0),$.value.includes("region.designation")?(m(),A(f,{key:10,field:"region.designation",header:e(a)("maintenances.columns.region"),sortable:!0,style:{"min-width":"10rem"}},{body:y(o=>[q(c(o.data.region?o.data.region.designation:"N/A"),1)]),filter:y(({filterModel:o})=>[r(e(z),{modelValue:o.value,"onUpdate:modelValue":i=>o.value=i,type:"text",class:"p-column-filter",placeholder:e(a)("maintenances.filter.region")},null,8,["modelValue","onUpdate:modelValue","placeholder"])]),_:1},8,["header"])):g("",!0),$.value.includes("recurrence_type")?(m(),A(f,{key:11,field:"recurrence_type",header:e(a)("maintenances.columns.recurrence_type"),sortable:!0,style:{"min-width":"10rem"}},{body:y(o=>[q(c(o.data.recurrence_type||"Aucune"),1)]),_:1},8,["header"])):g("",!0),r(f,{header:e(a)("maintenances.columns.actions"),alignFrozen:"right",frozen:"",class:"pr-8"},{body:y(({data:o})=>[t("div",fs,[r(u,{icon:"pi pi-pencil",text:"",rounded:"",onClick:i=>Ae(o),class:"!text-slate-400 hover:!bg-primary-50 hover:!text-primary-600 transition-all"},null,8,["onClick"]),de(r(u,{icon:"pi pi-bolt",text:"",rounded:"",onClick:i=>it(o,!1),class:"!text-slate-400 hover:!bg-green-50 hover:!text-green-600 transition-all"},null,8,["onClick"]),[[V,"Créer une activité",void 0,{top:!0}]]),r(u,{icon:"pi pi-trash",text:"",rounded:"",onClick:i=>st(o),class:"!text-slate-400 hover:!bg-red-50 hover:!text-red-500 transition-all"},null,8,["onClick"])])]),_:1},8,["header"])]),_:1},8,["value","expandedRows","filters"]),r(e($t),{ref_key:"op",ref:xe,appendTo:"body",id:"column_op",class:"p-4"},{default:y(()=>[t("div",ws,c(e(a)("maintenances.columnSelector.title")),1),r(e(ve),{modelValue:$.value,"onUpdate:modelValue":n[3]||(n[3]=o=>$.value=o),options:ke.value,optionLabel:"header",optionValue:"field",display:"chip",placeholder:e(a)("maintenances.columnSelector.placeholder"),class:"w-full max-w-xs"},null,8,["modelValue","options","placeholder"])]),_:1},512)])]),r(e(ge),{visible:le.value,"onUpdate:visible":n[5]||(n[5]=o=>le.value=o),modal:"",header:!1,closable:!1,class:"v12-enterprise-dialog w-full max-w-7xl",pt:{root:{class:"border-none shadow-2xl"},header:{class:"bg-slate-50 border-b border-slate-200 p-4"},content:{class:"p-0"}}},{header:y(()=>[t("div",ks,[Vs,t("div",null,[t("h2",Ds,c(e(a)("maintenances.activityDialog.batchManagerTitle")),1),t("p",qs,c(e(a)("maintenances.activityDialog.batchManagerSubtitle")),1)])])]),default:y(()=>[O.value?(m(),v("div",Ss,[t("div",Us,[t("div",Cs,[t("div",Ts,[t("span",As,c(e(a)("maintenances.activityDialog.parentMaintenance")),1),t("h3",$s,[q(c(O.value.title)+" ",1),Ms])]),Ns,t("div",js,[t("span",Is,c(e(a)("maintenances.activityDialog.activityVolume")),1),t("p",Ls,c(e(j).activities.length)+" Item(s)",1)])]),t("div",Es,[r(u,{label:e(a)("maintenances.activityDialog.newActivity"),icon:"pi pi-plus",class:"p-button-sm p-button-raised bg-primary-600 border-none text-[11px] font-bold",onClick:Ve},null,8,["label"])])]),t("div",Fs,[(m(!0),v(P,null,W(e(j).activities,(o,i)=>{var x;return m(),v("div",{key:i,class:"bg-white border border-slate-200 rounded-lg shadow-sm transition-all hover:border-slate-300"},[t("div",Os,[t("span",Ps,"#0"+c(i+1),1),r(e(z),{modelValue:o.title,"onUpdate:modelValue":h=>o.title=h,class:"flex-1 !bg-transparent !border-none !shadow-none font-bold text-slate-800 focus:ring-0 py-1",placeholder:e(a)("maintenances.activityDialog.activityNamePlaceholder")},null,8,["modelValue","onUpdate:modelValue","placeholder"]),t("div",zs,[t("div",Rs,[q(c(e(a)("maintenances.activityDialog.statusLabel"))+" ",1),r(e(D),{modelValue:o.status,"onUpdate:modelValue":h=>o.status=h,options:We.value,optionLabel:"label",optionValue:"value",class:"v12-minimal-dropdown"},null,8,["modelValue","onUpdate:modelValue","options"])]),de(r(u,{icon:"pi pi-clone",class:"p-button-text p-button-secondary p-button-sm"},null,512),[[V,e(a)("maintenances.activityDialog.duplicateTooltip"),void 0,{top:!0}]]),r(u,{icon:"pi pi-trash",class:"p-button-text p-button-danger p-button-sm",onClick:h=>ct(i)},null,8,["onClick"])])]),t("div",Xs,[t("div",Js,[t("div",Ws,[t("div",Hs,[t("div",Bs,[t("h5",Qs,[Zs,q(" "+c(e(a)("maintenances.activityDialog.attribution")),1)]),t("div",Gs,[t("div",Ks,[r(e(D),{modelValue:o.assignable_type,"onUpdate:modelValue":h=>o.assignable_type=h,options:Se.value,optionLabel:"label",optionValue:"value",placeholder:e(a)("maintenances.activityDialog.entityTypePlaceholder"),class:"w-full v12-input"},null,8,["modelValue","onUpdate:modelValue","options","placeholder"])]),t("div",Ys,[r(e(D),{modelValue:o.assignable_id,"onUpdate:modelValue":h=>o.assignable_id=h,options:at(o),optionLabel:"name",optionValue:"id",filter:"",disabled:!o.assignable_type,placeholder:e(a)("maintenances.activityDialog.responsiblePlaceholder"),class:"w-full v12-input"},null,8,["modelValue","onUpdate:modelValue","options","disabled","placeholder"])])])])]),t("div",el,[t("div",tl,[t("h5",sl,[ll,q(" "+c(e(a)("maintenances.activityDialog.concernedAssets")),1)]),r(e(ve),{modelValue:o.equipment_ids,"onUpdate:modelValue":h=>o.equipment_ids=h,options:lt(i),optionLabel:"designation",optionValue:"id",display:"chip",class:"w-full v12-input flex-1",filter:"",placeholder:e(a)("maintenances.activityDialog.searchEquipmentsPlaceholder")},null,8,["modelValue","onUpdate:modelValue","options","placeholder"]),t("div",al,[t("div",nl,[t("span",ol,c(e(a)("maintenances.activityDialog.estimatedCost")),1),r(e(H),{modelValue:o.cost,"onUpdate:modelValue":h=>o.cost=h,mode:"currency",currency:"USD",class:"quantum-input-transparent text-right font-black"},null,8,["modelValue","onUpdate:modelValue"])])])])])]),t("div",il,[t("h5",rl,[dl,q(" "+c(e(a)("maintenances.activityDialog.planning")),1)]),t("div",cl,[t("div",ul,[t("label",pl,c(e(a)("maintenances.activityDialog.priority")),1),r(e(D),{modelValue:o.priority,"onUpdate:modelValue":h=>o.priority=h,options:me.value,class:"w-full v12-input"},null,8,["modelValue","onUpdate:modelValue","options"])]),t("div",ml,[t("label",_l,c(e(a)("maintenances.activityDialog.durationInMinutes")),1),r(e(H),{modelValue:o.estimated_duration,"onUpdate:modelValue":h=>o.estimated_duration=h,class:"w-full v12-input"},null,8,["modelValue","onUpdate:modelValue"])]),t("div",bl,[t("label",fl,c(e(a)("maintenances.activityDialog.executionPeriod")),1),r(e(ce),{modelValue:o.actual_start_time,"onUpdate:modelValue":h=>o.actual_start_time=h,showTime:"",hourFormat:"24",placeholder:e(a)("maintenances.activityDialog.start"),class:"w-full v12-input mb-1"},null,8,["modelValue","onUpdate:modelValue","placeholder"]),r(e(ce),{modelValue:o.actual_end_time,"onUpdate:modelValue":h=>o.actual_end_time=h,showTime:"",hourFormat:"24",placeholder:e(a)("maintenances.activityDialog.end"),class:"w-full v12-input"},null,8,["modelValue","onUpdate:modelValue","placeholder"])])])])]),t("div",hl,[t("div",vl,[t("div",gl,[t("h5",yl,c(e(a)("maintenances.activityDialog.checklist")),1),r(u,{icon:"pi pi-plus",class:"p-button-text p-button-sm !p-0 h-4 w-4",onClick:h=>nt(i)},null,8,["onClick"])]),t("div",xl,[(m(!0),v(P,null,W(o.instructions,(h,L)=>(m(),v("div",{key:L,class:"flex items-center gap-2 bg-slate-50 p-1.5 rounded border border-slate-100"},[r(e(Fe),{modelValue:h.is_required,"onUpdate:modelValue":C=>h.is_required=C,binary:"",class:"scale-75"},null,8,["modelValue","onUpdate:modelValue"]),r(e(z),{modelValue:h.label,"onUpdate:modelValue":C=>h.label=C,placeholder:e(a)("maintenances.activityDialog.instructionPlaceholder"),class:"flex-1 text-[10px] border-none !bg-transparent p-0"},null,8,["modelValue","onUpdate:modelValue","placeholder"]),r(e(D),{modelValue:h.type,"onUpdate:modelValue":C=>h.type=C,options:Ce.value,optionLabel:"label",optionValue:"value",placeholder:e(a)("maintenances.activityDialog.selectType"),class:"v12-instruction-type-dropdown flex-1 text-[9px]"},null,8,["modelValue","onUpdate:modelValue","options","placeholder"]),r(u,{icon:"pi pi-trash",class:"p-button-danger p-button-text p-button-sm !p-0",onClick:C=>ot(i,L)},null,8,["onClick"])]))),128)),(x=o.instructions)!=null&&x.length?g("",!0):(m(),v("div",wl,c(e(a)("maintenances.activityDialog.zeroInstructions")),1))])]),t("div",kl,[t("div",Vl,[t("h5",Dl,c(e(a)("maintenances.activityDialog.spareParts")),1),r(u,{icon:"pi pi-plus",class:"p-button-text p-button-sm !p-0 h-4 w-4",onClick:h=>rt(i)},null,8,["onClick"])]),t("div",ql,[(m(!0),v(P,null,W(o.spare_parts,(h,L)=>(m(),v("div",{key:L,class:"flex items-center gap-1 bg-slate-50 p-1 rounded border border-slate-100 min-w-0"},[r(e(D),{modelValue:h.id,"onUpdate:modelValue":C=>h.id=C,options:F.spareParts,optionLabel:"reference",optionValue:"id",filter:"",class:"flex-1 min-w-0 text-[9px] border-none !bg-transparent v12-spare-select"},null,8,["modelValue","onUpdate:modelValue","options"]),r(e(H),{modelValue:h.quantity_used,"onUpdate:modelValue":C=>h.quantity_used=C,min:1,inputClass:"w-[80px] text-[9px] p-0 text-center font-black bg-white border border-slate-200 rounded shadow-sm",class:"shrink-0"},null,8,["modelValue","onUpdate:modelValue"]),r(u,{icon:"pi pi-times",class:"p-button-text p-button-danger p-button-sm !p-0 shrink-0 w-4 h-4",onClick:C=>dt(i,L)},null,8,["onClick"])]))),128))])])])])])}),128))]),t("div",Sl,[r(u,{label:e(a)("maintenances.activityDialog.resetForm"),icon:"pi pi-refresh",class:"p-button-text p-button-secondary text-xs font-bold"},null,8,["label"]),t("div",Ul,[r(u,{label:e(a)("maintenances.activityDialog.cancel"),class:"p-button-text p-button-secondary font-bold text-xs",onClick:n[4]||(n[4]=o=>le.value=!1)},null,8,["label"]),r(u,{label:e(a)("maintenances.activityDialog.validateAndDeploy"),icon:"pi pi-send",class:"bg-slate-900 border-none px-6 py-2.5 rounded text-xs font-black tracking-widest shadow-lg hover:bg-slate-800",onClick:ut,loading:e(j).processing},null,8,["label","loading"])])])])):g("",!0)]),_:1},8,["visible"]),r(e(ge),{visible:I.value,"onUpdate:visible":n[30]||(n[30]=o=>I.value=o),modal:"",header:!1,closable:!1,class:"quantum-dialog w-full max-w-7xl",pt:{mask:{style:"backdrop-filter: blur(4px)"}}},{footer:y(()=>[t("div",Rn,[r(u,{label:e(a)("maintenances.formDialog.cancelChanges"),icon:"pi pi-times",class:"p-button-text p-button-secondary font-bold",onClick:Te},null,8,["label"]),t("div",Xn,[r(u,{label:e(a)("maintenances.formDialog.savePlan"),icon:"pi pi-check-circle",class:"px-8 py-4 !rounded-2xl shadow-xl shadow-primary-100 font-black tracking-tight transition-all hover:scale-[1.02] active:scale-95",onClick:Ze,loading:Y.value},null,8,["label","loading"])])])]),default:y(()=>{var o;return[t("div",Cl,[t("div",Tl,[Al,t("div",$l,[t("h2",Ml,c(R.value?e(a)("maintenances.formDialog.editTitle"):e(a)("maintenances.formDialog.createTitle")),1),t("span",Nl,c(e(a)("maintenances.formDialog.gmaoConsole")),1)])]),t("div",jl,[e(s).network_id?(m(),v("div",Il,[Ll,r(e(ne),{value:(o=b.networks.find(i=>i.id===e(s).network_id))==null?void 0:o.name,class:"bg-primary-500/20 text-primary-300 border border-primary-500/30"},null,8,["value"])])):g("",!0),r(u,{icon:"pi pi-times",variant:"text",severity:"secondary",rounded:"",onClick:Te,class:"text-white hover:bg-white/10"})])]),t("div",El,[t("div",Fl,[t("div",Ol,[t("div",Pl,[t("h3",zl,[Rl,q(" "+c(e(a)("maintenances.formDialog.missionId")),1)]),t("div",Xl,[t("label",Jl,c(e(a)("maintenances.formDialog.interventionTitle")),1),r(e(z),{id:"title",modelValue:e(s).title,"onUpdate:modelValue":n[6]||(n[6]=i=>e(s).title=i),modelModifiers:{trim:!0},class:he(["w-full",{"p-invalid":oe.value&&!e(s).title}]),placeholder:e(a)("maintenances.formDialog.interventionTitlePlaceholder")},null,8,["modelValue","class","placeholder"]),e(s).errors.title?(m(),v("small",Wl,c(e(s).errors.title),1)):g("",!0)]),t("div",Hl,[Bl,r(e(D),{id:"network",modelValue:e(s).network_id,"onUpdate:modelValue":n[7]||(n[7]=i=>e(s).network_id=i),options:b.networks,optionValue:"id",placeholder:"Sélectionner un réseau",filter:"",class:"w-full quantum-input !bg-white"},{value:y(i=>[i.value?(m(),v("div",Ql,c(Ie(b.networks.find(x=>x.id===i.value))),1)):(m(),v("span",Zl,c(i.placeholder),1))]),option:y(i=>[t("div",null,c(Ie(i.option)),1)]),_:1},8,["modelValue","options"])]),t("div",Gl,[t("label",Kl,c(e(a)("maintenances.formDialog.concernedEquipments")),1),t("div",Yl,[r(e(D),{id:"network_node_id",modelValue:e(s).network_node_id,"onUpdate:modelValue":n[8]||(n[8]=i=>e(s).network_node_id=i),options:je.value,optionLabel:"label",optionValue:"value",placeholder:e(a)("maintenances.formDialog.selectAssets"),filter:!0,showClear:!0,filterPlaceholder:"Rechercher un équipement, une zone...",class:"w-full quantum-input",disabled:!e(s).network_id},{option:y(i=>[t("div",ea,[t("div",ta,[sa,t("span",la,c(i.option.label.split(" / ")[0]),1)]),t("div",aa,[na,t("span",null,c(i.option.label.split(" / ").slice(1).join(" • ")),1)])])]),_:1},8,["modelValue","options","placeholder","disabled"])]),e(s).errors.related_equipments?(m(),v("small",oa,c(e(s).errors.related_equipments),1)):g("",!0)]),t("div",ia,[t("label",ra,c(e(a)("maintenances.formDialog.detailedDescription")),1),r(e(Ee),{id:"description",modelValue:e(s).description,"onUpdate:modelValue":n[9]||(n[9]=i=>e(s).description=i),rows:"4",class:"w-full p-4 rounded-2xl border border-slate-200 focus:ring-2 focus:ring-primary-500 text-sm bg-white",placeholder:e(a)("maintenances.formDialog.generalInstructions")},null,8,["modelValue","placeholder"]),e(s).errors.description?(m(),v("small",da,c(e(s).errors.description),1)):g("",!0)])]),t("div",ca,[t("div",ua,[t("h3",pa,[ma,q(" "+c(e(a)("maintenances.formDialog.configPerEquipment")),1)]),r(u,{label:ee.value?e(a)("maintenances.formDialog.hideControlPoints"):e(a)("maintenances.formDialog.showControlPoints"),icon:ee.value?"pi pi-chevron-up":"pi pi-cog",class:"p-button-text p-button-sm font-bold text-primary-600",onClick:n[10]||(n[10]=i=>ee.value=!ee.value)},null,8,["label","icon"])]),ee.value?(m(),v("div",_a,[!X.value||X.value.length===0?(m(),v("div",ba,[fa,t("p",ha,c(e(a)("maintenances.formDialog.noEquipmentSelected")),1)])):(m(!0),v(P,{key:1},W(_t.value,i=>(m(),v("div",{key:i.parent.key,class:"border border-slate-100 rounded-3xl overflow-hidden bg-white shadow-sm"},[t("div",{class:"flex justify-between items-center p-4 bg-slate-50/80 cursor-pointer hover:bg-slate-100 transition-colors",onClick:x=>bt(i.parent.key)},[t("div",ga,[ya,t("span",xa,c(i.parent.label),1)]),t("i",{class:he([Ne(i.parent.key)?"pi pi-chevron-up":"pi pi-chevron-down","text-[10px] text-slate-400"])},null,2)],8,va),Ne(i.parent.key)?(m(),v("div",wa,[(m(!0),v(P,null,W(i.children,x=>{var h,L,C,re;return m(),v("div",{key:x.key,class:"p-5 rounded-2xl bg-slate-50/50 border border-slate-100"},[t("div",ka,[t("span",Va,c(x.label),1),t("div",Da,[(h=e(s).node_instructions[x.key])!=null&&h.length?(m(),A(u,{key:0,icon:"pi pi-copy",label:e(a)("maintenances.formDialog.clone"),class:"p-button-text p-button-sm text-[10px] font-bold",onClick:M=>vt(x.key)},null,8,["label","onClick"])):g("",!0),(L=e(s).node_instructions[x.key])!=null&&L.length?(m(),A(u,{key:1,icon:"pi pi-save",label:"Modèle",class:"p-button-text p-button-secondary p-button-sm text-[10px] font-bold",onClick:M=>Ge(x.key)},null,8,["onClick"])):g("",!0),r(u,{icon:"pi pi-plus",label:e(a)("maintenances.formDialog.addInstruction"),class:"p-button-primary p-button-sm text-[10px] font-bold shadow-sm",onClick:M=>ft(x.key)},null,8,["label","onClick"])])]),t("div",qa,[b.instructionTemplates&&b.instructionTemplates.length>0?(m(),v("div",Sa,[(C=e(s).node_instructions[x.key])!=null&&C.template_id?(m(),v(P,{key:0},[de(r(u,{icon:"pi pi-pencil",onClick:M=>Ye(b.instructionTemplates.find(E=>E.id===e(s).node_instructions[x.key].template_id)),text:"",rounded:"",severity:"secondary"},null,8,["onClick"]),[[V,"Modifier le modèle appliqué",void 0,{top:!0}]]),de(r(u,{icon:"pi pi-trash",onClick:M=>tt(b.instructionTemplates.find(E=>E.id===e(s).node_instructions[x.key].template_id)),text:"",rounded:"",severity:"danger"},null,8,["onClick"]),[[V,"Supprimer le modèle appliqué",void 0,{top:!0}]])],64)):g("",!0),r(e(D),{options:b.instructionTemplates,optionLabel:"name",placeholder:"Appliquer un modèle",class:"p-dropdown-sm !w-auto text-xs",onChange:M=>{const E=M.value,J=JSON.parse(JSON.stringify(E.instructions));e(s).node_instructions[x.key]=J,e(s).node_instructions[x.key].template_id=E.id,e(S).add({severity:"info",summary:"Modèle appliqué",detail:`Les instructions de '${M.value.name}' ont été chargées.`,life:3e3})}},null,8,["options","onChange"])])):g("",!0),(m(!0),v(P,null,W(e(s).node_instructions[x.key],(M,E)=>(m(),v("div",{key:E,class:"grid grid-cols-1 md:grid-cols-12 gap-3 items-center bg-white p-3 rounded-xl border border-slate-200 shadow-sm relative group"},[t("div",Ua,[r(e(z),{modelValue:M.label,"onUpdate:modelValue":J=>M.label=J,placeholder:e(a)("maintenances.formDialog.instructionLabelPlaceholder"),class:"w-full p-inputtext-sm border-none shadow-none font-medium"},null,8,["modelValue","onUpdate:modelValue","placeholder"])]),t("div",Ca,[r(e(D),{modelValue:M.type,"onUpdate:modelValue":J=>M.type=J,options:Ce.value,optionLabel:"label",optionValue:"value",class:"w-full p-inputtext-sm border-slate-100"},null,8,["modelValue","onUpdate:modelValue","options"])]),t("div",Ta,[r(e(Fe),{modelValue:M.is_required,"onUpdate:modelValue":J=>M.is_required=J,binary:"",inputId:`req-${x.key}-${E}`},null,8,["modelValue","onUpdate:modelValue","inputId"]),t("label",{for:`req-${x.key}-${E}`,class:"text-[9px] font-black uppercase text-slate-400 cursor-pointer"},c(e(a)("maintenances.formDialog.required")),9,Aa)]),t("div",$a,[r(u,{icon:"pi pi-trash",class:"p-button-danger p-button-text p-button-sm opacity-0 group-hover:opacity-100 transition-opacity",onClick:J=>ht(x.key,E)},null,8,["onClick"])])]))),128)),(re=e(s).node_instructions[x.key])!=null&&re.length?g("",!0):(m(),v("div",Ma,c(e(a)("maintenances.formDialog.noSpecificInstruction")),1))])])}),128))])):g("",!0)]))),128))])):g("",!0)])]),t("div",Na,[t("div",ja,[Ia,t("h4",La,[Ea,q(" "+c(e(a)("maintenances.formDialog.logisticsAndTiming")),1)]),t("div",Fa,[t("div",Oa,[t("div",Pa,[t("label",za,c(e(s).status==="Planifiée"?e(a)("maintenances.formDialog.plannedStart"):e(a)("maintenances.formDialog.actualStart")),1),r(e(ce),{modelValue:e(s).scheduled_start_date,"onUpdate:modelValue":n[11]||(n[11]=i=>e(s).scheduled_start_date=i),showTime:"",dateFormat:"dd/mm/yy",showIcon:"",class:"quantum-calendar-dark w-full"},null,8,["modelValue"]),e(s).errors.scheduled_start_date?(m(),v("small",Ra,c(e(s).errors.scheduled_start_date),1)):g("",!0)]),t("div",Xa,[t("label",Ja,c(e(s).status==="Planifiée"?e(a)("maintenances.formDialog.plannedEnd"):e(a)("maintenances.formDialog.actualEnd")),1),r(e(ce),{modelValue:e(s).scheduled_end_date,"onUpdate:modelValue":n[12]||(n[12]=i=>e(s).scheduled_end_date=i),showTime:"",dateFormat:"dd/mm/yy",showIcon:"",class:"quantum-calendar-dark w-full"},null,8,["modelValue"]),e(s).errors.scheduled_end_date?(m(),v("small",Wa,c(e(s).errors.scheduled_end_date),1)):g("",!0)])]),t("div",Ha,[t("label",Ba,c(e(a)("maintenances.formDialog.interventionResponsible")),1),t("div",Qa,[r(e(D),{modelValue:e(s).assignable_type,"onUpdate:modelValue":n[13]||(n[13]=i=>e(s).assignable_type=i),options:Se.value,optionLabel:"label",optionValue:"value",placeholder:e(a)("maintenances.formDialog.assignableTypePlaceholder"),class:"w-1/3 bg-transparent border-white/20 text-white"},null,8,["modelValue","options","placeholder"]),r(e(D),{modelValue:e(s).assignable_id,"onUpdate:modelValue":n[14]||(n[14]=i=>e(s).assignable_id=i),options:He.value,optionLabel:"name",optionValue:"id",placeholder:e(a)("maintenances.formDialog.assignableSelectPlaceholder"),disabled:!e(s).assignable_type,filter:"",class:"flex-1 bg-transparent border-white/20 text-white"},null,8,["modelValue","options","placeholder","disabled"])]),e(s).errors.assignable_id?(m(),v("small",Za,c(e(s).errors.assignable_id),1)):g("",!0)]),t("div",Ga,[t("div",Ka,[t("label",Ya,c(e(a)("maintenances.formDialog.maintenanceType")),1),r(e(D),{modelValue:e(s).type,"onUpdate:modelValue":n[15]||(n[15]=i=>e(s).type=i),options:De.value,class:"w-full bg-white/5 border-white/10 text-white rounded-xl"},null,8,["modelValue","options"])]),t("div",en,[t("label",tn,c(e(a)("maintenances.formDialog.currentStatus")),1),r(e(D),{modelValue:e(s).status,"onUpdate:modelValue":n[16]||(n[16]=i=>e(s).status=i),options:qe.value,optionLabel:"label",optionValue:"value",class:"w-full bg-white/5 border-white/10 text-white rounded-xl"},null,8,["modelValue","options"])])]),t("div",sn,[t("div",ln,[t("label",an,c(e(a)("maintenances.formDialog.priorityLevel")),1),r(e(D),{modelValue:e(s).priority,"onUpdate:modelValue":n[17]||(n[17]=i=>e(s).priority=i),options:me.value,class:"w-full bg-white/5 border-white/10 text-white rounded-xl"},null,8,["modelValue","options"])]),t("div",nn,[t("label",on,c(e(a)("maintenances.formDialog.interventionRegion")),1),r(e(D),{modelValue:e(s).region_id,"onUpdate:modelValue":n[18]||(n[18]=i=>e(s).region_id=i),options:b.regions,optionLabel:"designation",optionValue:"id",readonly:"",class:"w-full bg-white/5 border-white/10 text-white rounded-xl",disabled:!0},null,8,["modelValue","options"])])])])]),t("div",rn,[t("h4",dn,[cn,q(" "+c(e(a)("maintenances.formDialog.recurrenceCycle")),1)]),t("div",un,[t("div",pn,[t("label",mn,c(e(a)("maintenances.formDialog.frequency")),1),r(e(D),{modelValue:e(s).recurrence_type,"onUpdate:modelValue":n[19]||(n[19]=i=>e(s).recurrence_type=i),options:Be.value,optionLabel:"label",optionValue:"value",class:"w-full quantum-input !bg-white shadow-none"},null,8,["modelValue","options"])]),e(s).recurrence_type==="daily"?(m(),v("div",_n,[bn,r(e(H),{modelValue:e(s).recurrence_interval,"onUpdate:modelValue":n[20]||(n[20]=i=>e(s).recurrence_interval=i),min:1,max:365,class:"w-full"},null,8,["modelValue"])])):g("",!0),e(s).recurrence_type==="weekly"?(m(),v("div",fn,[t("label",hn,c(e(a)("maintenances.formDialog.daysSelection")),1),r(e(ve),{modelValue:e(s).recurrence_days,"onUpdate:modelValue":n[21]||(n[21]=i=>e(s).recurrence_days=i),options:Ue.value,optionLabel:"label",optionValue:"value",display:"chip",class:"w-full border-none p-0"},null,8,["modelValue","options"])])):g("",!0),["monthly","quarterly","biannual","annual"].includes(e(s).recurrence_type)?(m(),v("div",vn,[t("div",gn,[t("div",yn,[r(_,{modelValue:e(s).monthly_recurrence_type,"onUpdate:modelValue":n[22]||(n[22]=i=>e(s).monthly_recurrence_type=i),inputId:"monthly_day_of_month",name:"monthly_type",value:"day_of_month"},null,8,["modelValue"]),xn]),t("div",wn,[r(_,{modelValue:e(s).monthly_recurrence_type,"onUpdate:modelValue":n[23]||(n[23]=i=>e(s).monthly_recurrence_type=i),inputId:"monthly_day_of_week",name:"monthly_type",value:"day_of_week"},null,8,["modelValue"]),kn])]),t("div",Vn,[e(s).monthly_recurrence_type==="day_of_month"?(m(),v("div",Dn,[qn,r(e(H),{modelValue:e(s).recurrence_day_of_month,"onUpdate:modelValue":n[24]||(n[24]=i=>e(s).recurrence_day_of_month=i),min:1,max:31,placeholder:"Ex: 15",class:"w-full",inputClass:"py-2"},null,8,["modelValue"])])):g("",!0),e(s).monthly_recurrence_type==="day_of_week"?(m(),v("div",Sn,[Un,r(e(D),{modelValue:e(s).recurrence_day,"onUpdate:modelValue":n[25]||(n[25]=i=>e(s).recurrence_day=i),options:Ue.value,optionLabel:"label",optionValue:"value",class:"w-full bg-white"},null,8,["modelValue","options"])])):g("",!0)]),t("div",Cn,[t("label",Tn,c(e(a)("maintenances.formDialog.earlyReminder")),1),t("div",An,[t("div",$n,[r(e(H),{modelValue:e(s).reminder_days,"onUpdate:modelValue":n[26]||(n[26]=i=>e(s).reminder_days=i),min:0,suffix:" jours",class:"w-full",inputClass:"bg-primary-700/50 border-none text-white placeholder:text-primary-300 py-2.5 px-4 rounded-xl w-full"},null,8,["modelValue"])]),Mn])])])):g("",!0),e(s).recurrence_type==="custom"?(m(),v("div",Nn,[t("label",jn,c(e(a)("maintenances.formDialog.customRule")),1),r(e(Ee),{modelValue:e(s).custom_recurrence_config,"onUpdate:modelValue":n[27]||(n[27]=i=>e(s).custom_recurrence_config=i),rows:"2",class:"w-full quantum-input !bg-white",placeholder:e(a)("maintenances.formDialog.customRulePlaceholder")},null,8,["modelValue","placeholder"])])):g("",!0)])]),t("div",In,[t("div",Ln,[En,t("label",Fn,c(e(a)("maintenances.formDialog.estimatedDuration")),1),r(e(H),{id:"estimated_duration",modelValue:e(s).estimated_duration,"onUpdate:modelValue":n[28]||(n[28]=i=>e(s).estimated_duration=i),suffix:" min",class:"quantum-input-transparent",min:0},null,8,["modelValue"])]),t("div",On,[Pn,t("label",zn,c(e(a)("maintenances.formDialog.estimatedBudget")),1),r(e(H),{id:"cost",modelValue:e(s).cost,"onUpdate:modelValue":n[29]||(n[29]=i=>e(s).cost=i),mode:"currency",currency:"USD",locale:"fr-FR",class:"quantum-input-transparent text-emerald-600 font-bold",min:0},null,8,["modelValue"])])])])])])]}),_:1},8,["visible"]),r(e(ge),{visible:G.value,"onUpdate:visible":n[33]||(n[33]=o=>G.value=o),modal:"",header:e(U).id?"Modifier le modèle":"Sauvegarder comme modèle",style:{width:"30rem"}},{footer:y(()=>[r(u,{label:"Annuler",icon:"pi pi-times",onClick:n[32]||(n[32]=o=>G.value=!1),class:"p-button-text"}),r(u,{label:e(U).id?"Mettre à jour":"Sauvegarder",icon:"pi pi-save",onClick:et,loading:e(U).processing},null,8,["label","loading"])]),default:y(()=>[t("div",Jn,[Wn,r(e(z),{id:"template_name",modelValue:e(U).name,"onUpdate:modelValue":n[31]||(n[31]=o=>e(U).name=o),class:he(["w-full",{"p-invalid":e(U).errors.name}]),placeholder:"Ex: Contrôle standard Moteur"},null,8,["modelValue","class"]),t("small",Hn,c(e(U).errors.name),1)]),t("div",Bn,[t("p",Qn,[Zn,q(" Vous êtes sur le point de sauvegarder "),t("strong",null,c(e(U).instructions.length)+" instruction(s)",1),q(" comme un modèle réutilisable. ")])])]),_:1},8,["visible","header"])]),_:1},8,["title"])}}};export{qo as default};
