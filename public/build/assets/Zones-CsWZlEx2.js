import{u as te,a as le,b as oe,r as c,T as se,F as h,c as k,w as j,d as A,e as V,f as n,o as p,i,g as e,Z as ae,j as o,p as m,X as ie,t as g,l as C,q as re,v as ne,k as de,h as M}from"./app-B4oSAkVP.js";import{_ as ue}from"./AppLayout-CEyAmMP5.js";import{s as f}from"./index-DVIMWJjq.js";import{s as T}from"./index-DzCpZxvp.js";import{s as S,a as ce}from"./index-YrJ63t72.js";import{s as pe}from"./index-DzuzenO3.js";import{s as U}from"./index-C20p2cSe.js";import{s as me}from"./index-CZOaMDIN.js";import{s as fe}from"./index-JNFFLNI-.js";import{s as ge}from"./index-DdT1qFJk.js";import{s as ve}from"./index-D82-jNZI.js";import{a as W,s as E}from"./index-Dhf6pfmr.js";import{s as xe}from"./index-BOVQwgbQ.js";import{s as he}from"./index-WjAcbiK8.js";import{s as be}from"./index-CRfXkZE2.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./DropdownLink-B59JWmkM.js";import"./index-LzhPMz77.js";import"./index-DjU5rnlX.js";import"./index-W2upbyuC.js";import"./index-gwiffqIQ.js";import"./index-BM7dsjYe.js";import"./index-DecA6guR.js";import"./index-DZohkDvD.js";const ye={class:"min-h-screen bg-slate-50/50 p-4 lg:p-8"},we={class:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-8"},_e=o("div",{class:"flex items-center gap-4"},[o("div",{class:"flex h-16 w-16 items-center justify-center rounded-[2rem] bg-primary-600 shadow-xl shadow-primary-200"},[o("i",{class:"pi pi-map-marker text-2xl text-white"})]),o("div",null,[o("h1",{class:"text-3xl font-black text-slate-900 tracking-tight"},[de("Gestion des "),o("span",{class:"text-primary-600"},"Zones")]),o("p",{class:"text-slate-500 font-medium"},"Organisation des localisations géographiques")])],-1),ke={class:"flex gap-3"},Ve={class:"bg-white rounded-[2rem] shadow-xl border border-slate-200 overflow-hidden"},Se={class:"flex flex-col md:flex-row justify-between items-center gap-4 p-4"},Ce={class:"flex items-center gap-2"},Te=o("label",{for:"rowsPerPage",class:"text-sm font-medium text-slate-600"},"Lignes par page:",-1),Fe={class:"flex items-center gap-2"},$e={class:"flex items-center gap-3"},ze={class:"font-bold text-slate-700"},Pe={class:"font-medium text-slate-600"},Ne={class:"text-sm text-slate-600"},Ae={class:"flex justify-end gap-1"},Me={class:"font-semibold mb-3"},Ue={class:"px-8 py-5 bg-slate-900 text-white rounded-xl flex justify-between items-center relative z-50"},De=o("div",{class:"flex items-center gap-4"},[o("div",{class:"w-12 h-12 bg-primary-600 rounded-xl flex items-center justify-center text-white shadow-lg shadow-primary-200"},[o("i",{class:"pi pi-box text-xl"})]),o("div",null,[o("h4",{class:"font-black text-slate-100 m-0"},"Configuration de la Zone"),o("p",{class:"text-xs text-slate-500 m-0"},"Renseignez les informations de la zone")])],-1),Ze={class:"p-6 bg-white max-h-[80vh] overflow-y-auto scroll-smooth"},Re={class:"space-y-6 p-2"},Oe={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},Ie={class:"flex flex-col gap-2"},je=o("label",{class:"text-xs font-black text-slate-500 uppercase tracking-wider"},"Région Parente",-1),We={key:0,class:"text-red-500 font-medium italic"},Ee={class:"flex flex-col gap-2"},He=o("label",{class:"text-xs font-black text-slate-500 uppercase tracking-wider"},"Numéro de la zone",-1),qe={key:0,class:"text-red-500 font-medium italic"},Le={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},Be={class:"flex flex-col gap-2"},Ge=o("label",{class:"text-xs font-black text-slate-500 uppercase tracking-wider"},"Titre de la zone",-1),Ke={key:0,class:"text-red-500 font-medium italic"},Xe={class:"flex flex-col gap-2"},Je=o("label",{class:"text-xs font-black text-slate-500 uppercase tracking-wider"},"Nomenclature",-1),Qe={key:0,class:"text-red-500 font-medium italic"},Ye={class:"flex flex-col gap-2"},et=o("label",{class:"text-xs font-black text-slate-500 uppercase tracking-wider"},"Description",-1),tt={key:0,class:"text-red-500 font-medium italic"},lt={class:"flex justify-between items-center w-full px-8 py-5 bg-slate-50 border-t border-slate-100"},Tt={__name:"Zones",props:{zones:Object,regions:Array,filters:Object},setup(F){const{t:d}=te(),_=F,$=le(),D=oe(),Z=c(),b=c(!1);c(!1);const H=c(!1),z=c(!1),y=c(!1),v=c(null),R=c(),s=se({id:null,title:"",description:"",region_id:null,nomenclature:"",number:null}),x=c({global:{value:null,matchMode:h.CONTAINS},nomenclature:{operator:k.AND,constraints:[{value:null,matchMode:h.STARTS_WITH}]},title:{operator:k.AND,constraints:[{value:null,matchMode:h.STARTS_WITH}]},"region.designation":{operator:k.AND,constraints:[{value:null,matchMode:h.STARTS_WITH}]}}),u=c({first:_.zones.from-1,rows:_.zones.per_page,sortField:"created_at",sortOrder:-1,filters:x.value}),P=()=>{y.value=!0;const a={...u.value,page:u.value.first/u.value.rows+1,sortOrder:u.value.sortOrder===1?"asc":"desc"};M.get(route("zones.index"),a,{preserveState:!0,onFinish:()=>{y.value=!1}})},q=()=>{x.value={global:{value:null,matchMode:h.CONTAINS},nomenclature:{operator:k.AND,constraints:[{value:null,matchMode:h.STARTS_WITH}]},title:{operator:k.AND,constraints:[{value:null,matchMode:h.STARTS_WITH}]},"region.designation":{operator:k.AND,constraints:[{value:null,matchMode:h.STARTS_WITH}]}},u.value.filters=x.value,P()},O=a=>{u.value=a,P()},L=a=>{u.value.filters=x.value,P()},I=c([{field:"nomenclature",header:"Nomenclature",default:!0},{field:"region.designation",header:"Région Parente",default:!0},{field:"title",header:"Titre",default:!0},{field:"description",header:"Description",default:!1}]),w=c(I.value.filter(a=>a.default).map(a=>a.field)),B=a=>{R.value.toggle(a)},G=c([10,25,50,100]);j(()=>u.value.rows,a=>{P()}),A(()=>{const a=_.regions||[],l=a.reduce((t,r)=>t+(parseFloat(r.puissance_centrale)||0),0);return{total:a.length,totalMW:l.toLocaleString("fr-FR",{minimumFractionDigits:2}),avgPower:a.length>0?(l/a.length).toFixed(1):0,highPerf:a.filter(t=>t.puissance_centrale>500).length}}),j([()=>s.region_id,()=>s.number,()=>s.title],([a,l,t])=>{let r=[];const N=_.regions.find(ee=>ee.id===a);N&&N.code&&r.push(N.code),l!==null&&l!==""&&r.push(`Zone ${l}`),t&&r.push(`/ ${t}`),s.nomenclature=r.join(" - ").replace(" - /"," /")});const K=()=>{s.reset(),H.value=!1,b.value=!0},X=a=>{s.clearErrors(),s.id=a.id,s.title=a.title,s.nomenclature=a.nomenclature,s.number=a.number,s.region_id=a.region_id,z.value=!0,b.value=!0},J=()=>{y.value=!0;const a=z.value?route("zones.update",s.id):route("zones.store"),l=z.value?"put":"post";s.submit(l,a,{onSuccess:()=>{b.value=!1,$.add({severity:"success",summary:"Succès",detail:"Zone enregistrée",life:3e3}),y.value=!1},onError:()=>{y.value=!1}})},Q=a=>{D.require({message:`Voulez-vous vraiment supprimer la zone "${a.title}" ?`,header:"Attention",icon:"pi pi-exclamation-triangle",acceptClass:"p-button-danger",accept:()=>{M.delete(route("zones.destroy",a.id),{onSuccess:()=>$.add({severity:"info",summary:"Info",detail:"Supprimé"})})}})},Y=()=>{D.require({message:`Voulez-vous vraiment supprimer les ${v.value.length} zones sélectionnées ?`,header:"Confirmation de suppression multiple",icon:"pi pi-exclamation-triangle",acceptClass:"p-button-danger",accept:()=>{const a=v.value.map(l=>l.id);M.post(route("zones.bulkDestroy"),{ids:a},{onSuccess:()=>{$.add({severity:"info",summary:"Info",detail:"Zones supprimées",life:3e3}),v.value=null},onError:()=>$.add({severity:"error",summary:"Erreur",detail:"Échec de la suppression",life:3e3})})}})};return A(()=>[{label:d("regions.status.active"),value:"active"},{label:d("regions.status.inactive"),value:"inactive"}]),A(()=>({total:d("regions.stats.total"),totalMW:d("regions.stats.totalMW"),avgPower:d("regions.stats.avgPower"),highPerf:d("regions.stats.highPerf")})),(a,l)=>(p(),V(ue,null,{default:n(()=>[i(e(ae),{title:"Gestion des Zones"}),o("div",ye,[o("div",we,[_e,o("div",ke,[i(e(f),{label:e(d)("regions.actions.resetFilters"),icon:"pi pi-filter-slash",outlined:"",severity:"secondary",onClick:q,class:"rounded-xl"},null,8,["label"]),i(e(f),{label:e(d)("regions.actions.add"),icon:"pi pi-plus",raised:"",onClick:K,class:"rounded-xl px-6"},null,8,["label"])])]),o("div",Ve,[i(e(ce),{ref_key:"dt",ref:Z,value:F.zones.data,selection:v.value,"onUpdate:selection":l[3]||(l[3]=t=>v.value=t),filters:x.value,"onUpdate:filters":l[4]||(l[4]=t=>x.value=t),dataKey:"id",loading:y.value,paginator:!0,rows:F.zones.per_page,totalRecords:F.zones.total,lazy:!0,onPage:l[5]||(l[5]=t=>O(t)),onSort:l[6]||(l[6]=t=>O(t)),onFilter:l[7]||(l[7]=t=>L(t)),first:u.value.first,"onUpdate:first":l[8]||(l[8]=t=>u.value.first=t),sortField:u.value.sortField,sortOrder:u.value.sortOrder,filterDisplay:"menu",globalFilterFields:["nomenclature","title","region.designation"],class:"p-datatable-custom",removableSort:""},{header:n(()=>[o("div",Se,[i(e(W),{iconPosition:"left"},{default:n(()=>[i(e(E),{class:"pi pi-search text-slate-400"}),i(e(T),{modelValue:x.value.global.value,"onUpdate:modelValue":l[0]||(l[0]=t=>x.value.global.value=t),placeholder:"Rechercher une zone...",class:"w-full md:w-80 rounded-2xl border-slate-200 bg-slate-50/50 focus:bg-white"},null,8,["modelValue"])]),_:1}),o("div",Ce,[Te,i(e(U),{modelValue:u.value.rows,"onUpdate:modelValue":l[1]||(l[1]=t=>u.value.rows=t),options:G.value,class:"p-dropdown-sm rounded-xl border-slate-200",id:"rowsPerPage"},null,8,["modelValue","options"])]),o("div",Fe,[i(e(f),{icon:"pi pi-download",text:"",rounded:"",severity:"secondary",onClick:l[2]||(l[2]=t=>Z.value.exportCSV())}),i(e(f),{icon:"pi pi-cog",text:"",rounded:"",severity:"secondary",onClick:B}),v.value&&v.value.length>0?(p(),V(e(f),{key:0,label:`Supprimer (${v.value.length})`,icon:"pi pi-trash",severity:"danger",raised:"",onClick:Y},null,8,["label"])):m("",!0)])])]),default:n(()=>[i(e(S),{selectionMode:"multiple",headerStyle:"width: 3rem"}),w.value.includes("nomenclature")?(p(),V(e(S),{key:0,field:"nomenclature",header:"Nomenclature",sortable:"",filterField:"nomenclature",showFilterMatchModes:!1},ie({filter:n(({filterModel:t})=>[i(e(T),{modelValue:t.value,"onUpdate:modelValue":r=>t.value=r,type:"text",class:"p-column-filter",placeholder:"Chercher par nomenclature"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},[w.value.includes("nomenclature")?{name:"body",fn:n(({data:t})=>[o("div",$e,[i(e(xe),{label:t.nomenclature[0],shape:"circle",class:"bg-primary-50 text-primary-600 font-bold"},null,8,["label"]),o("span",ze,g(t.nomenclature),1)])]),key:"0"}:void 0]),1024)):m("",!0),w.value.includes("title")?(p(),V(e(S),{key:1,field:"title",header:"Titre",sortable:"",filterField:"title",showFilterMatchModes:!1},{body:n(({data:t})=>[o("span",Pe,g(t.title),1)]),filter:n(({filterModel:t})=>[i(e(T),{modelValue:t.value,"onUpdate:modelValue":r=>t.value=r,type:"text",class:"p-column-filter",placeholder:"Chercher par titre"},null,8,["modelValue","onUpdate:modelValue"])]),_:1})):m("",!0),w.value.includes("region.designation")?(p(),V(e(S),{key:2,field:"region.designation",header:"Région Parente",sortable:"",filterField:"region.designation",showFilterMatchModes:!1},{body:n(({data:t})=>{var r;return[i(e(ve),{value:((r=t.region)==null?void 0:r.designation)||"N/A",severity:"info",class:"rounded-lg px-3 uppercase text-[10px]"},null,8,["value"])]}),filter:n(({filterModel:t})=>[i(e(U),{modelValue:t.value,"onUpdate:modelValue":r=>t.value=r,options:_.regions,optionLabel:"designation",optionValue:"designation",placeholder:"Toutes les régions",class:"p-column-filter",showClear:""},null,8,["modelValue","onUpdate:modelValue","options"])]),_:1})):m("",!0),w.value.includes("description")?(p(),V(e(S),{key:3,field:"description",header:"Description"},{body:n(({data:t})=>[o("span",Ne,g(t.description||"N/A"),1)]),_:1})):m("",!0),i(e(S),{header:e(d)("common.actions"),alignFrozen:"right",frozen:"",class:"min-w-[120px]"},{body:n(({data:t})=>[o("div",Ae,[i(e(f),{icon:"pi pi-pencil",text:"",rounded:"",severity:"info",onClick:r=>X(t)},null,8,["onClick"]),i(e(f),{icon:"pi pi-trash",text:"",rounded:"",severity:"danger",onClick:r=>Q(t)},null,8,["onClick"])])]),_:1},8,["header"])]),_:1},8,["value","selection","filters","loading","rows","totalRecords","first","sortField","sortOrder"])]),i(e(be),{ref_key:"op",ref:R,appendTo:"body",id:"column_op",class:"p-4"},{default:n(()=>[o("div",Me,g(e(d)("common.columnSelector.title")),1),i(e(he),{modelValue:w.value,"onUpdate:modelValue":l[9]||(l[9]=t=>w.value=t),options:I.value,optionLabel:"header",optionValue:"field",display:"chip",placeholder:e(d)("common.columnSelector.placeholder"),class:"w-full max-w-xs"},null,8,["modelValue","options","placeholder"])]),_:1},512)]),i(e(pe),{visible:b.value,"onUpdate:visible":l[17]||(l[17]=t=>b.value=t),modal:"",header:!1,closable:!1,style:{width:"90vw",maxWidth:"600px"},contentStyle:{maxHeight:"80vh",overflow:"auto"},pt:{root:{class:"rounded-[3rem] overflow-hidden border-none shadow-2xl"},mask:{style:"backdrop-filter: blur(8px)"}}},{footer:n(()=>[o("div",lt,[i(e(f),{label:e(d)("common.cancel"),icon:"pi pi-times",text:"",severity:"secondary",onClick:l[16]||(l[16]=t=>b.value=!1),class:"font-bold uppercase text-[10px] tracking-widest"},null,8,["label"]),i(e(f),{label:z.value?e(d)("common.update"):e(d)("common.save"),icon:"pi pi-check-circle",severity:"indigo",class:"px-10 h-14 rounded-2xl shadow-xl shadow-indigo-100 font-black uppercase tracking-widest text-xs",onClick:J,loading:y.value},null,8,["label","loading"])])]),default:n(()=>[o("div",Ue,[De,i(e(f),{icon:"pi pi-times",variant:"text",severity:"secondary",rounded:"",onClick:l[10]||(l[10]=t=>b.value=!1),class:"text-white hover:bg-white/10"})]),o("div",Ze,[o("div",Re,[o("div",Oe,[o("div",Ie,[je,i(e(U),{modelValue:e(s).region_id,"onUpdate:modelValue":l[11]||(l[11]=t=>e(s).region_id=t),options:_.regions,optionLabel:"designation",optionValue:"id",filter:"",class:"w-full rounded-xl border-slate-200 shadow-sm",placeholder:"Sélectionner une région"},null,8,["modelValue","options"]),e(s).errors.region_id?(p(),C("small",We,g(e(s).errors.region_id),1)):m("",!0)]),o("div",Ee,[He,i(e(me),{modelValue:e(s).number,"onUpdate:modelValue":l[12]||(l[12]=t=>e(s).number=t),inputId:"zoneNumber",useGrouping:!1,class:"w-full rounded-xl border-slate-200",inputClass:"py-3 rounded-xl border-none w-full",placeholder:"Ex: 1"},null,8,["modelValue"]),e(s).errors.number?(p(),C("small",qe,g(e(s).errors.number),1)):m("",!0)])]),o("div",Le,[o("div",Be,[Ge,i(e(W),{iconPosition:"left"},{default:n(()=>[i(e(E),{class:"pi pi-tag"}),i(e(T),{modelValue:e(s).title,"onUpdate:modelValue":l[13]||(l[13]=t=>e(s).title=t),class:"w-full py-3 rounded-xl border-slate-200 focus:ring-4 focus:ring-primary-50",placeholder:"Ex: Zone d'activité économique"},null,8,["modelValue"])]),_:1}),e(s).errors.title?(p(),C("small",Ke,g(e(s).errors.title),1)):m("",!0)]),o("div",Xe,[Je,i(e(T),{modelValue:e(s).nomenclature,"onUpdate:modelValue":l[14]||(l[14]=t=>e(s).nomenclature=t),class:"w-full py-3 rounded-xl border-slate-200 focus:ring-4 focus:ring-primary-50",placeholder:"Ex: ZAE-001"},null,8,["modelValue"]),e(s).errors.nomenclature?(p(),C("small",Qe,g(e(s).errors.nomenclature),1)):m("",!0)])]),o("div",Ye,[et,re(o("textarea",{"onUpdate:modelValue":l[15]||(l[15]=t=>e(s).description=t),rows:"4",class:"w-full p-4 rounded-xl border border-slate-200 bg-slate-50 focus:bg-white focus:ring-4 focus:ring-primary-50 transition-all text-sm outline-none shadow-sm",placeholder:"Notes additionnelles sur cette zone..."},null,512),[[ne,e(s).description]]),e(s).errors.description?(p(),C("small",tt,g(e(s).errors.description),1)):m("",!0)])])])]),_:1},8,["visible"]),i(e(fe),{position:"bottom-right"}),i(e(ge))]),_:1}))}};export{Tt as default};
